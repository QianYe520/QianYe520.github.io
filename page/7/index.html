<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
<link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">

<meta name="theme-color" content="#222">
<style>
    .pace .pace-progress {
        background: #1E92FB; /*进度条颜色*/
        height: 3px;
    }
    .pace .pace-progress-inner {
         box-shadow: 0 0 10px #1E92FB, 0 0 5px     #1E92FB; /*阴影颜色*/
    }
    .pace .pace-activity {
        border-top-color: #1E92FB;    /*上边框颜色*/
        border-left-color: #1E92FB;    /*左边框颜色*/
    }
</style>








<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="ReactNative">
<meta property="og:type" content="website">
<meta property="og:title" content="千夜、おれはおまえをずっと爱している">
<meta property="og:url" content="http://yoursite.com/page/7/index.html">
<meta property="og:site_name" content="千夜、おれはおまえをずっと爱している">
<meta property="og:description" content="ReactNative">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="千夜、おれはおまえをずっと爱している">
<meta name="twitter:description" content="ReactNative">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/7/"/>





  <title>千夜、おれはおまえをずっと爱している</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">千夜、おれはおまえをずっと爱している</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/19/RxSwift/Grammar/Operators-数学和集合操作符/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="千夜 QQ:738816656">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="千夜、おれはおまえをずっと爱している">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/19/RxSwift/Grammar/Operators-数学和集合操作符/" itemprop="url">Swift-RxSwift-Mathematical & Aggregate Operators-数学和集合操作符</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-19T16:06:59+08:00">
                2017-12-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Swift/" itemprop="url" rel="index">
                    <span itemprop="name">Swift</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Swift/RxSwift/" itemprop="url" rel="index">
                    <span itemprop="name">RxSwift</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="数学和集合操作符"><a href="#数学和集合操作符" class="headerlink" title="数学和集合操作符"></a>数学和集合操作符</h1><ul>
<li><a href="#1.1">①toArray</a></li>
<li><a href="#1.2">①②reduce</a></li>
<li><a href="#1.3">③concat</a></li>
</ul>
<p><span id="1.1">①toArray</span></p>
<h2 id="①toArray"><a href="#①toArray" class="headerlink" title="①toArray"></a>①toArray</h2><blockquote>
<p>将sequence转换成一个array，并转换成单一事件信号，然后结束</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line"><span class="type">Observable</span>.range(start: <span class="number">1</span>, <span class="built_in">count</span>: <span class="number">10</span>)</div><div class="line">          .toArray()</div><div class="line">          .subscribe &#123; </div><div class="line">                    <span class="built_in">print</span>($<span class="number">0</span>)</div><div class="line">                &#125;</div><div class="line">         .addDisposableTo(disposeBag)</div><div class="line"><span class="comment">//打印</span></div><div class="line">next([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>])</div><div class="line">completed</div></pre></td></tr></table></figure>
<p><span id="1.2">②reduce</span></p>
<h2 id="②reduce"><a href="#②reduce" class="headerlink" title="②reduce"></a>②reduce</h2><blockquote>
<p>用一个初始值，对事件数据进行累计操作<br>reduce接受一个初始值，和一个操作符号<br>使用一个初始值和一个操作符，对Observable序列中的所有元素进行累计操作，并转换成单一事件信号。(PS:和map有的区别就是：map针对单个元素进行操作，reduce针对所有元素累计操作)</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()   </div><div class="line"><span class="type">Observable</span>.of(<span class="number">10</span>, <span class="number">100</span>, <span class="number">1000</span>)</div><div class="line">		    .<span class="built_in">reduce</span>(<span class="number">1</span>, accumulator: +)</div><div class="line">		    .subscribe(onNext: &#123; </div><div class="line">		                 <span class="built_in">print</span>($<span class="number">0</span>) </div><div class="line">		             &#125;)</div><div class="line">		    .addDisposableTo(disposeBag)</div><div class="line"></div><div class="line"><span class="comment">///</span></div><div class="line">  <span class="number">1111</span></div></pre></td></tr></table></figure>
<p><span id="1.3">③concat</span></p>
<h2 id="③concat"><a href="#③concat" class="headerlink" title="③concat"></a>③concat</h2><blockquote>
<p>oncat会把多个sequence和并为一个sequence，并且当前面一个sequence发出了completed事件，才会开始下一个sequence的事件<br>在第一sequence完成之前，第二个sequence发出的事件都会被忽略，但会接收一完成之前的二发出的最后一个事件。不好解释，看例子说明</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">    </div><div class="line"><span class="keyword">let</span> subject1 = <span class="type">BehaviorSubject</span>(value: <span class="string">"🍎"</span>)</div><div class="line"><span class="keyword">let</span> subject2 = <span class="type">BehaviorSubject</span>(value: <span class="string">"🐶"</span>)</div><div class="line">    </div><div class="line"><span class="keyword">let</span> variable = <span class="type">Variable</span>(subject1)</div><div class="line">    </div><div class="line">variable.asObservable()</div><div class="line">    .concat()</div><div class="line">    .subscribe &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div><div class="line">    </div><div class="line">subject1.onNext(<span class="string">"🍐"</span>)</div><div class="line">subject1.onNext(<span class="string">"🍊"</span>)</div><div class="line">    </div><div class="line">variable.value = subject2</div><div class="line">    </div><div class="line"></div><div class="line">subject2.onNext(<span class="string">"🐱"</span>)   <span class="comment">//1完成前，会被忽略</span></div><div class="line">subject2.onNext(<span class="string">"teng"</span>) <span class="comment">//1完成前，会被忽略</span></div><div class="line">subject2.onNext(<span class="string">"fei"</span>)  <span class="comment">//1完成前的最后一个，会被接收</span></div><div class="line">    </div><div class="line">subject1.onCompleted()</div><div class="line">    </div><div class="line">subject2.onNext(<span class="string">"🐭"</span>)</div><div class="line"></div><div class="line">next(🍎)</div><div class="line">next(🍐)</div><div class="line">next(🍊)</div><div class="line">next(fei)</div><div class="line">next(🐭)</div></pre></td></tr></table></figure>
<h1 id="连接性操作"><a href="#连接性操作" class="headerlink" title="连接性操作"></a>连接性操作</h1><blockquote>
<p>Connectable Observable有订阅时不开始发射事件消息，而是仅当调用它们的connect（）方法时。这样就可以等待所有我们想要的订阅者都已经订阅了以后，再开始发出事件消息，这样能保证我们想要的所有订阅者都能接收到事件消息。其实也就是等大家都就位以后，开始发出消息</p>
</blockquote>
<h2 id="publish"><a href="#publish" class="headerlink" title="publish"></a>publish</h2><blockquote>
<p>将一个正常的sequence转换成一个connectable sequence</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   <span class="keyword">let</span> intSequence = <span class="type">Observable</span>&lt;<span class="type">Int</span>&gt;.interval(<span class="number">1</span>, scheduler: <span class="type">MainScheduler</span>.instance)</div><div class="line">    .publish()</div><div class="line">    </div><div class="line"><span class="number">_</span> = intSequence</div><div class="line">    .subscribe(onNext: &#123; <span class="built_in">print</span>(<span class="string">"Subscription 1:, Event: \($0)"</span>) &#125;)</div><div class="line">    </div><div class="line">delay(<span class="number">2</span>) &#123; <span class="number">_</span> = intSequence.connect() &#125; <span class="comment">//相当于把事件消息推迟了两秒</span></div><div class="line">    </div><div class="line">delay(<span class="number">4</span>) &#123;</div><div class="line">    <span class="number">_</span> = intSequence</div><div class="line">        .subscribe(onNext: &#123; <span class="built_in">print</span>(<span class="string">"Subscription 2:, Event: \($0)"</span>) &#125;)</div><div class="line">&#125;</div><div class="line">    </div><div class="line">delay(<span class="number">6</span>) &#123;</div><div class="line">    <span class="number">_</span> = intSequence</div><div class="line">        .subscribe(onNext: &#123; <span class="built_in">print</span>(<span class="string">"Subscription 3:, Event: \($0)"</span>) &#125;)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="type">Subscription</span> <span class="number">1</span>:, <span class="type">Event</span>: <span class="number">0</span></div><div class="line"><span class="type">Subscription</span> <span class="number">1</span>:, <span class="type">Event</span>: <span class="number">1</span></div><div class="line"><span class="type">Subscription</span> <span class="number">2</span>:, <span class="type">Event</span>: <span class="number">1</span></div><div class="line"><span class="type">Subscription</span> <span class="number">1</span>:, <span class="type">Event</span>: <span class="number">2</span></div><div class="line"><span class="type">Subscription</span> <span class="number">2</span>:, <span class="type">Event</span>: <span class="number">2</span></div><div class="line"><span class="type">Subscription</span> <span class="number">1</span>:, <span class="type">Event</span>: <span class="number">3</span></div><div class="line"><span class="type">Subscription</span> <span class="number">3</span>:, <span class="type">Event</span>: <span class="number">3</span></div><div class="line"><span class="type">Subscription</span> <span class="number">2</span>:, <span class="type">Event</span>: <span class="number">3</span></div><div class="line"><span class="type">Subscription</span> <span class="number">1</span>:, <span class="type">Event</span>: <span class="number">4</span></div><div class="line"><span class="type">Subscription</span> <span class="number">3</span>:, <span class="type">Event</span>: <span class="number">4</span></div></pre></td></tr></table></figure>
<h2 id="replay"><a href="#replay" class="headerlink" title="replay"></a>replay</h2><blockquote>
<p>将一个正常的sequence转换成一个connectable sequence，然后和replaySubject相似，能接收到订阅之前的事件消息</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">  <span class="keyword">let</span> intSequence = <span class="type">Observable</span>&lt;<span class="type">Int</span>&gt;.interval(<span class="number">1</span>, scheduler: <span class="type">MainScheduler</span>.instance)</div><div class="line">    .replay(<span class="number">5</span>)  <span class="comment">//接收到订阅之前的5条事件消息</span></div><div class="line">    </div><div class="line"><span class="number">_</span> = intSequence</div><div class="line">    .subscribe(onNext: &#123; <span class="built_in">print</span>(<span class="string">"Subscription 1:, Event: \($0)"</span>) &#125;)</div><div class="line">    </div><div class="line">delay(<span class="number">2</span>) &#123; <span class="number">_</span> = intSequence.connect() &#125;</div><div class="line">    </div><div class="line">delay(<span class="number">4</span>) &#123;</div><div class="line">    <span class="number">_</span> = intSequence</div><div class="line">        .subscribe(onNext: &#123; <span class="built_in">print</span>(<span class="string">"Subscription 2:, Event: \($0)"</span>) &#125;)</div><div class="line">&#125;</div><div class="line">    </div><div class="line">delay(<span class="number">8</span>) &#123;</div><div class="line">    <span class="number">_</span> = intSequence</div><div class="line">        .subscribe(onNext: &#123; <span class="built_in">print</span>(<span class="string">"Subscription 3:, Event: \($0)"</span>) &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="multicast"><a href="#multicast" class="headerlink" title="multicast"></a>multicast</h2><blockquote>
<p>将一个正常的sequence转换成一个connectable sequence，并且通过特性的subject发送出去，比如PublishSubject，或者replaySubject，behaviorSubject等。不同的Subject会有不同的结果</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">  <span class="keyword">let</span> subject = <span class="type">PublishSubject</span>&lt;<span class="type">Int</span>&gt;()</div><div class="line">    </div><div class="line"><span class="number">_</span> = subject</div><div class="line">    .subscribe(onNext: &#123; <span class="built_in">print</span>(<span class="string">"Subject: \($0)"</span>) &#125;)</div><div class="line">    </div><div class="line"><span class="keyword">let</span> intSequence = <span class="type">Observable</span>&lt;<span class="type">Int</span>&gt;.interval(<span class="number">1</span>, scheduler: <span class="type">MainScheduler</span>.instance)</div><div class="line">    .multicast(subject)</div><div class="line">    </div><div class="line"><span class="number">_</span> = intSequence</div><div class="line">    .subscribe(onNext: &#123; <span class="built_in">print</span>(<span class="string">"\tSubscription 1:, Event: \($0)"</span>) &#125;)</div><div class="line">    </div><div class="line">delay(<span class="number">2</span>) &#123; <span class="number">_</span> = intSequence.connect() &#125;</div><div class="line">    </div><div class="line">delay(<span class="number">4</span>) &#123;</div><div class="line">    <span class="number">_</span> = intSequence</div><div class="line">        .subscribe(onNext: &#123; <span class="built_in">print</span>(<span class="string">"\tSubscription 2:, Event: \($0)"</span>) &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h1><h2 id="catchErrorJustReturn"><a href="#catchErrorJustReturn" class="headerlink" title="catchErrorJustReturn"></a>catchErrorJustReturn</h2><blockquote>
<p>遇到error事件的时候，就return一个值，然后结束</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   <span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">    </div><div class="line"><span class="keyword">let</span> sequenceThatFails = <span class="type">PublishSubject</span>&lt;<span class="type">String</span>&gt;()</div><div class="line">    </div><div class="line">sequenceThatFails</div><div class="line">    .catchErrorJustReturn(<span class="string">"😊"</span>)</div><div class="line">    .subscribe &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div><div class="line">    </div><div class="line">sequenceThatFails.onNext(<span class="string">"😬"</span>)</div><div class="line">sequenceThatFails.onNext(<span class="string">"😨"</span>)</div><div class="line">sequenceThatFails.onNext(<span class="string">"😡"</span>)</div><div class="line">sequenceThatFails.onNext(<span class="string">"🔴"</span>)</div><div class="line">sequenceThatFails.onError(<span class="type">TestError</span>.test)</div><div class="line"></div><div class="line"><span class="comment">///</span></div><div class="line">next(😬)</div><div class="line">next(😨)</div><div class="line">next(😡)</div><div class="line">next(🔴)</div><div class="line">next(😊)</div><div class="line">completed</div></pre></td></tr></table></figure>
<h2 id="catchError"><a href="#catchError" class="headerlink" title="catchError"></a>catchError</h2><blockquote>
<p>捕获error进行处理，可以返回另一个sequence进行订阅</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   <span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">    </div><div class="line"><span class="keyword">let</span> sequenceThatFails = <span class="type">PublishSubject</span>&lt;<span class="type">String</span>&gt;()</div><div class="line"><span class="keyword">let</span> recoverySequence = <span class="type">PublishSubject</span>&lt;<span class="type">String</span>&gt;()</div><div class="line">    </div><div class="line">sequenceThatFails</div><div class="line">    .catchError &#123;</div><div class="line">        <span class="built_in">print</span>(<span class="string">"Error:"</span>, $<span class="number">0</span>)</div><div class="line">        <span class="keyword">return</span> recoverySequence</div><div class="line">    &#125;</div><div class="line">    .subscribe &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div><div class="line">    </div><div class="line">sequenceThatFails.onNext(<span class="string">"😬"</span>)</div><div class="line">sequenceThatFails.onNext(<span class="string">"😨"</span>)</div><div class="line">sequenceThatFails.onNext(<span class="string">"😡"</span>)</div><div class="line">sequenceThatFails.onNext(<span class="string">"🔴"</span>)</div><div class="line">sequenceThatFails.onError(<span class="type">TestError</span>.test)</div><div class="line">    </div><div class="line">recoverySequence.onNext(<span class="string">"😊"</span>)</div><div class="line"></div><div class="line"><span class="comment">//</span></div><div class="line">next(😬)</div><div class="line">next(😨)</div><div class="line">next(😡)</div><div class="line">next(🔴)</div><div class="line"><span class="type">Error</span>: test</div><div class="line">next(😊)</div></pre></td></tr></table></figure>
<h2 id="retry"><a href="#retry" class="headerlink" title="retry"></a>retry</h2><blockquote>
<p>遇见error事件可以进行重试，比如网络请求失败，可以进行重新连接</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   <span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line"><span class="keyword">var</span> <span class="built_in">count</span> = <span class="number">1</span></div><div class="line">    </div><div class="line"><span class="keyword">let</span> sequenceThatErrors = <span class="type">Observable</span>&lt;<span class="type">String</span>&gt;.create &#123; observer <span class="keyword">in</span></div><div class="line">    observer.onNext(<span class="string">"🍎"</span>)</div><div class="line">    observer.onNext(<span class="string">"🍐"</span>)</div><div class="line">    observer.onNext(<span class="string">"🍊"</span>)</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> <span class="built_in">count</span> == <span class="number">1</span> &#123;</div><div class="line">        observer.onError(<span class="type">TestError</span>.test)</div><div class="line">        <span class="built_in">print</span>(<span class="string">"Error encountered"</span>)</div><div class="line">        <span class="built_in">count</span> += <span class="number">1</span></div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    observer.onNext(<span class="string">"🐶"</span>)</div><div class="line">    observer.onNext(<span class="string">"🐱"</span>)</div><div class="line">    observer.onNext(<span class="string">"🐭"</span>)</div><div class="line">    observer.onCompleted()</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> <span class="type">Disposables</span>.create()</div><div class="line">&#125;</div><div class="line">    </div><div class="line">sequenceThatErrors</div><div class="line">    .retry(<span class="number">3</span>)       <span class="comment">//不传入数字的话，只会重试一次</span></div><div class="line">    .subscribe(onNext: &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;)</div><div class="line">    .addDisposableTo(disposeBag)</div></pre></td></tr></table></figure>
<h1 id="debug"><a href="#debug" class="headerlink" title="debug"></a>debug</h1><blockquote>
<p>打印所有的订阅, 事件和disposals</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   </div><div class="line"></div><div class="line">sequenceThatErrors</div><div class="line">    .retry(<span class="number">3</span>)</div><div class="line">    .debug()</div><div class="line">    .subscribe(onNext: &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;)</div><div class="line">    .addDisposableTo(disposeBag)</div></pre></td></tr></table></figure>
<h1 id="RxSwift-Resources-total"><a href="#RxSwift-Resources-total" class="headerlink" title="RxSwift.Resources.total"></a>RxSwift.Resources.total</h1><blockquote>
<p>查看RxSwift所有资源的占用</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line"><span class="built_in">print</span>(<span class="type">RxSwift</span>.<span class="type">Resources</span>.total)</div></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    



    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/19/RxSwift/Grammar/Operators-过滤和条件操作符/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="千夜 QQ:738816656">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="千夜、おれはおまえをずっと爱している">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/19/RxSwift/Grammar/Operators-过滤和条件操作符/" itemprop="url">Swift-RxSwift-过滤和条件操作符</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-19T16:06:59+08:00">
                2017-12-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Swift/" itemprop="url" rel="index">
                    <span itemprop="name">Swift</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Swift/RxSwift/" itemprop="url" rel="index">
                    <span itemprop="name">RxSwift</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="过滤和条件操作符"><a href="#过滤和条件操作符" class="headerlink" title="过滤和条件操作符"></a>过滤和条件操作符</h1><p><a href="#1.1">①filter</a><br><a href="#1.2">②distinctUntilChanged</a><br><a href="#1.3">③elementAt</a><br><a href="#1.4">④single</a><br><a href="#1.5">⑤take</a><br><a href="#1.6">⑥takeLast</a><br><a href="#1.7">⑦takeWhile</a><br><a href="#1.8">⑧takeUntil</a><br><a href="#1.9">⑨skip</a><br><a href="#1.10">⑩ skipWhile</a><br><a href="#1.11">⑪skipWhileWithIndex</a><br><a href="#1.12">⑫skipUntil</a> </p>
<p><span id="1.1">①filter </span></p>
<h2 id="①filter"><a href="#①filter" class="headerlink" title="①filter"></a>①filter</h2><blockquote>
<p>过滤掉某些不符合要求的事件<br>在Observable序列中只发出满足过滤条件的事件</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   <span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">    </div><div class="line"><span class="type">Observable</span>.of(</div><div class="line">    <span class="string">"🐱"</span>, <span class="string">"🐰"</span>, <span class="string">"🐶"</span>,</div><div class="line">    <span class="string">"🐸"</span>, <span class="string">"🐱"</span>, <span class="string">"🐰"</span>,</div><div class="line">    <span class="string">"🐹"</span>, <span class="string">"🐸"</span>, <span class="string">"🐱"</span>)</div><div class="line">    .<span class="built_in">filter</span> &#123;</div><div class="line">        $<span class="number">0</span> == <span class="string">"🐱"</span></div><div class="line">    &#125;</div><div class="line">    .subscribe(onNext: &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;)</div><div class="line">    .addDisposableTo(disposeBag)</div><div class="line"><span class="comment">///</span></div><div class="line">🐱</div><div class="line">🐱</div><div class="line">🐱</div></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line"> <span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">    </div><div class="line">  <span class="type">Observable</span>.of(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>)</div><div class="line">            .<span class="built_in">filter</span>(</div><div class="line">                   &#123;$<span class="number">0</span> &gt; <span class="number">2</span>&#125;</div><div class="line">                   )</div><div class="line">            .subscribe(</div><div class="line">                       onNext: &#123;<span class="built_in">print</span>($<span class="number">0</span>)&#125;</div><div class="line">                      )</div><div class="line">            .disposed(by: disposeBag)</div><div class="line"><span class="comment">//打印结果</span></div><div class="line"><span class="number">3</span></div><div class="line"><span class="number">4</span></div><div class="line"><span class="number">5</span></div></pre></td></tr></table></figure>
<p><span id="1.2">②distinctUntilChanged </span></p>
<h2 id="②distinctUntilChanged"><a href="#②distinctUntilChanged" class="headerlink" title="②distinctUntilChanged"></a>②distinctUntilChanged</h2><blockquote>
<p>过滤连续发出的相同事件<br>distinctUntilChanged就是当下一个事件与前一个事件是不同事件的事件才进行处理操作</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   <span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">    </div><div class="line"><span class="type">Observable</span>.of(<span class="string">"🐱"</span>, <span class="string">"🐷"</span>, <span class="string">"🐱"</span>, <span class="string">"🐱"</span>, <span class="string">"🐱"</span>, <span class="string">"🐵"</span>, <span class="string">"🐱"</span>)</div><div class="line">    .distinctUntilChanged()</div><div class="line">    .subscribe(onNext: &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;)</div><div class="line">    .addDisposableTo(disposeBag)</div><div class="line"></div><div class="line"><span class="comment">///</span></div><div class="line">🐱</div><div class="line">🐷</div><div class="line">🐱</div><div class="line">🐵</div><div class="line">🐱</div></pre></td></tr></table></figure>
<p><span id="1.3">③elementAt </span></p>
<h2 id="③elementAt"><a href="#③elementAt" class="headerlink" title="③elementAt"></a>③elementAt</h2><blockquote>
<p>只处理在指定位置的事件</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">  <span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">    </div><div class="line"><span class="type">Observable</span>.of(<span class="string">"🐱"</span>, <span class="string">"🐰"</span>, <span class="string">"🐶"</span>, <span class="string">"🐸"</span>, <span class="string">"🐷"</span>, <span class="string">"🐵"</span>)</div><div class="line">    .elementAt(<span class="number">3</span>)</div><div class="line">    .subscribe(onNext: &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;)</div><div class="line">    .addDisposableTo(disposeBag)</div><div class="line"><span class="comment">//</span></div><div class="line">🐸</div></pre></td></tr></table></figure>
<p><span id="1.4">④single</span></p>
<h2 id="④single"><a href="#④single" class="headerlink" title="④single"></a>④single</h2><blockquote>
<p>用法一：检测Observable序列是否发射一个元素。如果发射多个，会报错</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">  <span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line"></div><div class="line"><span class="comment">// error:Sequence contains more than one element</span></div><div class="line"><span class="comment">// Observable.of(1,2,3).single().subscribe(onNext: &#123;print($0)&#125;).disposed(by: disposeBag)</span></div><div class="line"></div><div class="line"><span class="type">Observable</span>.of(<span class="number">1</span>)</div><div class="line">          .single()</div><div class="line">          .subscribe(</div><div class="line">                     onNext: &#123;<span class="built_in">print</span>($<span class="number">0</span>)&#125;</div><div class="line">                    )</div><div class="line">          .disposed(by: disposeBag)</div></pre></td></tr></table></figure>
<blockquote>
<p>用法二:检测Observable序列发射的元素里面是否包含多个指定的元素，如果有多个或者没有，会报错。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">  <span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line"><span class="type">Observable</span>.of(<span class="string">"🐱"</span>, <span class="string">"🐰"</span>, <span class="string">"🐶"</span>, <span class="string">"🐸"</span>, <span class="string">"🐷"</span>, <span class="string">"🐵"</span>)</div><div class="line">    .single &#123; $<span class="number">0</span> == <span class="string">"🐸"</span> &#125;</div><div class="line">    .subscribe &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .disposed(by: disposeBag)</div><div class="line">    </div><div class="line"><span class="type">Observable</span>.of(<span class="string">"🐱"</span>, <span class="string">"🐰"</span>, <span class="string">"🐶"</span>, <span class="string">"🐱"</span>, <span class="string">"🐰"</span>, <span class="string">"🐶"</span>)</div><div class="line">    .single &#123; $<span class="number">0</span> == <span class="string">"🐒"</span> &#125;</div><div class="line">    .subscribe &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .disposed(by: disposeBag)</div><div class="line">    </div><div class="line"><span class="type">Observable</span>.of(<span class="string">"🐱"</span>, <span class="string">"🐰"</span>, <span class="string">"🐶"</span>, <span class="string">"🐶"</span>,<span class="string">"🐸"</span>)</div><div class="line">    .single &#123; $<span class="number">0</span> == <span class="string">"🐶"</span> &#125;</div><div class="line">    .subscribe &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .disposed(by: disposeBag</div><div class="line">    </div><div class="line">   <span class="comment">//打印结果</span></div><div class="line">	next(🐸)</div><div class="line">	completed</div><div class="line">	error(<span class="type">Sequence</span> doesn't contain any elements.)</div><div class="line">	next(🐶)</div><div class="line">	error(<span class="type">Sequence</span> <span class="built_in">contains</span> more than one element.)</div></pre></td></tr></table></figure>
<blockquote>
<p>出在sequence只发出一次的事件，如果超过一个就会发出error错误</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line"><span class="type">Observable</span>.of(<span class="string">"🐱"</span>, <span class="string">"🐰"</span>, <span class="string">"🐶"</span>, <span class="string">"🐸"</span>, <span class="string">"🐷"</span>, <span class="string">"🐵"</span>)</div><div class="line"> .single()</div><div class="line"> .subscribe(onNext: &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;)</div><div class="line"> .addDisposableTo(disposeBag)</div></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">  🐱  <span class="comment">//单一信号超过了一个</span></div><div class="line"><span class="type">Received</span> unhandled error: /<span class="keyword">var</span>/folders/hz/v15ld5mj0nqf83d21j13y0tw0000gn/<span class="type">T</span>/./lldb/<span class="number">7229</span>/playground107.swift:<span class="number">69</span>:__lldb_expr_107 -&gt; <span class="type">Sequence</span> <span class="built_in">contains</span> more than one element.</div></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line"><span class="type">Observable</span>.of(<span class="string">"🐱"</span>, <span class="string">"🐰"</span>, <span class="string">"🐶"</span>, <span class="string">"🐸"</span>, <span class="string">"🐷"</span>, <span class="string">"🐵"</span>)</div><div class="line"> .single &#123; $<span class="number">0</span> == <span class="string">"🐸"</span> &#125;      <span class="comment">//青蛙只有一个，completed</span></div><div class="line"> .subscribe &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line"> .addDisposableTo(disposeBag)</div></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line"><span class="type">Observable</span>.of(<span class="string">"🐱"</span>, <span class="string">"🐰"</span>, <span class="string">"🐶"</span>, <span class="string">"🐱"</span>, <span class="string">"🐰"</span>, <span class="string">"🐶"</span>)</div><div class="line"> .single &#123; $<span class="number">0</span> == <span class="string">"🐰"</span> &#125; <span class="comment">//兔子有两个，会发出error</span></div><div class="line"> .subscribe &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line"> .addDisposableTo(disposeBag)</div></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line"><span class="type">Observable</span>.of(<span class="string">"🐱"</span>, <span class="string">"🐰"</span>, <span class="string">"🐶"</span>, <span class="string">"🐸"</span>, <span class="string">"🐷"</span>, <span class="string">"🐵"</span>)</div><div class="line"> .single &#123; $<span class="number">0</span> == <span class="string">"🔵"</span> &#125; <span class="comment">//没有蓝色球，会发出error</span></div><div class="line"> .subscribe &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line"> .addDisposableTo(disposeBag)</div></pre></td></tr></table></figure>
<p><span id="1.5">⑤take</span></p>
<h2 id="⑤take"><a href="#⑤take" class="headerlink" title="⑤take"></a>⑤take</h2><blockquote>
<p>只处理前几个事件信号</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   <span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">    </div><div class="line"><span class="type">Observable</span>.of(<span class="string">"🐱"</span>, <span class="string">"🐰"</span>, <span class="string">"🐶"</span>, <span class="string">"🐸"</span>, <span class="string">"🐷"</span>, <span class="string">"🐵"</span>)</div><div class="line">    .take(<span class="number">3</span>)</div><div class="line">    .subscribe(onNext: &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;)</div><div class="line">    .addDisposableTo(disposeBag)</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//</span></div><div class="line">🐱</div><div class="line">🐰</div><div class="line">🐶</div></pre></td></tr></table></figure>
<blockquote>
<p>从Observable序列开始点起只处理前几个事件</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line"> <span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">    </div><div class="line"><span class="type">Observable</span>.of(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</div><div class="line">         .take(<span class="number">2</span>)</div><div class="line">         .subscribe(</div><div class="line">                    onNext: &#123;<span class="built_in">print</span>($<span class="number">0</span>)&#125;</div><div class="line">                   )</div><div class="line">         .disposed(by: disposeBag)</div><div class="line"></div><div class="line"><span class="comment">//打印结果:</span></div><div class="line"> <span class="number">1</span></div><div class="line"> <span class="number">2</span></div></pre></td></tr></table></figure>
<p><span id="1.6">⑥takeLast</span></p>
<h2 id="⑥takeLast"><a href="#⑥takeLast" class="headerlink" title="⑥takeLast"></a>⑥takeLast</h2><blockquote>
<p>只处理后几个事件信号<br>与take相反，从Observable序列的结束位置起，只处理前几个事件</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   <span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">    </div><div class="line"><span class="type">Observable</span>.of(<span class="string">"🐱"</span>, <span class="string">"🐰"</span>, <span class="string">"🐶"</span>, <span class="string">"🐸"</span>, <span class="string">"🐷"</span>, <span class="string">"🐵"</span>)</div><div class="line">    .takeLast(<span class="number">3</span>)</div><div class="line">    .subscribe(onNext: &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;)</div><div class="line">    .addDisposableTo(disposeBag)</div><div class="line"><span class="comment">//打印结果</span></div><div class="line">🐸</div><div class="line">🐷</div><div class="line">🐵</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()    </div><div class="line"><span class="type">Observable</span>.of(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</div><div class="line">          .takeLast(<span class="number">2</span>)</div><div class="line">          .subscribe(onNext: &#123;<span class="built_in">print</span>($<span class="number">0</span>)&#125;)</div><div class="line">          .disposed(by: disposeBag)</div><div class="line"></div><div class="line"><span class="comment">//打印结果</span></div><div class="line"><span class="number">2</span></div><div class="line"><span class="number">3</span></div></pre></td></tr></table></figure>
<p><span id="1.7">⑦takeWhile</span></p>
<h2 id="⑦takeWhile"><a href="#⑦takeWhile" class="headerlink" title="⑦takeWhile"></a>⑦takeWhile</h2><blockquote>
<p>只处理满足条件的事件。感觉和filter没什么区别</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">  <span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">   </div><div class="line"><span class="type">Observable</span>.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>)</div><div class="line">    .takeWhile &#123; $<span class="number">0</span> &lt; <span class="number">4</span> &#125;</div><div class="line">    .subscribe(onNext: &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;)</div><div class="line">    .addDisposableTo(disposeBag)</div><div class="line">   <span class="comment">//打印结果：</span></div><div class="line"><span class="number">1</span></div><div class="line"><span class="number">2</span></div><div class="line"><span class="number">3</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line"><span class="type">Observable</span>.of(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>)</div><div class="line">          .takeWhile&#123;$<span class="number">0</span> &lt; <span class="number">3</span>&#125;</div><div class="line">          .subscribe(onNext: &#123;<span class="built_in">print</span>($<span class="number">0</span>)&#125;)</div><div class="line">          .disposed(by: disposeBag)</div><div class="line"></div><div class="line"><span class="comment">//打印结果：</span></div><div class="line"><span class="number">1</span></div><div class="line"><span class="number">2</span></div></pre></td></tr></table></figure>
<p><span id="1.8">⑧takeUntil</span></p>
<h2 id="⑧takeUntil"><a href="#⑧takeUntil" class="headerlink" title="⑧takeUntil"></a>⑧takeUntil</h2><blockquote>
<p>接收事件消息，直到另一个sequence发出事件消息的时候</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">  <span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">   </div><div class="line"><span class="keyword">let</span> sourceSequence = <span class="type">PublishSubject</span>&lt;<span class="type">String</span>&gt;()</div><div class="line"><span class="keyword">let</span> referenceSequence = <span class="type">PublishSubject</span>&lt;<span class="type">String</span>&gt;()</div><div class="line">   </div><div class="line">sourceSequence</div><div class="line">    .takeUntil(referenceSequence)</div><div class="line">    .subscribe &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div><div class="line">   </div><div class="line">sourceSequence.onNext(<span class="string">"🐱"</span>)</div><div class="line">sourceSequence.onNext(<span class="string">"🐰"</span>)</div><div class="line">sourceSequence.onNext(<span class="string">"🐶"</span>)</div><div class="line">    </div><div class="line">referenceSequence.onNext(<span class="string">"🔴"</span>)  <span class="comment">//停止接收消息</span></div><div class="line">    </div><div class="line">sourceSequence.onNext(<span class="string">"🐸"</span>)</div><div class="line">sourceSequence.onNext(<span class="string">"🐷"</span>)</div><div class="line">sourceSequence.onNext(<span class="string">"🐵"</span>)</div><div class="line"></div><div class="line"><span class="comment">///</span></div><div class="line">next(🐱)</div><div class="line">next(🐰)</div><div class="line">next(🐶)</div><div class="line">completed</div></pre></td></tr></table></figure>
<blockquote>
<p>直到另一个Observable序列发出一个信号，则原序列终</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line"> <span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">   </div><div class="line"><span class="keyword">let</span> orinSubject = <span class="type">PublishSubject</span>&lt;<span class="type">Int</span>&gt;()</div><div class="line"><span class="keyword">let</span> refreSubject = <span class="type">PublishSubject</span>&lt;<span class="type">Int</span>&gt;()</div><div class="line">    </div><div class="line">orinSubject.takeUntil(refreSubject)</div><div class="line">           .subscribe(onNext: &#123;<span class="built_in">print</span>($<span class="number">0</span>)&#125;)</div><div class="line">           .disposed(by: disposeBag)</div><div class="line">    </div><div class="line">orinSubject.onNext(<span class="number">1</span>)</div><div class="line">orinSubject.onNext(<span class="number">2</span>)</div><div class="line">refreSubject.onNext(<span class="number">10</span>)</div><div class="line">orinSubject.onNext(<span class="number">3</span>)</div><div class="line"></div><div class="line"><span class="comment">//打印结果</span></div><div class="line"><span class="number">1</span></div><div class="line"><span class="number">2</span></div></pre></td></tr></table></figure>
<p><span id="1.9">⑨skip</span></p>
<h2 id="⑨skip"><a href="#⑨skip" class="headerlink" title="⑨skip"></a>⑨skip</h2><blockquote>
<p>取消前几个事件</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">  <span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">   </div><div class="line"><span class="type">Observable</span>.of(<span class="string">"🐱"</span>, <span class="string">"🐰"</span>, <span class="string">"🐶"</span>, <span class="string">"🐸"</span>, <span class="string">"🐷"</span>, <span class="string">"🐵"</span>)</div><div class="line">    .skip(<span class="number">2</span>)</div><div class="line">    .subscribe(onNext: &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;)</div><div class="line">    .addDisposableTo(disposeBag)</div><div class="line"></div><div class="line"> <span class="comment">//</span></div><div class="line"> 🐶</div><div class="line"> 🐸</div><div class="line"> 🐷</div><div class="line"> 🐵</div></pre></td></tr></table></figure>
<blockquote>
<p>从Observable序列的元素跳过指定个数</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line"><span class="type">Observable</span>.of(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>)</div><div class="line">          .skip(<span class="number">2</span>)</div><div class="line">          .subscribe(onNext: &#123;<span class="built_in">print</span>($<span class="number">0</span>)&#125;)</div><div class="line">          .disposed(by: disposeBag)</div><div class="line"><span class="comment">//打印结果：</span></div><div class="line"><span class="number">3</span></div><div class="line"><span class="number">4</span></div><div class="line"><span class="number">5</span></div><div class="line"><span class="number">6</span></div></pre></td></tr></table></figure>
<p><span id="1.10">⑩skipWhile</span></p>
<h2 id="⑩-skipWhile"><a href="#⑩-skipWhile" class="headerlink" title="⑩ skipWhile"></a>⑩ skipWhile</h2><blockquote>
<p>满足条件的事件消息都取消</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">  <span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">    </div><div class="line"><span class="type">Observable</span>.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>)</div><div class="line">    .skipWhile &#123; $<span class="number">0</span> &lt; <span class="number">4</span> &#125;</div><div class="line">    .subscribe(onNext: &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;)</div><div class="line">    .addDisposableTo(disposeBag)</div><div class="line">	<span class="comment">///</span></div><div class="line">	<span class="number">4</span></div><div class="line">	<span class="number">5</span></div><div class="line">	<span class="number">6</span></div></pre></td></tr></table></figure>
<blockquote>
<p>跳过满足条件的事件，只要遇见不满足条件的事件，则该事件以及之后的事件（不管是否满足条件）都会发出</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()    </div><div class="line"><span class="type">Observable</span>.of(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>)</div><div class="line">          .skipWhile&#123;$<span class="number">0</span> &lt; <span class="number">3</span>&#125;</div><div class="line">          .subscribe(onNext: &#123;<span class="built_in">print</span>($<span class="number">0</span>)&#125;)</div><div class="line">          .disposed(by: disposeBag)</div><div class="line"><span class="comment">//打印结果</span></div><div class="line"><span class="number">3</span></div><div class="line"><span class="number">4</span></div><div class="line"><span class="number">5</span></div><div class="line"><span class="number">6</span></div></pre></td></tr></table></figure>
<p><span id="1.11">⑪skipWhileWithIndex</span></p>
<h2 id="⑪skipWhileWithIndex"><a href="#⑪skipWhileWithIndex" class="headerlink" title="⑪skipWhileWithIndex"></a>⑪skipWhileWithIndex</h2><blockquote>
<p>满足条件的都被取消，传入的闭包同skipWhile有点区别而已</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   <span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">    </div><div class="line"><span class="type">Observable</span>.of(<span class="string">"🐱"</span>, <span class="string">"🐰"</span>, <span class="string">"🐶"</span>, <span class="string">"🐸"</span>, <span class="string">"🐷"</span>, <span class="string">"🐵"</span>)</div><div class="line">    .skipWhileWithIndex &#123; element, index <span class="keyword">in</span></div><div class="line">        index &lt; <span class="number">3</span></div><div class="line">    &#125;</div><div class="line">    .subscribe(onNext: &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;)</div><div class="line">    .addDisposableTo(disposeBag)</div></pre></td></tr></table></figure>
<blockquote>
<p>跳过索引满足条件的事件</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line"> <span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line"><span class="type">Observable</span>.of(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>).skipWhileWithIndex(&#123; (element, index) -&gt; <span class="type">Bool</span> <span class="keyword">in</span></div><div class="line">        index &lt; <span class="number">3</span></div><div class="line">    &#125;).subscribe(onNext: &#123;<span class="built_in">print</span>($<span class="number">0</span>)&#125;).disposed(by: disposeBag)</div><div class="line">  <span class="comment">//打印结果:</span></div><div class="line">  <span class="number">4</span></div><div class="line"><span class="number">5</span></div><div class="line"><span class="number">6</span></div></pre></td></tr></table></figure>
<p><span id="1.12">⑫skipUntil</span></p>
<h2 id="⑫skipUntil"><a href="#⑫skipUntil" class="headerlink" title="⑫skipUntil"></a>⑫skipUntil</h2><blockquote>
<p>直到某个sequence发出了事件消息，才开始接收当前sequence发出的事件消息</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">  <span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">   </div><div class="line"><span class="keyword">let</span> sourceSequence = <span class="type">PublishSubject</span>&lt;<span class="type">String</span>&gt;()</div><div class="line"><span class="keyword">let</span> referenceSequence = <span class="type">PublishSubject</span>&lt;<span class="type">String</span>&gt;()</div><div class="line">    </div><div class="line">sourceSequence</div><div class="line">    .skipUntil(referenceSequence)</div><div class="line">    .subscribe(onNext: &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;)</div><div class="line">    .addDisposableTo(disposeBag)</div><div class="line">    </div><div class="line">sourceSequence.onNext(<span class="string">"🐱"</span>)</div><div class="line">sourceSequence.onNext(<span class="string">"🐰"</span>)</div><div class="line">sourceSequence.onNext(<span class="string">"🐶"</span>)</div><div class="line">    </div><div class="line">referenceSequence.onNext(<span class="string">"🔴"</span>)</div><div class="line">    </div><div class="line">sourceSequence.onNext(<span class="string">"🐸"</span>)</div><div class="line">sourceSequence.onNext(<span class="string">"🐷"</span>)</div><div class="line">sourceSequence.onNext(<span class="string">"🐵"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>跳过另一个Observable序列发出事件之前的所有事件<br>与takeUntil相反。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">  <span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">   </div><div class="line">  <span class="keyword">let</span> oriSubject = <span class="type">PublishSubject</span>&lt;<span class="type">Int</span>&gt;()</div><div class="line">  <span class="keyword">let</span> refreSubject = <span class="type">PublishSubject</span>&lt;<span class="type">Int</span>&gt;()</div><div class="line">   </div><div class="line">oriSubject.skipUntil(refreSubject)</div><div class="line">          .subscribe(onNext: &#123;<span class="built_in">print</span>($<span class="number">0</span>)&#125;)</div><div class="line">          .disposed(by: disposeBag)</div><div class="line">    </div><div class="line">oriSubject.onNext(<span class="number">1</span>)</div><div class="line">oriSubject.onNext(<span class="number">2</span>)</div><div class="line">    </div><div class="line">refreSubject.onNext(<span class="number">10</span>)</div><div class="line">oriSubject.onNext(<span class="number">3</span>)</div><div class="line">oriSubject.onNext(<span class="number">4</span>)</div><div class="line"></div><div class="line"><span class="comment">//打印结果:</span></div><div class="line"><span class="number">3</span></div><div class="line"><span class="number">4</span></div></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    



    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/19/RxSwift/Demo/Swift-RxSwift-转换操作符/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="千夜 QQ:738816656">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="千夜、おれはおまえをずっと爱している">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/19/RxSwift/Demo/Swift-RxSwift-转换操作符/" itemprop="url">Swift-RxSwift-转换操作符</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-19T16:02:50+08:00">
                2017-12-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Swift/" itemprop="url" rel="index">
                    <span itemprop="name">Swift</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Swift/RxSwift/" itemprop="url" rel="index">
                    <span itemprop="name">RxSwift</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://blog.csdn.net/xiaochuanding/article/details/53727426" target="_blank" rel="external">这是java</a><br>Buffer():<br>2.map() flatMap()<br>3.concatMap()<br>4.switchMap():<br>5.cast():<br>6.groupBy():<br>7.scan():<br>8.window():</p>

          
        
      
    </div>
    
    
    

    



    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/19/RxSwift/Grammar/线程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="千夜 QQ:738816656">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="千夜、おれはおまえをずっと爱している">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/19/RxSwift/Grammar/线程/" itemprop="url">Swift-RxSwift-线程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-19T14:04:51+08:00">
                2017-12-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Swift/" itemprop="url" rel="index">
                    <span itemprop="name">Swift</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Swift/RxSwift/" itemprop="url" rel="index">
                    <span itemprop="name">RxSwift</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#线程</p>
<h2 id="线程切换"><a href="#线程切换" class="headerlink" title="线程切换"></a>线程切换</h2><blockquote>
<p>RxSwift 中切换线程</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">sequence1</div><div class="line">.observeOn(backgroundScheduler) <span class="comment">// 切换到后台线程</span></div><div class="line">.<span class="built_in">map</span> &#123; n <span class="keyword">in</span></div><div class="line">    <span class="built_in">print</span>(<span class="string">"在 background scheduler 执行"</span>)</div><div class="line">&#125;</div><div class="line">.observeOn(<span class="type">MainScheduler</span>.instance) <span class="comment">// 切换到主线程</span></div><div class="line">.<span class="built_in">map</span> &#123; n <span class="keyword">in</span></div><div class="line">    <span class="built_in">print</span>(<span class="string">"在 main scheduler"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>调用一下 observeOn 就切换到我们想要的线程了<br>当前的线程切换支持 GCD 和 NSOperation<br>在线程这部分主要有两个操作符：observeOn 和 subscribeOn ，常用的还是 observeOn</p>
</blockquote>
<ul>
<li>调用 observeOn 指定接下来的操作在哪个线程</li>
<li>调用 subscribeOn 决定订阅者的操作执行在哪个线程</li>
</ul>
<blockquote>
<p>当然，如果我们没有明确调用这两个操作，后面的操作都是在当前线程执行的</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   <span class="class"><span class="keyword">extension</span> <span class="title">ObservableType</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">observeOn</span><span class="params">(scheduler: ImmediateSchedulerType)</span></span> -&gt; <span class="type">RxSwift</span>.<span class="type">Observable</span>&lt;<span class="type">Self</span>.<span class="type">E</span>&gt;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">subscribeOn</span><span class="params">(scheduler: ImmediateSchedulerType)</span></span> -&gt; <span class="type">RxSwift</span>.<span class="type">Observable</span>&lt;<span class="type">Self</span>.<span class="type">E</span>&gt;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>两个方法的声明几乎都是一样的，我们只需要传入一个满足 ImmediateSchedulerType 协议的东西</p>
</blockquote>
<h2 id="MainScheduler-串行"><a href="#MainScheduler-串行" class="headerlink" title="MainScheduler 串行"></a>MainScheduler 串行</h2><blockquote>
<p>在 Rx 中我们已经有主线程切换</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">.observeOn(<span class="type">MainScheduler</span>.instance)<span class="comment">//切换到了主线程</span></div></pre></td></tr></table></figure>
<blockquote>
<p>MainScheduler 有一个很有用的功能</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">ensureExecutingOnScheduler</span>()</span></div></pre></td></tr></table></figure>
<blockquote>
<p>可以在需要保证代码一定执行在主线程的地方调用 MainScheduler.ensureExecutingOnScheduler()<br>特别是在线程切换来切换去的情况下，或者是调用其他的库，我们不确定当前是否在执行在主线程<br>毕竟 UI 的更新还是要在主线程执行的</p>
</blockquote>
<h2 id="SerialDispatchQueueScheduler-串行"><a href="#SerialDispatchQueueScheduler-串行" class="headerlink" title="SerialDispatchQueueScheduler 串行"></a>SerialDispatchQueueScheduler 串行</h2><ul>
<li>SerialDispatchQueueScheduler ，这个就是一个串行的调度器，上面的 MainScheduler 就是继承的这个</li>
</ul>
<blockquote>
<p>DispatchQueueSchedulerQOS<br>iOS 8 新增加了 QOS ，分别有以下五种等级：</p>
</blockquote>
<ul>
<li>QOS_CLASS_USER_INTERACTIVE</li>
<li>QOS_CLASS_USER_INITIATED</li>
<li>QOS_CLASS_DEFAULT</li>
<li>QOS_CLASS_UTILITY</li>
<li>QOS_CLASS_BACKGROUND</li>
</ul>
<blockquote>
<p>在 Rx 中，我们用 enum 创建了 DispatchQueueSchedulerQOS ：</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   <span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">DispatchQueueSchedulerQOS</span> </span>&#123;</div><div class="line">    <span class="keyword">case</span> <span class="type">UserInteractive</span></div><div class="line">    <span class="keyword">case</span> <span class="type">UserInitiated</span></div><div class="line">    <span class="keyword">case</span> <span class="type">Default</span></div><div class="line">    <span class="keyword">case</span> <span class="type">Utility</span></div><div class="line">    <span class="keyword">case</span> <span class="type">Background</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>和上面的等级是一一对应的<br>用 QOS 创建一个 DispatchQueueSchedulerQOS 非常方便</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">convenience</span> <span class="keyword">init</span>(globalConcurrentQueueQOS: <span class="type">DispatchQueueSchedulerQOS</span>, </div><div class="line">internalSerialQueueName: <span class="type">String</span> = <span class="string">"rx.global_dispatch_queue.serial"</span>)</div></pre></td></tr></table></figure>
<blockquote>
<p>用一个初始化就 OK ：</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line"><span class="type">SerialDispatchQueueScheduler</span>(globalConcurrentQueueQOS: .<span class="type">Background</span>)</div></pre></td></tr></table></figure>
<ul>
<li>更推荐你使用已有的 QOS 管理多线程问题，毕竟这是一个线程等级更明确的方案。即便是创建自己的 GCD 我也建议直接使用 SerialDispatchQueueScheduler ，毕竟自己再去实现那些协议很麻烦不是吗</li>
</ul>
<blockquote>
<p>可以通过以下两种方式创建自己的 GCD ：</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">  <span class="keyword">public</span> <span class="keyword">convenience</span> <span class="keyword">init</span>(internalSerialQueueName: <span class="type">String</span>, serialQueueConfiguration: ((dispatch_queue_t) -&gt; <span class="type">Void</span>)? = <span class="literal">nil</span>)</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">convenience</span> <span class="keyword">init</span>(queue: dispatch_queue_t, internalSerialQueueName: <span class="type">String</span>)</div></pre></td></tr></table></figure>
<blockquote>
<p>MainScheduler 是继承 SerialDispatchQueueScheduler 的</p>
</blockquote>
<h2 id="ConcurrentDispatchQueueScheduler-并行"><a href="#ConcurrentDispatchQueueScheduler-并行" class="headerlink" title="ConcurrentDispatchQueueScheduler 并行"></a>ConcurrentDispatchQueueScheduler 并行</h2><blockquote>
<p>同样我们还有一个并行的 Scheduler ：ConcurrentDispatchQueueScheduler<br>API 的使用和 SerialDispatchQueueScheduler 是一样的</p>
</blockquote>
<h2 id="OperationQueueScheduler-并行"><a href="#OperationQueueScheduler-并行" class="headerlink" title="OperationQueueScheduler 并行"></a>OperationQueueScheduler 并行</h2><blockquote>
<p>使用 NSOperationQueue 最大的好处就是我们可以很方便的定制最大并发线程数量，即设置 maxConcurrentOperationCount<br>创建方法也很简单，只需要传入一个 NSOperationQueue</p>
</blockquote>
<p>难懂啊</p>
<p><a href="http://t.swift.gg/t/rxswift-course" target="_blank" rel="external">原文</a></p>

          
        
      
    </div>
    
    
    

    



    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/19/RxSwift/Grammar/Operators-转换操作符/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="千夜 QQ:738816656">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="千夜、おれはおまえをずっと爱している">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/19/RxSwift/Grammar/Operators-转换操作符/" itemprop="url">Swift-RxSwift-操作</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-19T13:16:33+08:00">
                2017-12-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Swift/" itemprop="url" rel="index">
                    <span itemprop="name">Swift</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Swift/RxSwift/" itemprop="url" rel="index">
                    <span itemprop="name">RxSwift</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li><a href="#1.1">①map</a></li>
<li><a href="#1.2">②flatMap</a></li>
<li><a href="#1.3">③flatMapLatest</a></li>
<li><a href="#1.4">④scan</a></li>
</ul>
<h1 id="变换操作"><a href="#变换操作" class="headerlink" title="变换操作"></a>变换操作</h1><p><span id="1.1">①map </span></p>
<h2 id="①map"><a href="#①map" class="headerlink" title="①map"></a>①map</h2><blockquote>
<p>通过使用一个闭包函数将原来的Observable序列sequence转换为一个新的Observable序列sequence</p>
</blockquote>
<p><img src="http://ot0mms4k8.bkt.clouddn.com/map-001.png" alt="map"></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line"><span class="type">Observable</span>.of(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</div><div class="line">			.<span class="built_in">map</span>(&#123;</div><div class="line">			      <span class="keyword">return</span> <span class="number">10</span> * $<span class="number">0</span></div><div class="line">			     &#125;)</div><div class="line">			.subscribe(&#123;<span class="built_in">print</span>($<span class="number">0</span>)&#125;)</div><div class="line">			.disposed(by: disposeBag)</div><div class="line"></div><div class="line"><span class="comment">//打印</span></div><div class="line">next(<span class="number">10</span>)</div><div class="line">next(<span class="number">20</span>)</div><div class="line">next(<span class="number">30</span>)</div><div class="line">completed</div></pre></td></tr></table></figure>
<p><span id="1.2">②flatMap </span></p>
<h2 id="②flatMap"><a href="#②flatMap" class="headerlink" title="②flatMap"></a>②flatMap</h2><blockquote>
<p>将一个sequence转换为一个sequences，当你接收一个sequence的事件，你还想接收其他sequence发出的事件的话可以使用flatMap，她会将每一个sequence事件进行处理以后，然后再以一个sequence形式发出事件<br>而且flatMap有一次拆包动作<br>将一个Observable序列转换为另一个Observable序列，并且合并两个Observable序列。会按时间顺序接收两个序列发出的元素</p>
</blockquote>
<p><img src="" alt="flatMap"></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">sttuct <span class="type">Player</span>&#123;</div><div class="line">  <span class="keyword">var</span> score: <span class="type">Variable</span>&lt;<span class="type">Int</span>&gt; <span class="comment">//里面是一个Variable</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">let</span> 👦🏻 = <span class="type">Player</span>(score: <span class="type">Variable</span>(<span class="number">80</span>))      </div><div class="line"><span class="keyword">let</span> 👧🏼 = <span class="type">Player</span>(score: <span class="type">Variable</span>(<span class="number">90</span>))</div><div class="line"><span class="keyword">let</span> 😂 = <span class="type">Player</span>(score: <span class="type">Variable</span>(<span class="number">550</span>))</div><div class="line"><span class="keyword">let</span> player = <span class="type">Variable</span>(👦🏻)  <span class="comment">//将player转为Variable</span></div><div class="line">player.asObservable()       <span class="comment">//拆箱转成可被监听的sequence</span></div><div class="line">     .flatMap &#123;</div><div class="line">              $<span class="number">0</span>.score.asObservable() </div><div class="line">             &#125; <span class="comment">// flatMap有一次拆包动作，$0本来应该是一个BehaviorSubject类型，但是直接访问了score。所以猜想flatMap对behaviorSubject进行了onNext拆包取数据</span></div><div class="line">    .subscribe(onNext: &#123; </div><div class="line">                <span class="built_in">print</span>($<span class="number">0</span>)</div><div class="line">               &#125;)</div><div class="line">    .addDisposableTo(disposeBag)</div><div class="line">    👦🏻.score.value = <span class="number">85</span></div><div class="line">	player.value = 👧🏼 <span class="comment">//更换了value，相当于又添加了一个sequence，两个sequence都可以接收</span></div><div class="line">	👦🏻.score.value = <span class="number">95</span></div><div class="line">	👦🏻.score.value = <span class="number">222</span></div><div class="line">	player.value = 😂</div><div class="line">	    </div><div class="line">	👧🏼.score.value = <span class="number">100</span></div><div class="line"></div><div class="line"><span class="comment">//</span></div><div class="line">	<span class="number">80</span></div><div class="line">	<span class="number">85</span></div><div class="line">	<span class="number">90</span></div><div class="line">	<span class="number">95</span></div><div class="line">	<span class="number">222</span></div><div class="line">	<span class="number">550</span></div><div class="line">	<span class="number">100</span></div></pre></td></tr></table></figure>
<p><span id="1.3">③flatMapLatest </span></p>
<h2 id="③flatMapLatest"><a href="#③flatMapLatest" class="headerlink" title="③flatMapLatest"></a>③flatMapLatest</h2><blockquote>
<p>flatMapLatest只会接收最新的value事件，将上例改为flatMapLatest。结果为</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line"><span class="number">80</span></div><div class="line"><span class="number">85</span></div><div class="line"><span class="number">90</span></div><div class="line"><span class="number">550</span></div></pre></td></tr></table></figure>
<p><span id="1.4">④scan </span></p>
<h2 id="④scan"><a href="#④scan" class="headerlink" title="④scan"></a>④scan</h2><blockquote>
<p>scan就是给一个初始化的数，然后不断的拿前一个结果和最新的值进行处理操作</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line"><span class="type">Observable</span>.of(<span class="number">10</span>,<span class="number">100</span>,<span class="number">1000</span>)</div><div class="line">         .scan(<span class="number">1</span>)&#123;aggregateValue, newValue <span class="keyword">in</span></div><div class="line">    aggregateValue + newValue&#125;</div><div class="line">         .subscribe(onNext: &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;)</div><div class="line">         .addDisposableTo(disposeBag)</div><div class="line"><span class="comment">//</span></div><div class="line"><span class="number">11</span></div><div class="line"><span class="number">111</span></div><div class="line"><span class="number">1111</span></div></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    



    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/19/RxSwift/Grammar/Operators-联合操作Observable流/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="千夜 QQ:738816656">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="千夜、おれはおまえをずっと爱している">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/19/RxSwift/Grammar/Operators-联合操作Observable流/" itemprop="url">Swift-RxSwift-Combination Operators-联合操作Observable流</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-19T13:13:56+08:00">
                2017-12-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Swift/" itemprop="url" rel="index">
                    <span itemprop="name">Swift</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Swift/RxSwift/" itemprop="url" rel="index">
                    <span itemprop="name">RxSwift</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li><a href="#1">联合操作Observable流</a></li>
<li><a href="#1.1">①startWith</a></li>
<li><a href="#②merge">②merge</a></li>
<li><a href="#1.3">③zip</a></li>
<li><a href="#1.4">④combineLatest</a></li>
<li><a href="#1.5">⑤switchLatest</a></li>
</ul>
<p><span id="1">联合操作Observable流</span></p>
<h1 id="联合操作Observable流"><a href="#联合操作Observable流" class="headerlink" title="联合操作Observable流"></a>联合操作Observable流</h1><blockquote>
<p>联合操作就是把多个<strong>Observable流</strong>合成<strong>单个Observable流</strong></p>
</blockquote>
<ul>
<li>①startWith (优先插入特定的事件消息)</li>
<li>②merge （组合成单个Observable,并且按照时间顺序发射对应事件）</li>
<li>③zip （一个事件对应另一个流一个事件）</li>
<li>④combineLatest （一个流的事件对应另一个流的最新的事件）</li>
<li>⑤switchLatest (事件流进行转换)</li>
</ul>
<p><span id="1.1">①startWith</span></p>
<h2 id="①startWith"><a href="#①startWith" class="headerlink" title="①startWith"></a>①startWith</h2><blockquote>
<p>在发出事件消息之前，先发出某个特定的事件消息。<br>比如发出事件2 ，3然后我startWith(1)，那么就会先发出1，然后2 ，3</p>
</blockquote>
<p><img src="http://ozr735s7e.bkt.clouddn.com/startWith.png" alt="startWith"></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line"><span class="type">Observable</span>.of(<span class="string">"2"</span>,<span class="string">"3"</span>)</div><div class="line">         .startWith(<span class="string">"1"</span>)</div><div class="line">         .subscribe(onNext:&#123;</div><div class="line">                      <span class="built_in">print</span>($<span class="number">0</span>)</div><div class="line">                      &#125;)</div><div class="line">         .addDisposableTo(disposeBag)</div><div class="line"><span class="comment">//</span></div><div class="line"><span class="number">1</span></div><div class="line"><span class="number">2</span></div><div class="line"><span class="number">3</span></div></pre></td></tr></table></figure>
<blockquote>
<p>在Observable释放元素之前，发射指定的元素序列<br>startWith和栈类似，先进后出<br>在发送一个东西前，先发送一个指定的</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">let disposeBag = DisposeBag()</div><div class="line">Observable.of([&quot;C&quot;,&quot;C++&quot;,&quot;OC&quot;])</div><div class="line">          .startWith([&quot;今晚吃鸡，大吉大利&quot;])</div><div class="line">          .subscribe(&#123; (event) in</div><div class="line">                 print(event)</div><div class="line">            &#125;)</div><div class="line">          .disposed(by: disposeBag)</div><div class="line">//打印</div><div class="line">next([&quot;今晚吃鸡，大吉大利&quot;])</div><div class="line">next([&quot;C&quot;, &quot;C++&quot;, &quot;OC&quot;])</div><div class="line">completed</div></pre></td></tr></table></figure>
<p><span id="1.2">②merge</span></p>
<h2 id="②merge"><a href="#②merge" class="headerlink" title="②merge"></a>②merge</h2><blockquote>
<p>将多个Observable组合成单个Observable,并且按照时间顺序发射对应事件</p>
</blockquote>
<p><img src="http://ozr735s7e.bkt.clouddn.com/merge.png" alt="merge"></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line"><span class="keyword">let</span> sbj1 = <span class="type">PublishSubject</span>&lt;<span class="type">String</span>&gt;()</div><div class="line"><span class="keyword">let</span> sbj2 = <span class="type">PublishSubject</span>&lt;<span class="type">String</span>&gt;()</div><div class="line"><span class="type">Observable</span>.of(sbj1,sbj2)</div><div class="line">          .merge()</div><div class="line">          .subscribe(onNext: &#123; </div><div class="line">                    <span class="built_in">print</span>($<span class="number">0</span>)</div><div class="line">               &#125;)</div><div class="line">          .addDisposableTo(disposeBag)</div><div class="line">subject1.onNext(<span class="string">"🅰️"</span>)</div><div class="line">subject1.onNext(<span class="string">"🅱️"</span>)</div><div class="line">subject2.onNext(<span class="string">"①"</span>)</div><div class="line">subject2.onNext(<span class="string">"②"</span>)</div><div class="line">subject1.onNext(<span class="string">"🆎"</span>)</div><div class="line">subject2.onNext(<span class="string">"③"</span>)</div><div class="line">   </div><div class="line"><span class="comment">//</span></div><div class="line">🅰️</div><div class="line">🅱️</div><div class="line">①</div><div class="line">②</div><div class="line">🆎</div><div class="line">③</div></pre></td></tr></table></figure>
<p><span id="1.3">③zip</span></p>
<h2 id="③zip"><a href="#③zip" class="headerlink" title="③zip"></a>③zip</h2><blockquote>
<p>绑定超过最多不超过8个的Observable流，结合在一起处理<br>注意Zip是一个事件对应另一个流一个事件<br>将多个Observable(注意：必须是要成对)组合成单个Observable，当有事件到达时，会在每个序列中对应的索引上对应的元素发出。(ps:之前版本的RxSwift好像最多只能组合8个Observable)</p>
</blockquote>
<p><a href="http://reactivex.io/documentation/operators/zip.html" target="_blank" rel="external">zip-文档</a></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line"> </div><div class="line"><span class="keyword">let</span> strSbj = <span class="type">PublishSubject</span>&lt;<span class="type">String</span>&gt;()</div><div class="line"><span class="keyword">let</span> intSbj = <span class="type">PublishSubject</span>&lt;<span class="type">Int</span>&gt;()</div><div class="line">   </div><div class="line"><span class="type">Observable</span>.<span class="built_in">zip</span>(strSbj, intSbj)&#123;</div><div class="line">				  strElement,intElement  <span class="keyword">in</span> </div><div class="line">				  <span class="string">"\(strElement) \(intElement)"</span></div><div class="line">				 &#125;</div><div class="line">         .subscribe(<span class="type">OnNext</span>: &#123;</div><div class="line">                   pint($<span class="number">0</span>)</div><div class="line">              &#125;)</div><div class="line">         .addDisposableTo(disposeBag)</div><div class="line">   </div><div class="line">strSbj.onNext(<span class="string">"🅰️"</span>)</div><div class="line">strSbj.onNext(<span class="string">"🅱️"</span>)</div><div class="line">   </div><div class="line">intSbj.onNext(<span class="number">1</span>)</div><div class="line">intSbj.onNext(<span class="number">2</span>)</div><div class="line">   </div><div class="line">strSbj.onNext(<span class="string">"🆎"</span>)</div><div class="line">intSbj.onNext(<span class="number">2</span>)</div><div class="line">   </div><div class="line"><span class="comment">//</span></div><div class="line">🅰️ <span class="number">1</span>   将stringSubject和intSubject压缩到一起共同处理</div><div class="line">🅱️ <span class="number">2</span></div><div class="line">🆎 <span class="number">3</span></div></pre></td></tr></table></figure>
<p><span id="1.4">④combineLatest</span></p>
<h2 id="④combineLatest"><a href="#④combineLatest" class="headerlink" title="④combineLatest"></a>④combineLatest</h2><blockquote>
<p>绑定超过最多不超过8个的Observable流，结合在一起处理<br>和Zip不同的是combineLatest是一个流的事件对应另一个流的最新的事件，两个事件都会是最新的事件，可将下图与Zip的图进行对比<br>邻近事件一起处理</p>
</blockquote>
<p><img src="http://ozr735s7e.bkt.clouddn.com/combineLatest.png" alt="combineLatest"></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line"><span class="keyword">let</span> strSbj = <span class="type">PublishSubject</span>&lt;<span class="type">String</span>&gt;()</div><div class="line"><span class="keyword">let</span> intSbj = <span class="type">PublishSubject</span>&lt;<span class="type">Int</span>&gt;()</div><div class="line">   </div><div class="line"><span class="type">Observable</span>.combineLatest(strSbj, intSbj)&#123; strElement,intElement <span class="keyword">in</span></div><div class="line">                     <span class="string">"\(strElement) \(intElement)"</span></div><div class="line">              &#125;</div><div class="line">         .addscribe(onNext: &#123;<span class="built_in">print</span>(</div><div class="line">                   $<span class="number">0</span>)</div><div class="line">                 &#125;)</div><div class="line">         .addDisposableTo(disposeBag)</div><div class="line">   </div><div class="line">strSbj.onNext(<span class="string">"🅰️"</span>)</div><div class="line">strSbj.onNext(<span class="string">"🅱️"</span>)</div><div class="line">intSbj.onNext(<span class="number">1</span>)</div><div class="line">intSbj.onNext(<span class="number">2</span>)</div><div class="line">strSbj.onNext(<span class="string">"🆎"</span>)</div><div class="line"></div><div class="line"><span class="comment">// 输出</span></div><div class="line">🅱️ <span class="number">1</span></div><div class="line">🅱️ <span class="number">2</span></div><div class="line">🆎 <span class="number">2</span></div></pre></td></tr></table></figure>
<blockquote>
<p>当一个项目由两个Observables发射时，通过一个指定的功能将每个Observable观察到的最新项目组合起来，并根据该功能的结果发射事件</p>
</blockquote>
<p><img src="http://ot0mms4k8.bkt.clouddn.com/Combination-Operators-4-2.png" alt=""></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line"></div><div class="line"><span class="keyword">let</span> subject1 = <span class="type">PublishSubject</span>&lt;<span class="type">String</span>&gt;()</div><div class="line"><span class="keyword">let</span> subject2 = <span class="type">PublishSubject</span>&lt;<span class="type">String</span>&gt;()</div><div class="line">	    </div><div class="line"><span class="type">Observable</span>.combineLatest(subject1, subject2) &#123; string1,string2 <span class="keyword">in</span></div><div class="line">                <span class="string">"\(string1)--\(string2)"</span></div><div class="line">              &#125;</div><div class="line">		    .subscribe(onNext: &#123;</div><div class="line">		            <span class="built_in">print</span>($<span class="number">0</span>)</div><div class="line">		            &#125;)</div><div class="line">		    .disposed(by: disposeBag)</div><div class="line">	    </div><div class="line">subject1.onNext(<span class="string">"A"</span>)</div><div class="line">    </div><div class="line">subject2.onNext(<span class="string">"1"</span>)</div><div class="line">subject2.onNext(<span class="string">"2"</span>)</div><div class="line">    </div><div class="line">subject1.onNext(<span class="string">"B"</span>)</div><div class="line">subject1.onNext(<span class="string">"C"</span>)</div><div class="line">	</div><div class="line"><span class="comment">//输出结果</span></div><div class="line"><span class="type">A</span>--<span class="number">1</span></div><div class="line"><span class="type">A</span>--<span class="number">2</span></div><div class="line"><span class="type">B</span>--<span class="number">2</span></div><div class="line"><span class="type">C</span>--<span class="number">2</span></div></pre></td></tr></table></figure>
<p><span id="1.5">⑤switchLatest</span></p>
<h2 id="⑤switchLatest"><a href="#⑤switchLatest" class="headerlink" title="⑤switchLatest"></a>⑤switchLatest</h2><blockquote>
<p>切换Observable队列<br>switchLatest可以对事件流进行转换，本来监听的sbj1，可以通过更改variable里面的value更换事件源—&gt;变成监听sbj2</p>
</blockquote>
<p><img src="http://ozr735s7e.bkt.clouddn.com/switchLatest.png" alt="hexo"></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line"></div><div class="line"><span class="keyword">let</span> sbj1 = <span class="type">BehaviorSubject</span>(value: <span class="string">"⚽️"</span>)</div><div class="line"><span class="keyword">let</span> sbj2 = <span class="type">BehaviorSubject</span>(value: <span class="string">"🍎"</span>)</div><div class="line">   </div><div class="line"><span class="keyword">let</span> variable = <span class="type">Variable</span>(sbj1)</div><div class="line">variable.asObservable()</div><div class="line">        .switchLatest()</div><div class="line">        .subscribe(onNext: &#123; </div><div class="line">                     <span class="built_in">print</span>($<span class="number">0</span>) </div><div class="line">                 &#125;)</div><div class="line">        .addDisposableTo(disposeBag)</div><div class="line">    </div><div class="line">sbj1.onNext(<span class="string">"🏈"</span>)</div><div class="line">sbj1.onNext(<span class="string">"🏀"</span>)</div><div class="line">	    </div><div class="line">variable.value = sbj1</div><div class="line">	    </div><div class="line">subject1.onNext(<span class="string">"⚾️"</span>)</div><div class="line">	    </div><div class="line">sbj2.onNext(<span class="string">"🍐"</span>)</div><div class="line">variable.value = sbj1</div><div class="line">sbj2.onNext(<span class="string">"54321"</span>)</div><div class="line">sbj1.onNext(<span class="string">"12345"</span>)</div><div class="line">   <span class="comment">///</span></div><div class="line">⚽️</div><div class="line">🏈</div><div class="line">🏀</div><div class="line">🍎</div><div class="line">🍐</div><div class="line">⚾️</div><div class="line"><span class="number">12345</span></div></pre></td></tr></table></figure>
<blockquote>
<p>例子分析</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line"> et disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">    </div><div class="line"><span class="keyword">let</span> subject1 = <span class="type">BehaviorSubject</span>(value: <span class="string">"1"</span>)</div><div class="line"><span class="keyword">let</span> subject2 = <span class="type">BehaviorSubject</span>(value: <span class="string">"A"</span>)</div><div class="line">    </div><div class="line"><span class="keyword">let</span> variable = <span class="type">Variable</span>(subject1)</div><div class="line">    </div><div class="line">variable.asObservable()</div><div class="line">        .switchLatest()</div><div class="line">        .subscribe(onNext: &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;)</div><div class="line">        .disposed(by: disposeBag)</div><div class="line">    </div><div class="line">subject1.onNext(<span class="string">"2"</span>)</div><div class="line">subject1.onNext(<span class="string">"3"</span>)</div><div class="line">    </div><div class="line">variable.value = subject2</div><div class="line">    </div><div class="line">subject1.onNext(<span class="string">"4"</span>)</div><div class="line">subject2.onNext(<span class="string">"B"</span>)</div><div class="line"></div><div class="line"><span class="comment">//打印结果</span></div><div class="line"><span class="number">1</span></div><div class="line"><span class="number">2</span></div><div class="line"><span class="number">3</span></div><div class="line"><span class="type">A</span></div><div class="line"><span class="type">B</span></div></pre></td></tr></table></figure>
<p><img src="http://ot0mms4k8.bkt.clouddn.com/switchLatest-002.png" alt=""></p>

          
        
      
    </div>
    
    
    

    



    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/18/RxSwift/Grammar/进阶理解/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="千夜 QQ:738816656">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="千夜、おれはおまえをずっと爱している">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/18/RxSwift/Grammar/进阶理解/" itemprop="url">Swift-RxSwift-进阶理解</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-18T13:32:21+08:00">
                2017-12-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Disposing"><a href="#Disposing" class="headerlink" title="Disposing"></a>Disposing</h1><p>   当监听一个事件序列的时候，有消息事件来了，我们做某些事情<br>   但是这个事件序列不再发出消息了，我们的监听也就没有什么存在价值了，所以我们需要释放我们这些监听资源，其实也就是每种编程语言中的内存资源释放<br>   OC和Swift中也一样，在你不需要用某些变量的时候，你需要把这些变量所占用的内存空间释放掉</p>
<blockquote>
<p>释放某一个监听的时候我们可以手动调用释放方法，但是这个貌似一般不常用：</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   <span class="comment">// 关于scheduler，我们会在下面讲到</span></div><div class="line"><span class="keyword">let</span> subscription = <span class="type">Observable</span>&lt;<span class="type">Int</span>&gt;.interval(<span class="number">0.3</span>, scheduler: <span class="type">SerialDispatchQueueScheduler</span>.<span class="keyword">init</span>(internalSerialQueueName: <span class="string">"test"</span>))</div><div class="line">    .observeOn(<span class="type">MainScheduler</span>.instance)	<span class="comment">//observeOn也会在下面讲到</span></div><div class="line">    .subscribe &#123; event <span class="keyword">in</span></div><div class="line">        <span class="built_in">print</span>(event)</div><div class="line">&#125;</div><div class="line">    </div><div class="line"><span class="type">Thread</span>.sleep(forTimeInterval: <span class="number">2.0</span>)</div><div class="line">    </div><div class="line">subscription.dispose()</div><div class="line"></div><div class="line">	<span class="comment">//</span></div><div class="line">	next(<span class="number">0</span>)</div><div class="line">	next(<span class="number">1</span>)</div><div class="line">	next(<span class="number">2</span>)</div><div class="line">	next(<span class="number">3</span>)</div><div class="line">	next(<span class="number">4</span>)</div><div class="line">	next(<span class="number">5</span>)</div></pre></td></tr></table></figure>
<p>比如上面这个例子，我们创建了一个subscription监听，在两秒以后我们不需要了，手动调用dispose()方法，就能释放监听资源，不再打印信息。上面的subscription不伦是在哪个线程中监听，就算在主线程中调用的dispose()方法一样会销毁资源</p>
<h1 id="Dispose-Bag"><a href="#Dispose-Bag" class="headerlink" title="Dispose Bag"></a>Dispose Bag</h1><p>还有一种是自动的方式，推荐大家使用这种方式，这种方式就好像iOS中的ARC方式似得，会自动去释放资源</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   <span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">   </div><div class="line"><span class="type">Observable</span>&lt;<span class="type">Int</span>&gt;.empty()</div><div class="line">   .subscribe &#123; event <span class="keyword">in</span></div><div class="line">       <span class="built_in">print</span>(event)</div><div class="line">   &#125;</div><div class="line">   .addDisposableTo(disposeBag)</div></pre></td></tr></table></figure>
<p>如上个例子，我们创建一个disposeBag来盛放我们需要管理的资源，然后把新建的监听都放进去，会在适当的时候销毁这些资源。如果你需要立即释放资源只需要新建一个DisposeBag()，那么上一个DisposeBag就会被销毁</p>
<h1 id="observeOn-和subscribeOn"><a href="#observeOn-和subscribeOn" class="headerlink" title="observeOn()和subscribeOn()"></a>observeOn()和subscribeOn()</h1><p>区别其实我感觉其实就一句话，subscribeOn()设置起点在哪个线程，observeOn()设置了后续工作在哪个线程</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">someObservable </div><div class="line"> .doOneThing() ①</div><div class="line"> .observeOn(<span class="type">MainRouteScheduler</span>.instance) ②</div><div class="line"> .subscribeOn(<span class="type">OtherScheduler</span>.instance) ③</div><div class="line"> .subscribeNext &#123; ④</div><div class="line"> 	......</div><div class="line"> &#125;</div><div class="line"> .addDisposableTo(disposeBag)</div></pre></td></tr></table></figure>
<p> ① 所有动作都发生在当前的默认线程<br> ② observeOn转换线程到主线程，下面所有的操作都是在主线程中<br> ③ subscribeOn规定动作一开始不是发生在默认线程了，而是在OtherScheduler了<br> ④ 如果我们之前没有调用observeOn，那么这边会在OtherScheduler发生，但是我们前面调用了observeOn，所以这个动作会在主线程中调用</p>
<ul>
<li>subscribeOn只是影响事件链开始默认的线程，而observeOn规定了下一步动作发生在哪个线程中</li>
</ul>
<h1 id="shareReplay"><a href="#shareReplay" class="headerlink" title="shareReplay"></a>shareReplay</h1><figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   <span class="keyword">let</span> testReplay = <span class="type">Observable</span>.just(<span class="string">"😂"</span>)</div><div class="line">    .<span class="built_in">map</span> &#123;  <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    </div><div class="line">testReplay</div><div class="line">    .subscribe &#123; event <span class="keyword">in</span></div><div class="line">        <span class="built_in">print</span>(event)</div><div class="line">&#125;.addDisposableTo(disposeBag)</div><div class="line">    </div><div class="line">testReplay</div><div class="line">    .subscribe &#123; event <span class="keyword">in</span></div><div class="line">        <span class="built_in">print</span>(event)</div><div class="line">&#125;.addDisposableTo(disposeBag)</div><div class="line"></div><div class="line"><span class="comment">///</span></div><div class="line">   😂</div><div class="line">	next(())</div><div class="line">	completed</div><div class="line">	😂</div><div class="line">	next(())</div><div class="line">	completed</div></pre></td></tr></table></figure>
<p>大家发现没，map函数执行了两遍，但是有些时候我不需要map函数里的东西执行两遍，比如map函数里面如果执行的是网络请求，我只需要一次请求结果供大家使用就行了，多余的请求没啥用，浪费时间。所以这时候就需要shareReplay(1)了。这里面的数字一般都是1，只执行一次。你可以改为2，3看看结果有啥不同哦。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">  <span class="keyword">let</span> testReplay = <span class="type">Observable</span>.just(<span class="string">"😂"</span>)</div><div class="line">    .<span class="built_in">map</span> &#123;  <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .shareReplay(<span class="number">1</span>)</div><div class="line">    </div><div class="line">testReplay</div><div class="line">    .subscribe &#123; event <span class="keyword">in</span></div><div class="line">        <span class="built_in">print</span>(event)</div><div class="line">&#125;.addDisposableTo(disposeBag)</div><div class="line">    </div><div class="line">testReplay</div><div class="line">    .subscribe &#123; event <span class="keyword">in</span></div><div class="line">        <span class="built_in">print</span>(event)</div><div class="line">&#125;.addDisposableTo(disposeBag)</div><div class="line"></div><div class="line"><span class="comment">///</span></div><div class="line">  😂 <span class="comment">//只执行了一次</span></div><div class="line">  next(())</div><div class="line">  completed</div><div class="line">  next(())</div><div class="line">  completed</div></pre></td></tr></table></figure>
<h1 id="自定义operator"><a href="#自定义operator" class="headerlink" title="自定义operator"></a>自定义operator</h1><p>   自定义操作符很简单，官方推荐尽量用标准的操作符，但是你也可以自定义自己的操作符，文档上说有两种方法，这里我们只说一下最常用的一种方法</p>
<blockquote>
<p>自定义一个map操作符</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   <span class="class"><span class="keyword">extension</span> <span class="title">ObservableType</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">myMap</span>&lt;R&gt;<span class="params">(transform: E -&gt; R)</span></span> -&gt; <span class="type">Observable</span>&lt;<span class="type">R</span>&gt; &#123;</div><div class="line">        <span class="keyword">return</span> <span class="type">Observable</span>.create &#123; observer <span class="keyword">in</span></div><div class="line">            <span class="keyword">let</span> subscription = <span class="keyword">self</span>.subscribe &#123; e <span class="keyword">in</span></div><div class="line">                    <span class="keyword">switch</span> e &#123;</div><div class="line">                    <span class="keyword">case</span> .next(<span class="keyword">let</span> value):</div><div class="line">                        <span class="keyword">let</span> result = transform(value)</div><div class="line">                        observer.on(.next(result))</div><div class="line">                    <span class="keyword">case</span> .error(<span class="keyword">let</span> error):</div><div class="line">                        observer.on(.error(error))</div><div class="line">                    <span class="keyword">case</span> .completed:</div><div class="line">                        observer.on(.completed)</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            <span class="keyword">return</span> subscription</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>参数是一个闭包，其中闭包参数是E类型返回值是R类型，map函数的返回值是一个Observable类型</p>
</blockquote>
<h1 id="Driver"><a href="#Driver" class="headerlink" title="Driver"></a>Driver</h1><figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   <span class="keyword">let</span> results = query.rx.text</div><div class="line">    .throttle(<span class="number">0.3</span>, scheduler: <span class="type">MainScheduler</span>.instance)</div><div class="line">    .flatMapLatest &#123; query <span class="keyword">in</span></div><div class="line">        fetchAutoCompleteItems(query)</div><div class="line">    &#125;</div><div class="line">results</div><div class="line">    .<span class="built_in">map</span> &#123; <span class="string">"\($0.count)"</span> &#125;</div><div class="line">    .bindTo(resultCount.rx.text)</div><div class="line">    .addDisposableTo(disposeBag)</div><div class="line">results</div><div class="line">    .bindTo(resultsTableView.rx.items(cellIdentifier: <span class="string">"Cell"</span>)) &#123; (<span class="number">_</span>, result, cell) <span class="keyword">in</span></div><div class="line">        cell.textLabel?.text = <span class="string">"\(result)"</span></div><div class="line">    &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div></pre></td></tr></table></figure>
<ul>
<li>首先创建一个可监听序列results，其中flatMapLatest怎么用我们下面讲</li>
<li>然后将results绑定到resultCount.rx.text上</li>
<li>将results绑定到resultsTableView上</li>
</ul>
<blockquote>
<p>上面程序会有下面几个异常情况</p>
</blockquote>
<ul>
<li>如果上面fetchAutoCompleteItems出错了，那么他绑定的UI将不再收到任何事件消息</li>
<li>如果上面fetchAutoCompleteItems是在后台某个线程中运行的，那么事件绑定也是发生在后台某个线程，这样更新UI的时候会造成crash</li>
<li>有两次绑定fetchAutoCompleteItems会执行两次</li>
</ul>
<p>当然针对上面问题我们也有解决方案，我们可以使用神器shareReplay(1)保证不会执行两次，可以使用observeOn()保证后面所有操作在主线程完成</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   <span class="keyword">let</span> results = query.rx.text</div><div class="line">    .throttle(<span class="number">0.3</span>, scheduler: <span class="type">MainScheduler</span>.instance)</div><div class="line">    .flatMapLatest &#123; query <span class="keyword">in</span></div><div class="line">        fetchAutoCompleteItems(query)</div><div class="line">            .observeOn(<span class="type">MainScheduler</span>.instance)</div><div class="line">            .catchErrorJustReturn([])           </div><div class="line">    &#125;</div><div class="line">    .shareReplay(<span class="number">1</span>)                             </div><div class="line">results</div><div class="line">    .<span class="built_in">map</span> &#123; <span class="string">"\($0.count)"</span> &#125;</div><div class="line">    .bindTo(resultCount.rx.text)</div><div class="line">    .addDisposableTo(disposeBag)</div><div class="line">results</div><div class="line">    .bindTo(resultTableView.rx.items(cellIdentifier: <span class="string">"Cell"</span>)) &#123; (<span class="number">_</span>, result, cell) <span class="keyword">in</span></div><div class="line">        cell.textLabel?.text = <span class="string">"\(result)"</span></div><div class="line">    &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div></pre></td></tr></table></figure>
<blockquote>
<p>但是,也可以使用Driver</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   <span class="keyword">let</span> results = query.rx.text.asDriver()	<span class="comment">//转换成一个Driver序列</span></div><div class="line">    .throttle(<span class="number">0.3</span>, scheduler: <span class="type">MainScheduler</span>.instance)</div><div class="line">    .flatMapLatest &#123; query <span class="keyword">in</span></div><div class="line">        fetchAutoCompleteItems(query)</div><div class="line">            .asDriver(onErrorJustReturn: [])  <span class="comment">//当遇见错误需要返回什么</span></div><div class="line">    &#125;	<span class="comment">//不需要添加shareReplay(1)</span></div><div class="line">results</div><div class="line">    .<span class="built_in">map</span> &#123; <span class="string">"\($0.count)"</span> &#125;</div><div class="line">    .drive(resultCount.rx.text)	<span class="comment">//和bingTo()功能一样</span></div><div class="line">    .addDisposableTo(disposeBag) </div><div class="line">                                             </div><div class="line">results</div><div class="line">    .drive(resultTableView.rx.items(cellIdentifier: <span class="string">"Cell"</span>)) &#123; (<span class="number">_</span>, result, cell) <span class="keyword">in</span></div><div class="line">        cell.textLabel?.text = <span class="string">"\(result)"</span></div><div class="line">    &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div></pre></td></tr></table></figure>
<blockquote>
<p>drive方法只能在Driver序列中使用，Driver有以下特点：<br>① Driver序列不允许发出error<br>② Driver序列的监听只会在主线程中<br>所以Driver是转为UI绑定量身打造的东西。以下情况你可以使用Driver替换BindTo:</p>
</blockquote>
<ul>
<li>不能发出error</li>
<li>在主线程中监听</li>
<li>共享事件流</li>
</ul>
<h1 id="map和flatMap何时使用"><a href="#map和flatMap何时使用" class="headerlink" title="map和flatMap何时使用"></a>map和flatMap何时使用</h1><p>官方Demo的时候，可能会迷惑为啥有的地方使用flatMapLatest为啥有些地方使用map呢？比如上面那个Driver所用的例子</p>
<blockquote>
<p>map函数，接受一个R类型的序列，返回一个R类型的序列，还是原来的序列</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">map</span>&lt;R&gt;<span class="params">(<span class="number">_</span> transform: @escaping <span class="params">(<span class="keyword">Self</span>.E)</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">R</span>) -&gt; <span class="type">RxSwift</span>.<span class="type">Observable</span>&lt;<span class="type">R</span>&gt;</div></pre></td></tr></table></figure>
<blockquote>
<p>flatMap函数，接收一个O类型的序列，返回一个O.E类型的序列，也就是有原来序列里元素组成的新序列</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">flatMap</span>&lt;O : ObservableConvertibleType&gt;<span class="params">(<span class="number">_</span> selector: @escaping <span class="params">(<span class="keyword">Self</span>.E)</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">O</span>) -&gt; <span class="type">RxSwift</span>.<span class="type">Observable</span>&lt;<span class="type">O</span>.<span class="type">E</span>&gt;</div></pre></td></tr></table></figure>
<p>其实这里的map和flatMap在swift中的作用是一样的。map函数可以对原有序列里面的事件元素进行改造，返回的还是原来的序列。而flatMap对原有序列中的元素进行改造和处理，每一个元素返回一个新的sequence，然后把每一个元素对应的sequence合并为一个新的sequence序列</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">  <span class="keyword">let</span> test = <span class="type">Observable</span>.of(<span class="string">"1"</span>, <span class="string">"2"</span>, <span class="string">"3"</span>, <span class="string">"4"</span>, <span class="string">"5"</span>)</div><div class="line">    .<span class="built_in">map</span> &#123; $<span class="number">0</span> + <span class="string">"TTF"</span> &#125;</div><div class="line">    </div><div class="line">test</div><div class="line">    .subscribe(onNext: &#123;</div><div class="line">        <span class="built_in">print</span>($<span class="number">0</span>)</div><div class="line">    &#125;)</div><div class="line">    .addDisposableTo(disposeBag)</div><div class="line">    </div><div class="line">    </div><div class="line">1TTF</div><div class="line">2TTF</div><div class="line">3TTF</div><div class="line">4TTF</div><div class="line">5TTF</div></pre></td></tr></table></figure>
<blockquote>
<p>使用map对序列中每一个元素进行了处理，返回的是一个元素，而使用flatMap需要返回的序列。那么使用map也返回一个序列看看</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">  <span class="keyword">let</span> test = <span class="type">Observable</span>.of(<span class="string">"1"</span>, <span class="string">"2"</span>, <span class="string">"3"</span>, <span class="string">"4"</span>, <span class="string">"5"</span>)</div><div class="line">    .<span class="built_in">map</span> &#123; <span class="type">Observable</span>.just($<span class="number">0</span>) &#125;</div><div class="line">test</div><div class="line">    .subscribe(onNext: &#123;</div><div class="line">        <span class="built_in">print</span>($<span class="number">0</span>)</div><div class="line">    &#125;)</div><div class="line">    .addDisposableTo(disposeBag)</div><div class="line">    </div><div class="line"><span class="type">RxSwift</span>.<span class="type">Just</span>&lt;<span class="type">Swift</span>.<span class="type">String</span>&gt;</div><div class="line"><span class="type">RxSwift</span>.<span class="type">Just</span>&lt;<span class="type">Swift</span>.<span class="type">String</span>&gt;</div><div class="line"><span class="type">RxSwift</span>.<span class="type">Just</span>&lt;<span class="type">Swift</span>.<span class="type">String</span>&gt;</div><div class="line"><span class="type">RxSwift</span>.<span class="type">Just</span>&lt;<span class="type">Swift</span>.<span class="type">String</span>&gt;</div><div class="line"><span class="type">RxSwift</span>.<span class="type">Just</span>&lt;<span class="type">Swift</span>.<span class="type">String</span>&gt;</div></pre></td></tr></table></figure>
<blockquote>
<p>看到结果会打印出每一个序列，下面我们使用merge()方法将这几个序列进行合并</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">  <span class="keyword">let</span> test = <span class="type">Observable</span>.of(<span class="string">"1"</span>, <span class="string">"2"</span>, <span class="string">"3"</span>, <span class="string">"4"</span>, <span class="string">"5"</span>)</div><div class="line">    .<span class="built_in">map</span> &#123; <span class="type">Observable</span>.just($<span class="number">0</span>) &#125;</div><div class="line">    .merge()</div><div class="line">    </div><div class="line">test</div><div class="line">    .subscribe(onNext: &#123;</div><div class="line">        <span class="built_in">print</span>($<span class="number">0</span>)</div><div class="line">    &#125;)</div><div class="line">    .addDisposableTo(disposeBag)</div><div class="line">    </div><div class="line"> <span class="comment">///</span></div><div class="line">  <span class="number">1</span></div><div class="line">  <span class="number">2</span></div><div class="line">  <span class="number">3</span></div><div class="line">  <span class="number">4</span></div><div class="line">  <span class="number">5</span></div></pre></td></tr></table></figure>
<blockquote>
<p>合并为一个新序列后我们就可以正常打印元素了。下面看看使用faltMap()函数干这件事</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">  <span class="keyword">let</span> test = <span class="type">Observable</span>.of(<span class="string">"1"</span>, <span class="string">"2"</span>, <span class="string">"3"</span>, <span class="string">"4"</span>, <span class="string">"5"</span>)</div><div class="line">    .flatMap &#123; <span class="type">Observable</span>.just($<span class="number">0</span>) &#125;</div><div class="line">    </div><div class="line">test</div><div class="line">    .subscribe(onNext: &#123;</div><div class="line">        <span class="built_in">print</span>($<span class="number">0</span>)</div><div class="line">    &#125;)</div><div class="line">    .addDisposableTo(disposeBag)</div><div class="line">    </div><div class="line"><span class="number">1</span></div><div class="line"><span class="number">2</span></div><div class="line"><span class="number">3</span></div><div class="line"><span class="number">4</span></div><div class="line"><span class="number">5</span></div></pre></td></tr></table></figure>
<blockquote>
<p>看下对比是不是一样，这样子对比就清晰了吧</p>
</blockquote>
<ul>
<li>map函数只能返回原来的那一个序列，里面的参数的返回值被当做原来序列中所对应的元素。</li>
<li>flatMap函数返回的是一个新的序列，将原来元素进行了处理，返回这些处理后的元素组成的新序列</li>
<li>map函数 + 合并函数 = flatMap函数</li>
</ul>
<blockquote>
<p>flatMap函数在实际应用中有很多地方需要用到，比如网络请求，网络请求可能会发生错误，我们需要对这个请求过程进行监听，然后处理错误。只要继续他返回的是一个新的序列</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">validatedUsername = input.username</div><div class="line">          .flatMapLatest &#123; username <span class="keyword">in</span></div><div class="line">              <span class="keyword">return</span> validationService.validateUsername(username)</div><div class="line">                  .observeOn(<span class="type">MainScheduler</span>.instance)</div><div class="line">                  .catchErrorJustReturn(.failed(message: <span class="string">"Error contacting server"</span>))</div><div class="line">          &#125;</div><div class="line">          .shareReplay(<span class="number">1</span>)</div></pre></td></tr></table></figure>
<blockquote>
<p>flatMapLatest其实就是flatMap的另一个方式，只发送最后一个合进来的序列事件。上面认证username是一个网络请求，我们需要对这个过程进行处理<br>这个password不需要后台联网认证，只需要返回password符合不符合要求就行了，还是原来的序列就行了</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">validatedPassword = input.password</div><div class="line">  .<span class="built_in">map</span> &#123; password <span class="keyword">in</span></div><div class="line">      <span class="keyword">return</span> validationService.validatePassword(password)</div><div class="line">  &#125;</div><div class="line">  .shareReplay(<span class="number">1</span>)</div></pre></td></tr></table></figure>
<blockquote>
<p>flatMap也解决了内嵌多个subscribe的问题，官方不建议内嵌多个subscribe。比如：</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   textField.rx_text.subscribe(onNext: &#123; text <span class="keyword">in</span></div><div class="line">    performURLRequest(text).subscribe(onNext: &#123; result <span class="keyword">in</span></div><div class="line">        ...</div><div class="line">    &#125;)</div><div class="line">    .addDisposableTo(disposeBag)</div><div class="line">&#125;)</div><div class="line">.addDisposableTo(disposeBag)</div></pre></td></tr></table></figure>
<blockquote>
<p>改写为flatMap</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">textField.rx_text</div><div class="line"> .flatMapLatest &#123; text <span class="keyword">in</span></div><div class="line">     <span class="keyword">return</span> performURLRequest(text) <span class="comment">//因为flatMap返回一个新的sequence</span></div><div class="line"> &#125;</div><div class="line"> ...</div><div class="line"> .addDisposableTo(disposeBag)</div></pre></td></tr></table></figure>
<p>再举一个例子，当我们网络请求得到json数据的时候，我们可以使用flatmap进行序列转换，解析成Model序列，然后我们订阅这个带有Model的序列，代码就会变得很优雅</p>
<h1 id="UIBindingObserver"><a href="#UIBindingObserver" class="headerlink" title="UIBindingObserver"></a>UIBindingObserver</h1><blockquote>
<p>UIBindingObserver这个东西很有用的，创建我们自己的监听者，有时候RxCocoa(RxSwiftz中对UIKit的一个扩展库)给的扩展不够我们使用，比如一个UITextField有个isEnabled属性，我想把这个isEnabled变为一个observer，我们可以这样做：</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Reactive</span> <span class="title">where</span> <span class="title">Base</span>: <span class="title">UITextField</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> inputEnabled: <span class="type">UIBindingObserver</span>&lt;<span class="type">Base</span>, <span class="type">Result</span>&gt; &#123;</div><div class="line">        <span class="keyword">return</span> <span class="type">UIBindingObserver</span>(<span class="type">UIElement</span>: base) &#123; textFiled, result <span class="keyword">in</span></div><div class="line">            textFiled.isEnabled = result.isValid</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>UIBindingObserver是一个类，他的初始化方法中，有两个参数，第一个参数是一个元素本身，第一个参数是一个闭包，闭包参数是元素本身，还有他的一个性</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">init</span>(<span class="type">UIElement</span>: <span class="type">UIElementType</span>, binding: @escaping (<span class="type">UIElementType</span>, <span class="type">Value</span>) -&gt; <span class="type">Swift</span>.<span class="type">Void</span>)</div></pre></td></tr></table></figure>
<blockquote>
<p>自定义了一个inputEnabled Observer里面关联的UITextField的isEnabled属性</p>
</blockquote>

          
        
      
    </div>
    
    
    

    



    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/15/RxSwift/Grammar/简单基础项目/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="千夜 QQ:738816656">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="千夜、おれはおまえをずっと爱している">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/15/RxSwift/Grammar/简单基础项目/" itemprop="url">Swift-RxSwift-简单基础项目</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-15T23:40:29+08:00">
                2017-12-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Swift/" itemprop="url" rel="index">
                    <span itemprop="name">Swift</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Swift/RxSwift/" itemprop="url" rel="index">
                    <span itemprop="name">RxSwift</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h1><figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">├── <span class="type">Controller</span></div><div class="line">│   └── <span class="type">LXFViewController</span>.swift     <span class="comment">// 主视图控制器</span></div><div class="line">│</div><div class="line">├── <span class="type">Extension</span></div><div class="line">│   └── <span class="type">Response</span>+<span class="type">ObjectMapper</span>.swift <span class="comment">// Response分类，</span></div><div class="line"><span class="type">Moya</span>请求完进行<span class="type">Json</span>转模型或模型数组</div><div class="line">│</div><div class="line">├── <span class="type">Model</span></div><div class="line">│   └── <span class="type">LXFModel</span>.swift              <span class="comment">// 模型</span></div><div class="line">│</div><div class="line">├── <span class="type">Protocol</span></div><div class="line">│   └── <span class="type">LXFViewModelType</span>.swift      <span class="comment">// 定义了模型协议</span></div><div class="line">│</div><div class="line">├── <span class="type">Tool</span></div><div class="line">│   ├── <span class="type">LXFNetworkTool</span>.swift        <span class="comment">// 封装Moya请求</span></div><div class="line">│   │</div><div class="line">│   └── <span class="type">LXFProgressHUD</span>.swift        <span class="comment">// 封装的HUD</span></div><div class="line">│</div><div class="line">├── <span class="type">View</span></div><div class="line">│   ├── <span class="type">LXFViewCell</span>.swift           <span class="comment">// 自定义cell</span></div><div class="line">│   │</div><div class="line">│   └── <span class="type">LXFViewCell</span>.xib             <span class="comment">// cell的xib文件</span></div><div class="line">│</div><div class="line">└── <span class="type">ViewModel</span></div><div class="line">    │</div><div class="line">    └── <span class="type">LXFViewModel</span>.swift          <span class="comment">// 视图模型</span></div></pre></td></tr></table></figure>
<h1 id="Lib"><a href="#Lib" class="headerlink" title="Lib"></a>Lib</h1><figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   <span class="type">RxSwift</span>         <span class="comment">// 想玩RxSwift的必备库</span></div><div class="line"><span class="type">RxCocoa</span>         <span class="comment">// 对 UIKit Foundation 进行 Rx 化</span></div><div class="line"><span class="type">NSObject</span>+<span class="type">Rx</span>     <span class="comment">// 为我们提供 rx_disposeBag </span></div><div class="line"><span class="type">Moya</span>/<span class="type">RxSwift</span>    <span class="comment">// 为RxSwift专用提供，对Alamofire进行封装的一个网络请求库</span></div><div class="line"><span class="type">ObjectMapper</span>    <span class="comment">// Json转模型之必备良品</span></div><div class="line"><span class="type">RxDataSources</span>   <span class="comment">// 帮助我们优雅的使用tableView的数据源方法</span></div><div class="line"><span class="type">Then</span>            <span class="comment">// 提供快速初始化的语法糖</span></div><div class="line"><span class="type">Kingfisher</span>      <span class="comment">// 图片加载库</span></div><div class="line"><span class="type">SnapKit</span>         <span class="comment">// 视图约束库</span></div><div class="line"><span class="type">Reusable</span>        <span class="comment">// 帮助我们优雅的使用自定义cell和view,不再出现Optional</span></div><div class="line"><span class="type">MJRefresh</span>       <span class="comment">// 上拉加载、下拉刷新的库</span></div><div class="line"><span class="type">SVProgressHUD</span>   <span class="comment">// 简单易用的HUD</span></div></pre></td></tr></table></figure>
<h1 id="Moya的使用"><a href="#Moya的使用" class="headerlink" title="Moya的使用"></a>Moya的使用</h1><ul>
<li>Moya是基于Alamofire的网络请求库</li>
<li>使用了Moya/Swift，它在Moya的基础上添加了对RxSwift的接口支持。接下来我们来说下Moya的使用</li>
</ul>
<blockquote>
<p>创建一个枚举，用来存放请求类型，这里我顺便设置相应的路径，等下统一取出来直接赋值即可</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   <span class="class"><span class="keyword">enum</span> <span class="title">LXFNetworkTool</span> </span>&#123;</div><div class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">LXFNetworkCategory</span>: <span class="title">String</span> </span>&#123;</div><div class="line">        <span class="keyword">case</span> all     = <span class="string">"all"</span></div><div class="line">        <span class="keyword">case</span> android = <span class="string">"Android"</span></div><div class="line">        <span class="keyword">case</span> ios     = <span class="string">"iOS"</span></div><div class="line">        <span class="keyword">case</span> welfare = <span class="string">"福利"</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">case</span> data(type: <span class="type">LXFNetworkCategory</span>, size:<span class="type">Int</span>, index:<span class="type">Int</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>为这个枚举写一个扩展，并遵循塄 TargetType，这个协议的Moya这个库规定的协议，可以按住Commond键+单击左键进入相应的文件进行查看</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">  <span class="class"><span class="keyword">extension</span> <span class="title">LXFNetworkTool</span>: <span class="title">TargetType</span> </span>&#123;</div><div class="line">    <span class="comment">/// baseURL 统一基本的URL</span></div><div class="line">    <span class="keyword">var</span> baseURL: <span class="type">URL</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="type">URL</span>(string: <span class="string">"http://gank.io/api/data/"</span>)!</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/// path字段会追加至baseURL后面</span></div><div class="line">    <span class="keyword">var</span> path: <span class="type">String</span> &#123;</div><div class="line">        <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</div><div class="line">        <span class="keyword">case</span> .data(<span class="keyword">let</span> type, <span class="keyword">let</span> size, <span class="keyword">let</span> index):</div><div class="line">            <span class="keyword">return</span> <span class="string">"\(type.rawValue)/\(size)/\(index)"</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/// HTTP的请求方式</span></div><div class="line">    <span class="keyword">var</span> method: <span class="type">Moya</span>.<span class="type">Method</span> &#123;</div><div class="line">        <span class="keyword">return</span> .<span class="keyword">get</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/// 请求参数(会在请求时进行编码)</span></div><div class="line">    <span class="keyword">var</span> parameters: [<span class="type">String</span>: <span class="type">Any</span>]? &#123;</div><div class="line">        <span class="keyword">return</span> <span class="literal">nil</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/// 参数编码方式(这里使用URL的默认方式)</span></div><div class="line">    <span class="keyword">var</span> parameterEncoding: <span class="type">ParameterEncoding</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="type">URLEncoding</span>.<span class="keyword">default</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/// 这里用于单元测试，不需要的就像我一样随便写写</span></div><div class="line">    <span class="keyword">var</span> sampleData: <span class="type">Data</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"LinXunFeng"</span>.data(using: .utf8)!</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/// 将要被执行的任务(请求：request 下载：upload 上传：download)</span></div><div class="line">    <span class="keyword">var</span> task: <span class="type">Task</span> &#123;</div><div class="line">        <span class="keyword">return</span> .request</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/// 是否执行Alamofire验证，默认值为false</span></div><div class="line">    <span class="keyword">var</span> validate: <span class="type">Bool</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>定义一个全局变量用于整个项目的网络请求</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line"><span class="keyword">let</span> lxfNetTool = <span class="type">RxMoyaProvider</span>&lt;<span class="type">LXFNetworkTool</span>&gt;()</div></pre></td></tr></table></figure>
<h1 id="RxDataSources"><a href="#RxDataSources" class="headerlink" title="RxDataSources"></a>RxDataSources</h1><blockquote>
<p>如何优雅的来实现tableView的数据源。其实RxDataSources官网上已经有很明确的使用说明，不过我还是总结一下整个过程吧<br>概念点 :RxDataSources是以section来做为数据结构来传输，这点很重要，可能很多同学会比较疑惑这句话吧，我在此举个例子，在传统的数据源实现的方法中有一个numberOfSection，我们在很多情况下只需要一个section，所以这个方法可实现，也可以不实现，默认返回的就是1，这给我们带来的一个迷惑点：【tableView是由row来组成的】，不知道在坐的各位中有没有是这么想的呢？？有的话那从今天开始就要认清楚这一点，【tableView其实是由section组成的】，所以在使用RxDataSources的过程中，即使你的setion只有一个，那你也得返回一个section的数组出去</p>
</blockquote>
<h2 id="自定义Section"><a href="#自定义Section" class="headerlink" title="自定义Section"></a>自定义Section</h2><blockquote>
<p>在我们自定义的Model中创建一个Section的结构体，并且创建一个扩展，遵循SectionModelType协议，实现相应的协议方法。约定俗成的写法呢请参考如下方式</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">  <span class="type">LXFModel</span>.swift</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">LXFSection</span> </span>&#123;</div><div class="line">    <span class="comment">// items就是rows</span></div><div class="line">    <span class="keyword">var</span> items: [<span class="type">Item</span>]</div><div class="line">    <span class="comment">// 你也可以这里加你需要的东西，比如 headerView 的 title</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">LXFSection</span>: <span class="title">SectionModelType</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">// 重定义 Item 的类型为 LXFModel</span></div><div class="line">    <span class="keyword">typealias</span> <span class="type">Item</span> = <span class="type">LXFModel</span></div><div class="line"></div><div class="line">    <span class="comment">// 实现协议中的方式</span></div><div class="line">    <span class="keyword">init</span>(original: <span class="type">LXFSection</span>, items: [<span class="type">LXFSection</span>.<span class="type">Item</span>]) &#123;</div><div class="line">        <span class="keyword">self</span> = original</div><div class="line">        <span class="keyword">self</span>.items = items</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="在控制器下创建一个数据源属性"><a href="#在控制器下创建一个数据源属性" class="headerlink" title="在控制器下创建一个数据源属性"></a>在控制器下创建一个数据源属性</h2><blockquote>
<p>以下代码均在 LXFViewController.swift 文件中</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   <span class="comment">// 创建一个数据源属性，类型为自定义的Section类型</span></div><div class="line"><span class="keyword">let</span> dataSource = <span class="type">RxTableViewSectionedReloadDataSource</span>&lt;<span class="type">LXFSection</span>&gt;()</div></pre></td></tr></table></figure>
<h2 id="使用数据源属性绑定我们的cell"><a href="#使用数据源属性绑定我们的cell" class="headerlink" title="使用数据源属性绑定我们的cell"></a>使用数据源属性绑定我们的cell</h2><figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   <span class="comment">// 绑定cell</span></div><div class="line">dataSource.configureCell = &#123; ds, tv, ip, item <span class="keyword">in</span></div><div class="line">    <span class="comment">// 这个地方使用了Reusable这个库，在LXFViewCell中遵守了相应的协议</span></div><div class="line">    <span class="comment">// 使其方便转换cell为非可选型的相应的cell类型</span></div><div class="line">    <span class="keyword">let</span> cell = tv.dequeueReusableCell(<span class="keyword">for</span>: ip) <span class="keyword">as</span> <span class="type">LXFViewCell</span></div><div class="line">    cell.picView.kf.setImage(with: <span class="type">URL</span>(string: item.url))</div><div class="line">    cell.descLabel.text = <span class="string">"描述: \(item.desc)"</span></div><div class="line">    cell.sourceLabel.text = <span class="string">"来源: \(item.source)"</span></div><div class="line">    <span class="keyword">return</span> cell</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="将sections序列绑定给我们的rows"><a href="#将sections序列绑定给我们的rows" class="headerlink" title="将sections序列绑定给我们的rows"></a>将sections序列绑定给我们的rows</h2><figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">output.sections.asDriver().drive(tableView.rx.items(dataSource:dataSource)).addDisposableTo(rx_disposeBag)</div></pre></td></tr></table></figure>
<h1 id="ViewModel的规范"><a href="#ViewModel的规范" class="headerlink" title="ViewModel的规范"></a>ViewModel的规范</h1><blockquote>
<p>MVVM思想就是将原本在ViewController的视图显示逻辑、验证逻辑、网络请求等代码存放于ViewModel中，让我们手中的ViewController瘦身。这些逻辑由ViewModel负责，外界不需要关心，外界只需要结果，ViewModel也只需要将结果给到外界，基于此，我们定义了一个协议LXFViewModelType</p>
</blockquote>
<h2 id="创建一个LXFViewModelType-swift"><a href="#创建一个LXFViewModelType-swift" class="headerlink" title="创建一个LXFViewModelType.swift"></a>创建一个LXFViewModelType.swift</h2><figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   <span class="type">LXFViewModelType</span>.swift</div><div class="line"></div><div class="line"><span class="comment">// associatedtype 关键字 用来声明一个类型的占位符作为协议定义的一部分</span></div><div class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">LXFViewModelType</span> </span>&#123;</div><div class="line">    associatedtype <span class="type">Input</span></div><div class="line">    associatedtype <span class="type">Output</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">transform</span><span class="params">(input: Input)</span></span> -&gt; <span class="type">Output</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="viewModel遵守LXFViewModelType协议"><a href="#viewModel遵守LXFViewModelType协议" class="headerlink" title="viewModel遵守LXFViewModelType协议"></a>viewModel遵守LXFViewModelType协议</h2><ul>
<li>可以为XFViewModelType的Input和Output定义别名，以示区分，如：你这个viewModel的用于请求首页模块相关联的，则可以命名为：HomeInput 和 HomeOutput</li>
<li>可以丰富我们的 Input 和 Output 。可以看到我为Output添加了一个序列，类型为我们自定义的LXFSection数组，在Input里面添加了一个请求类型(即要请求什么数据，比如首页的数据)</li>
<li>通过 transform 方法将input携带的数据进行处理，生成了一个Output</li>
</ul>
<blockquote>
<p>以下代码为了方便阅读，进行了部分删减</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   <span class="type">LXFViewModel</span>.swift</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">LXFViewModel</span>: <span class="title">LXFViewModelType</span> </span>&#123;</div><div class="line">   <span class="comment">// 存放着解析完成的模型数组</span></div><div class="line">   <span class="keyword">let</span> models = <span class="type">Variable</span>&lt;[<span class="type">LXFModel</span>]&gt;([])</div><div class="line"></div><div class="line">    <span class="comment">// 为LXFViewModelType的Input和Output定义别名</span></div><div class="line">    <span class="keyword">typealias</span> <span class="type">Input</span> = <span class="type">LXFInput</span></div><div class="line">    <span class="keyword">typealias</span> <span class="type">Output</span> = <span class="type">LXFOutput</span></div><div class="line"></div><div class="line">    <span class="comment">// 丰富我们的Input和Output</span></div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">LXFInput</span> </span>&#123;</div><div class="line">        <span class="comment">// 网络请求类型</span></div><div class="line">        <span class="keyword">let</span> category: <span class="type">LXFNetworkTool</span>.<span class="type">LXFNetworkCategory</span></div><div class="line"></div><div class="line">        <span class="keyword">init</span>(category: <span class="type">LXFNetworkTool</span>.<span class="type">LXFNetworkCategory</span>) &#123;</div><div class="line">            <span class="keyword">self</span>.category = category</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">LXFOutput</span> </span>&#123;</div><div class="line">        <span class="comment">// tableView的sections数据</span></div><div class="line">        <span class="keyword">let</span> sections: <span class="type">Driver</span>&lt;[<span class="type">LXFSection</span>]&gt;</div><div class="line"></div><div class="line">        <span class="keyword">init</span>(sections: <span class="type">Driver</span>&lt;[<span class="type">LXFSection</span>]&gt;) &#123;</div><div class="line">            <span class="keyword">self</span>.sections = sections</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">transform</span><span class="params">(input: LXFViewModel.LXFInput)</span></span> -&gt; <span class="type">LXFViewModel</span>.<span class="type">LXFOutput</span> &#123;</div><div class="line">        <span class="keyword">let</span> sections = models.asObservable().<span class="built_in">map</span> &#123; (models) -&gt; [<span class="type">LXFSection</span>] <span class="keyword">in</span></div><div class="line">            <span class="comment">// 当models的值被改变时会调用，这是Variable的特性</span></div><div class="line">            <span class="keyword">return</span> [<span class="type">LXFSection</span>(items: models)] <span class="comment">// 返回section数组</span></div><div class="line">        &#125;.asDriver(onErrorJustReturn: [])</div><div class="line"></div><div class="line">        <span class="keyword">let</span> output = <span class="type">LXFOutput</span>(sections: sections)</div><div class="line"></div><div class="line">        <span class="comment">// 接下来的代码是网络请求，请结合项目查看，不然会不方便阅读和理解</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>在ViewController中初始化我们的input，通过transform得到output，然后将我们output中的sections序列绑定tableView的items</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   <span class="type">LXFViewController</span>.swift</div><div class="line"></div><div class="line"><span class="comment">// 初始化input</span></div><div class="line"><span class="keyword">let</span> vmInput = <span class="type">LXFViewModel</span>.<span class="type">LXFInput</span>(category: .welfare)</div><div class="line"><span class="comment">// 通过transform得到output</span></div><div class="line"><span class="keyword">let</span> vmOutput = viewModel.transform(input: vmInput)</div><div class="line"></div><div class="line">vmOutput.sections.asDriver().drive(tableView.rx.items(dataSource: dataSource)).addDisposableTo(rx_disposeBag)</div></pre></td></tr></table></figure>
<h1 id="RxSwift中使用MJRefresh"><a href="#RxSwift中使用MJRefresh" class="headerlink" title="RxSwift中使用MJRefresh"></a>RxSwift中使用MJRefresh</h1><h2 id="定义一个枚举LXFRefreshStatus，用于标志当前刷新状态"><a href="#定义一个枚举LXFRefreshStatus，用于标志当前刷新状态" class="headerlink" title="定义一个枚举LXFRefreshStatus，用于标志当前刷新状态"></a>定义一个枚举LXFRefreshStatus，用于标志当前刷新状态</h2><figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   <span class="class"><span class="keyword">enum</span> <span class="title">LXFRefreshStatus</span> </span>&#123;</div><div class="line">    <span class="keyword">case</span> <span class="keyword">none</span></div><div class="line">    <span class="keyword">case</span> beingHeaderRefresh</div><div class="line">    <span class="keyword">case</span> endHeaderRefresh</div><div class="line">    <span class="keyword">case</span> beingFooterRefresh</div><div class="line">    <span class="keyword">case</span> endFooterRefresh</div><div class="line">    <span class="keyword">case</span> noMoreData</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="在LXFOutput添加一个refreshStatus序列，类型为LXFRefreshStatus"><a href="#在LXFOutput添加一个refreshStatus序列，类型为LXFRefreshStatus" class="headerlink" title="在LXFOutput添加一个refreshStatus序列，类型为LXFRefreshStatus"></a>在LXFOutput添加一个refreshStatus序列，类型为LXFRefreshStatus</h2><figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   <span class="comment">// 给外界订阅，告诉外界的tableView当前的刷新状态</span></div><div class="line"><span class="keyword">let</span> refreshStatus = <span class="type">Variable</span>&lt;<span class="type">LXFRefreshStatus</span>&gt;(.<span class="keyword">none</span>)</div></pre></td></tr></table></figure>
<blockquote>
<p>在进行网络请求并得到结果之后，修改refreshStatus的value为相应的LXFRefreshStatus项</p>
</blockquote>
<h2 id="外界订阅output的refreshStatus"><a href="#外界订阅output的refreshStatus" class="headerlink" title="外界订阅output的refreshStatus"></a>外界订阅output的refreshStatus</h2><blockquote>
<p>外界订阅output的refreshStatus，并且根据接收到的值进行相应的操作</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   vmOutput.refreshStatus.asObservable().subscribe(onNext: &#123;[<span class="keyword">weak</span> <span class="keyword">self</span>] status <span class="keyword">in</span></div><div class="line">    <span class="keyword">switch</span> status &#123;</div><div class="line">    <span class="keyword">case</span> .beingHeaderRefresh:</div><div class="line">        <span class="keyword">self</span>?.tableView.mj_header.beginRefreshing()</div><div class="line">    <span class="keyword">case</span> .endHeaderRefresh:</div><div class="line">        <span class="keyword">self</span>?.tableView.mj_header.endRefreshing()</div><div class="line">    <span class="keyword">case</span> .beingFooterRefresh:</div><div class="line">        <span class="keyword">self</span>?.tableView.mj_footer.beginRefreshing()</div><div class="line">    <span class="keyword">case</span> .endFooterRefresh:</div><div class="line">        <span class="keyword">self</span>?.tableView.mj_footer.endRefreshing()</div><div class="line">    <span class="keyword">case</span> .noMoreData:</div><div class="line">        <span class="keyword">self</span>?.tableView.mj_footer.endRefreshingWithNoMoreData()</div><div class="line">    <span class="keyword">default</span>:</div><div class="line">        <span class="keyword">break</span></div><div class="line">    &#125;</div><div class="line">&#125;).addDisposableTo(rx_disposeBag)</div></pre></td></tr></table></figure>
<h2 id="output提供一个requestCommond用于请求数据"><a href="#output提供一个requestCommond用于请求数据" class="headerlink" title="output提供一个requestCommond用于请求数据"></a>output提供一个requestCommond用于请求数据</h2><blockquote>
<p>PublishSubject 的特点：即可以作为Observable，也可以作为Observer，说白了就是可以发送信号，也可以订阅信号</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   <span class="comment">// 外界通过该属性告诉viewModel加载数据（传入的值是为了标志是否重新加载）</span></div><div class="line"><span class="keyword">let</span> requestCommond = <span class="type">PublishSubject</span>&lt;<span class="type">Bool</span>&gt;()</div></pre></td></tr></table></figure>
<blockquote>
<p>在transform中，我们对生成的output的requestCommond进行订阅</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   output.requestCommond.subscribe(onNext: &#123;[<span class="keyword">unowned</span> <span class="keyword">self</span>] isReloadData <span class="keyword">in</span></div><div class="line">    <span class="keyword">self</span>.index = isReloadData ? <span class="number">1</span> : <span class="keyword">self</span>.index+<span class="number">1</span></div><div class="line">    lxfNetTool.request(.data(type: input.category, size: <span class="number">10</span>, index: <span class="keyword">self</span>.index)).mapArray(<span class="type">LXFModel</span>.<span class="keyword">self</span>).subscribe(&#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] (event) <span class="keyword">in</span></div><div class="line">        <span class="keyword">switch</span> event &#123;</div><div class="line">        <span class="keyword">case</span> <span class="keyword">let</span> .next(modelArr):</div><div class="line">            <span class="keyword">self</span>?.models.value = isReloadData ? modelArr : (<span class="keyword">self</span>?.models.value ?? []) + modelArr</div><div class="line">            <span class="type">LXFProgressHUD</span>.showSuccess(<span class="string">"加载成功"</span>)</div><div class="line">        <span class="keyword">case</span> <span class="keyword">let</span> .error(error):</div><div class="line">            <span class="type">LXFProgressHUD</span>.showError(error.localizedDescription)</div><div class="line">        <span class="keyword">case</span> .completed:</div><div class="line">            output.refreshStatus.value = isReloadData ? .endHeaderRefresh : .endFooterRefresh</div><div class="line">        &#125;</div><div class="line">    &#125;).addDisposableTo(<span class="keyword">self</span>.rx_disposeBag)</div><div class="line">&#125;).addDisposableTo(rx_disposeBag)</div></pre></td></tr></table></figure>
<h2 id="在ViewController中初始化刷新控件"><a href="#在ViewController中初始化刷新控件" class="headerlink" title="在ViewController中初始化刷新控件"></a>在ViewController中初始化刷新控件</h2><blockquote>
<p>为tableView设置刷新控件，并且在创建刷新控件的回调中使用output的requestCommond发射信号</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   tableView.mj_header = <span class="type">MJRefreshNormalHeader</span>(refreshingBlock: &#123; </div><div class="line">    vmOutput.requestCommond.onNext(<span class="literal">true</span>)</div><div class="line">&#125;)</div><div class="line">tableView.mj_footer = <span class="type">MJRefreshAutoNormalFooter</span>(refreshingBlock: &#123; </div><div class="line">    vmOutput.requestCommond.onNext(<span class="literal">false</span>)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h1 id="总结流程"><a href="#总结流程" class="headerlink" title="总结流程"></a>总结流程</h1><ul>
<li><p>ViewController已经拿到output，当下拉加载数据的时候，使用output的requestCommond发射信息，告诉viewModel我们要加载数据</p>
</li>
<li><p>viewModel请求数据，在处理完json转模型或模型数组后修改models，当models的值被修改的时候会发信号给sections，sections在ViewController已经绑定到tableView的items了，所以此时tableView的数据会被更新。接着我们根据请求结果，修改output的refreshStatus属性的值</p>
<ul>
<li>当output的refreshStatus属性的值改变后，会发射信号，由于外界之前已经订阅了output的refreshStatus，此时就会根据refreshStatus的新值来处理刷新控件的状态</li>
</ul>
<p><a href="http://blog.csdn.net/lincsdnnet/article/details/77896404" target="_blank" rel="external">yuan wen</a></p>
<p><a href="https://github.com/LinXunFeng/RxSwiftDemo" target="_blank" rel="external">demo</a></p>
</li>
</ul>

          
        
      
    </div>
    
    
    

    



    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/15/RxSwift/Grammar/RxSwift-资料/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="千夜 QQ:738816656">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="千夜、おれはおまえをずっと爱している">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/15/RxSwift/Grammar/RxSwift-资料/" itemprop="url">Swift-RxSwift-Grammar- 资料</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-15T17:18:21+08:00">
                2017-12-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Swift/" itemprop="url" rel="index">
                    <span itemprop="name">Swift</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Swift/RxSwift/" itemprop="url" rel="index">
                    <span itemprop="name">RxSwift</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://blog.csdn.net/chelongfei/article/details/50969901" target="_blank" rel="external">Driver</a></p>
<p><a href="http://blog.csdn.net/chelongfei/article/details/75314346" target="_blank" rel="external">RxSwift在UITableViewCell或者UICollectionViewCell中绑定数据遇到的UI混乱的问题</a></p>
<p><a href="https://www.jianshu.com/p/d57ff2b3e0d4" target="_blank" rel="external">【RxSwift系列】用RxSwift实现一个UITableView（一）</a></p>
<p><a href="https://www.jianshu.com/p/e510bc944508" target="_blank" rel="external">MVVM模式仿写斗鱼APP首页</a></p>
<p><a href="https://www.jianshu.com/p/431f645cb805" target="_blank" rel="external">RxSwift进阶与实战</a></p>

          
        
      
    </div>
    
    
    

    



    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/15/RxSwift/Grammar/基本UI控件的扩展/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="千夜 QQ:738816656">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="千夜、おれはおまえをずっと爱している">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/15/RxSwift/Grammar/基本UI控件的扩展/" itemprop="url">Swift-RxSwift-UI控件的扩展</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-15T15:49:44+08:00">
                2017-12-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Swift/" itemprop="url" rel="index">
                    <span itemprop="name">Swift</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Swift/RxSwift/" itemprop="url" rel="index">
                    <span itemprop="name">RxSwift</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="UITextField-UITextView"><a href="#UITextField-UITextView" class="headerlink" title="UITextField / UITextView"></a>UITextField / UITextView</h1><h2 id="监听多个UITextField"><a href="#监听多个UITextField" class="headerlink" title="监听多个UITextField"></a>监听多个UITextField</h2><blockquote>
<p>监听三个UITextField随便哪个的text变化了，都会引起代码执行，并且结果赋值到result的text</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> number1: <span class="type">UITextField</span>!</div><div class="line"><span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> number2: <span class="type">UITextField</span>!</div><div class="line"><span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> number3: <span class="type">UITextField</span>!</div><div class="line"></div><div class="line"><span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> result: <span class="type">UILabel</span>!</div><div class="line"></div><div class="line"><span class="keyword">var</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line"></div><div class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">super</span>.viewDidLoad()</div><div class="line"></div><div class="line">    <span class="type">Observable</span>.combineLatest(number1.rx.text.orEmpty, number2.rx.text.orEmpty, number3.rx.text.orEmpty) &#123; textValue1, textValue2, textValue3 -&gt; <span class="type">Int</span> <span class="keyword">in</span></div><div class="line">        <span class="keyword">return</span> (<span class="type">Int</span>(textValue1) ?? <span class="number">0</span>) + (<span class="type">Int</span>(textValue2) ?? <span class="number">0</span>) + (<span class="type">Int</span>(textValue3) ?? <span class="number">0</span>)</div><div class="line">    &#125;</div><div class="line">    .<span class="built_in">map</span> &#123; $<span class="number">0</span>.description &#125;</div><div class="line">    .bindTo(result.rx.text)</div><div class="line">    .disposed(by: disposeBag)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="单个UITextField变化监听"><a href="#单个UITextField变化监听" class="headerlink" title="单个UITextField变化监听"></a>单个UITextField变化监听</h2><blockquote>
<p>官方：</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   <span class="comment">// also test two way binding</span></div><div class="line"><span class="keyword">let</span> textValue = <span class="type">Variable</span>(<span class="string">""</span>)</div><div class="line"><span class="number">_</span> = textField.rx.textInput &lt;-&gt; textValue</div><div class="line"></div><div class="line">textValue.asObservable()</div><div class="line">    .subscribe(onNext: &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] x <span class="keyword">in</span></div><div class="line">        <span class="keyword">self</span>?.debug(<span class="string">"UITextField text \(x)"</span>)</div><div class="line">    &#125;)</div><div class="line">    .disposed(by: disposeBag)</div></pre></td></tr></table></figure>
<blockquote>
<p>例子：单个UITextField事件监听</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">usernameTF.rx.controlEvent([.editingDidBegin]) <span class="comment">//状态可以组合</span></div><div class="line"> .asObservable()</div><div class="line"> .subscribe(onNext: &#123; <span class="number">_</span> <span class="keyword">in</span></div><div class="line">     <span class="built_in">print</span>(<span class="string">"begin edit"</span>)</div><div class="line"> &#125;).disposed(by: disposeBag)</div></pre></td></tr></table></figure>
<h2 id="UITextField遇到键盘Next-Go按钮时，焦点的切换"><a href="#UITextField遇到键盘Next-Go按钮时，焦点的切换" class="headerlink" title="UITextField遇到键盘Next/Go按钮时，焦点的切换"></a>UITextField遇到键盘Next/Go按钮时，焦点的切换</h2><blockquote>
<p>这里有个小坑，如果usernameTF和passwordTF用了Observable.combineLatest然后订阅的话，你会发现下面的delegate代码没用了，在usernameTF点击Next/Go不能切换到passwordTF了</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   <span class="function"><span class="keyword">func</span> <span class="title">textFieldShouldReturn</span><span class="params">(<span class="number">_</span> textField: UITextField)</span></span> -&gt; <span class="type">Bool</span> &#123;</div><div class="line">    <span class="keyword">if</span> textField == usernameTF &#123;</div><div class="line">        passwordTF.becomeFirstResponder()</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        passwordTF.resignFirstResponder()</div><div class="line">        <span class="type">Log</span>(<span class="string">"view become"</span>)</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="literal">true</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>用事件监听即可，监听return key结束编辑的事件(editingDidEndOnExit)：</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">  <span class="comment">/* editingDidEndOnExit: UIControlEvents // 'return key' ending editing */</span></div><div class="line"></div><div class="line">usernameTF.rx.controlEvent(.editingDidEndOnExit).subscribe(onNext: &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] (<span class="number">_</span>) <span class="keyword">in</span></div><div class="line">    <span class="keyword">self</span>?.passwordTF.becomeFirstResponder()</div><div class="line">&#125;).disposed(by: disposeBag)</div><div class="line"></div><div class="line">passwordTF.rx.controlEvent(.editingDidEndOnExit).subscribe(onNext: &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] (<span class="number">_</span>) <span class="keyword">in</span></div><div class="line">    <span class="keyword">self</span>?.passwordTF.resignFirstResponder()</div><div class="line">&#125;).disposed(by: disposeBag)</div></pre></td></tr></table></figure>
<h1 id="UITextView变化监听"><a href="#UITextView变化监听" class="headerlink" title="UITextView变化监听"></a>UITextView变化监听</h1><figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   / also test two way binding</div><div class="line"><span class="keyword">let</span> textViewValue = <span class="type">Variable</span>(<span class="string">""</span>)</div><div class="line"><span class="number">_</span> = textView.rx.textInput &lt;-&gt; textViewValue</div><div class="line"></div><div class="line">textViewValue.asObservable()</div><div class="line">    .subscribe(onNext: &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] x <span class="keyword">in</span></div><div class="line">        <span class="keyword">self</span>?.debug(<span class="string">"UITextView text \(x)"</span>)</div><div class="line">    &#125;)</div><div class="line">    .disposed(by: disposeBag)</div></pre></td></tr></table></figure>
<h1 id="UIButton-UIBarButtonItem"><a href="#UIButton-UIBarButtonItem" class="headerlink" title="UIButton / UIBarButtonItem"></a>UIButton / UIBarButtonItem</h1><h2 id="监听按钮的点击（touchUpInside）"><a href="#监听按钮的点击（touchUpInside）" class="headerlink" title="监听按钮的点击（touchUpInside）"></a>监听按钮的点击（touchUpInside）</h2><figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> doSomethingOutlet: <span class="type">UIButton</span>!</div><div class="line">    </div><div class="line">doSomethingOutlet.rx.tap</div><div class="line">    .subscribe(onNext: &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="keyword">in</span> </div><div class="line">        <span class="keyword">self</span>?.showAlert() <span class="comment">//这里self指vc</span></div><div class="line">    &#125;)</div><div class="line">    .disposed(by: disposeBag)</div></pre></td></tr></table></figure>
<blockquote>
<p>也可以这样：</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">button.rx.tap</div><div class="line">  .bindNext &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="keyword">in</span></div><div class="line">      <span class="keyword">self</span>?.openAppPreferences()</div><div class="line">  &#125;</div><div class="line">  .disposed(by: disposeBag)</div></pre></td></tr></table></figure>
<h1 id="UISegmentedControl-UISwitch"><a href="#UISegmentedControl-UISwitch" class="headerlink" title="UISegmentedControl / UISwitch"></a>UISegmentedControl / UISwitch</h1><blockquote>
<p>监听状态切换</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   <span class="comment">// also test two way binding</span></div><div class="line"><span class="keyword">let</span> segmentedValue = <span class="type">Variable</span>(<span class="number">0</span>)</div><div class="line"><span class="number">_</span> = segmentedControl.rx.value &lt;-&gt; segmentedValue</div><div class="line"></div><div class="line">segmentedValue.asObservable()</div><div class="line">    .subscribe(onNext: &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] x <span class="keyword">in</span></div><div class="line">        <span class="keyword">self</span>?.debug(<span class="string">"UISegmentedControl value \(x)"</span>)</div><div class="line">    &#125;)</div><div class="line">    .disposed(by: disposeBag)</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="comment">// also test two way binding</span></div><div class="line"><span class="keyword">let</span> switchValue = <span class="type">Variable</span>(<span class="literal">true</span>)</div><div class="line"><span class="number">_</span> = switcher.rx.value &lt;-&gt; switchValue</div><div class="line"></div><div class="line">switchValue.asObservable()</div><div class="line">    .subscribe(onNext: &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] x <span class="keyword">in</span></div><div class="line">        <span class="keyword">self</span>?.debug(<span class="string">"UISwitch value \(x)"</span>)</div><div class="line">    &#125;)</div><div class="line">    .disposed(by: disposeBag)</div></pre></td></tr></table></figure>
<h1 id="UIActivityIndicatorView"><a href="#UIActivityIndicatorView" class="headerlink" title="UIActivityIndicatorView"></a>UIActivityIndicatorView</h1><blockquote>
<p>状态指示器根据UISwitch的状态来决定是否显示旋转</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">switcher.rx.value</div><div class="line"> .bindTo(activityIndicator.rx.isAnimating)</div><div class="line"> .disposed(by: disposeBag)</div></pre></td></tr></table></figure>
<h1 id="UISlider"><a href="#UISlider" class="headerlink" title="UISlider"></a>UISlider</h1><figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   <span class="comment">// also test two way binding</span></div><div class="line"><span class="keyword">let</span> sliderValue = <span class="type">Variable</span>&lt;<span class="type">Float</span>&gt;(<span class="number">1.0</span>)</div><div class="line"><span class="number">_</span> = slider.rx.value &lt;-&gt; sliderValue</div><div class="line"></div><div class="line">sliderValue.asObservable()</div><div class="line">    .subscribe(onNext: &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] x <span class="keyword">in</span></div><div class="line">        <span class="keyword">self</span>?.debug(<span class="string">"UISlider value \(x)"</span>)</div><div class="line">    &#125;)</div><div class="line">    .disposed(by: disposeBag)</div></pre></td></tr></table></figure>
<h1 id="UIDatePicker"><a href="#UIDatePicker" class="headerlink" title="UIDatePicker"></a>UIDatePicker</h1><figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   <span class="comment">// also test two way binding</span></div><div class="line"><span class="keyword">let</span> dateValue = <span class="type">Variable</span>(<span class="type">Date</span>(timeIntervalSince1970: <span class="number">0</span>))</div><div class="line"><span class="number">_</span> = datePicker.rx.date &lt;-&gt; dateValue</div><div class="line"></div><div class="line">dateValue.asObservable()</div><div class="line">    .subscribe(onNext: &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] x <span class="keyword">in</span></div><div class="line">        <span class="keyword">self</span>?.debug(<span class="string">"UIDatePicker date \(x)"</span>)</div><div class="line">    &#125;)</div><div class="line">    .disposed(by: disposeBag)</div></pre></td></tr></table></figure>
<h1 id="UIGestureRecognizer"><a href="#UIGestureRecognizer" class="headerlink" title="UIGestureRecognizer"></a>UIGestureRecognizer</h1><blockquote>
<p>手势回调，x是UIPanGestureRecognizer对象</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   mypan.rx.event</div><div class="line">.subscribe(onNext: &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] x <span class="keyword">in</span></div><div class="line">    <span class="keyword">self</span>?.debug(<span class="string">"UIGestureRecognizer event \(x.state)"</span>)</div><div class="line">    <span class="keyword">let</span> p = x.location(<span class="keyword">in</span>: x.view)</div><div class="line">    <span class="keyword">self</span>?.debug(<span class="string">"pan ges point: \(p)"</span>)</div><div class="line">&#125;)</div><div class="line">.disposed(by: disposeBag)</div></pre></td></tr></table></figure>
<h1 id="CLLocationManager"><a href="#CLLocationManager" class="headerlink" title="CLLocationManager"></a>CLLocationManager</h1><blockquote>
<p>还有一堆didxxx方法，自己Command点进去看</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">  manager.requestWhenInUseAuthorization()</div><div class="line"></div><div class="line">manager.rx.didUpdateLocations</div><div class="line">    .subscribe(onNext: &#123; x <span class="keyword">in</span></div><div class="line">        <span class="built_in">print</span>(<span class="string">"rx.didUpdateLocations \(x)"</span>)</div><div class="line">    &#125;)</div><div class="line">    .disposed(by: disposeBag)</div><div class="line"></div><div class="line"><span class="number">_</span> = manager.rx.didFailWithError</div><div class="line">    .subscribe(onNext: &#123; x <span class="keyword">in</span></div><div class="line">        <span class="built_in">print</span>(<span class="string">"rx.didFailWithError \(x)"</span>)</div><div class="line">    &#125;)</div><div class="line">    </div><div class="line">manager.rx.didChangeAuthorizationStatus</div><div class="line">    .subscribe(onNext: &#123; status <span class="keyword">in</span></div><div class="line">        <span class="built_in">print</span>(<span class="string">"Authorization status \(status)"</span>)</div><div class="line">    &#125;)</div><div class="line">    .disposed(by: disposeBag)</div><div class="line">    </div><div class="line">manager.startUpdatingLocation()</div></pre></td></tr></table></figure>
<h1 id="UITableView的扩展"><a href="#UITableView的扩展" class="headerlink" title="UITableView的扩展"></a>UITableView的扩展</h1><h2 id="单个section的情况"><a href="#单个section的情况" class="headerlink" title="单个section的情况"></a>单个section的情况</h2><blockquote>
<p>除了下面几个最常用的，还有itemDeselected、itemInserted、itemDeleted等等行为可以订阅，自己Command点进去看</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><div class="line"> <span class="class"><span class="keyword">class</span> <span class="title">SimpleTableViewExampleViewController</span> : <span class="title">ViewController</span>, <span class="title">UITableViewDelegate</span> </span>&#123;</div><div class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> tableView: <span class="type">UITableView</span>!</div><div class="line"></div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.viewDidLoad()</div><div class="line"></div><div class="line">        <span class="keyword">let</span> items = <span class="type">Observable</span>.just(</div><div class="line">            (<span class="number">0</span>..&lt;<span class="number">20</span>).<span class="built_in">map</span> &#123; <span class="string">"\($0)"</span> &#125;</div><div class="line">        )</div><div class="line"></div><div class="line">        <span class="comment">//大概是对cellForRowAtIndexPath的封装</span></div><div class="line">        items</div><div class="line">            .bindTo(tableView.rx.items(cellIdentifier: <span class="string">"Cell"</span>, cellType: <span class="type">UITableViewCell</span>.<span class="keyword">self</span>)) &#123;</div><div class="line">                (row, element, cell) <span class="keyword">in</span></div><div class="line">                <span class="comment">//element 是 items[row]元素</span></div><div class="line">                cell.textLabel?.text = <span class="string">"\(element) @ row \(row)"</span></div><div class="line">            &#125;</div><div class="line">            .disposed(by: disposeBag)</div><div class="line"></div><div class="line">        </div><div class="line">        <span class="comment">//点击某个cell触发, value 是 items[row]，类似的是tableView.rx.itemSelected，都是对didSelectRowAtIndexPath的封装</span></div><div class="line">        tableView.rx</div><div class="line">            .modelSelected(<span class="type">String</span>.<span class="keyword">self</span>)</div><div class="line">            .subscribe(onNext:  &#123; value <span class="keyword">in</span></div><div class="line">                <span class="type">DefaultWireframe</span>.presentAlert(<span class="string">"Tapped `\(value)`"</span>)</div><div class="line">            &#125;)</div><div class="line">            .disposed(by: disposeBag)</div><div class="line"></div><div class="line">        <span class="comment">//accessoryButtonTappedForRowWithIndexPath</span></div><div class="line">        tableView.rx</div><div class="line">            .itemAccessoryButtonTapped</div><div class="line">            .subscribe(onNext: &#123; indexPath <span class="keyword">in</span></div><div class="line">                <span class="type">DefaultWireframe</span>.presentAlert(<span class="string">"Tapped Detail @ \(indexPath.section),\(indexPath.row)"</span>)</div><div class="line">            &#125;)</div><div class="line">            .disposed(by: disposeBag)</div><div class="line"></div><div class="line">    &#125;</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="多section的情况"><a href="#多section的情况" class="headerlink" title="多section的情况"></a>多section的情况</h2><figure class="highlight swift"><table><tr><td class="code"><pre><div class="line">   <span class="class"><span class="keyword">class</span> <span class="title">SimpleTableViewExampleSectionedViewController</span> : <span class="title">ViewController</span>, <span class="title">UITableViewDelegate</span> </span>&#123;</div><div class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> tableView: <span class="type">UITableView</span>!</div><div class="line"></div><div class="line">    <span class="keyword">let</span> dataSource = <span class="type">RxTableViewSectionedReloadDataSource</span>&lt;<span class="type">SectionModel</span>&lt;<span class="type">String</span>, <span class="type">Double</span>&gt;&gt;()</div><div class="line"></div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.viewDidLoad()</div><div class="line"></div><div class="line">        <span class="keyword">let</span> dataSource = <span class="keyword">self</span>.dataSource</div><div class="line"></div><div class="line">        <span class="keyword">let</span> items = <span class="type">Observable</span>.just([</div><div class="line">            <span class="type">SectionModel</span>(model: <span class="string">"First section"</span>, items: [</div><div class="line">                    <span class="number">11.0</span>,</div><div class="line">                    <span class="number">12.0</span>,</div><div class="line">                    <span class="number">13.0</span></div><div class="line">                ]),</div><div class="line">            <span class="type">SectionModel</span>(model: <span class="string">"Second section"</span>, items: [</div><div class="line">                    <span class="number">21.0</span>,</div><div class="line">                    <span class="number">22.0</span>,</div><div class="line">                    <span class="number">23.0</span></div><div class="line">                ]),</div><div class="line">            <span class="type">SectionModel</span>(model: <span class="string">"Third section"</span>, items: [</div><div class="line">                    <span class="number">31.0</span>,</div><div class="line">                    <span class="number">32.0</span>,</div><div class="line">                    <span class="number">33.0</span></div><div class="line">                ]),</div><div class="line">            ])</div><div class="line"></div><div class="line">        dataSource.configureCell = &#123; (<span class="number">_</span>, tv, indexPath, element) <span class="keyword">in</span></div><div class="line">            <span class="keyword">let</span> cell = tv.dequeueReusableCell(withIdentifier: <span class="string">"Cell"</span>)!</div><div class="line">            cell.textLabel?.text = <span class="string">"\(element) @ row \(indexPath.row)"</span></div><div class="line">            <span class="keyword">return</span> cell</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        items</div><div class="line">            .bindTo(tableView.rx.items(dataSource: dataSource))</div><div class="line">            .disposed(by: disposeBag)</div><div class="line"></div><div class="line">        tableView.rx</div><div class="line">            .itemSelected</div><div class="line">            .<span class="built_in">map</span> &#123; indexPath <span class="keyword">in</span></div><div class="line">                <span class="keyword">return</span> (indexPath, dataSource[indexPath])</div><div class="line">            &#125;</div><div class="line">            .subscribe(onNext: &#123; indexPath, model <span class="keyword">in</span></div><div class="line">                <span class="type">DefaultWireframe</span>.presentAlert(<span class="string">"Tapped `\(model)` @ \(indexPath)"</span>)</div><div class="line">            &#125;)</div><div class="line">            .disposed(by: disposeBag)</div><div class="line"></div><div class="line">        tableView.rx</div><div class="line">            .setDelegate(<span class="keyword">self</span>)</div><div class="line">            .disposed(by: disposeBag)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">tableView</span><span class="params">(<span class="number">_</span> tableView: UITableView, viewForHeaderInSection section: Int)</span></span> -&gt; <span class="type">UIView</span>? &#123;</div><div class="line">        <span class="keyword">let</span> label = <span class="type">UILabel</span>(frame: <span class="type">CGRect</span>.zero)</div><div class="line">        label.text = dataSource[section].model</div><div class="line">        <span class="keyword">return</span> label</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">tableView</span><span class="params">(<span class="number">_</span> tableView: UITableView, heightForHeaderInSection section: Int)</span></span> -&gt; <span class="type">CGFloat</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">30</span></div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">// to prevent swipe to delete behavior</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">tableView</span><span class="params">(<span class="number">_</span> tableView: UITableView, editingStyleForRowAt indexPath: IndexPath)</span></span> -&gt; <span class="type">UITableViewCellEditingStyle</span> &#123;</div><div class="line">        <span class="keyword">return</span> .<span class="keyword">none</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><a href="https://www.darkhandz.com/2017/02/06/%E5%AD%A6%E4%B9%A0RxSwift%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AE%80%E5%8D%95%E7%94%A8%E6%B3%95/" target="_blank" rel="external">原文</a></p>

          
        
      
    </div>
    
    
    

    



    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/6/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/21/">21</a><a class="extend next" rel="next" href="/page/8/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">千夜 QQ:738816656</p>
              <p class="site-description motion-element" itemprop="description">ReactNative</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">201</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">106</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">77</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">千夜 QQ:738816656</span>

  
</div>





        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>

<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/love.js"></script>
