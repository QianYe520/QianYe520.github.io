<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
<link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">

<meta name="theme-color" content="#222">
<style>
    .pace .pace-progress {
        background: #1E92FB; /*进度条颜色*/
        height: 3px;
    }
    .pace .pace-progress-inner {
         box-shadow: 0 0 10px #1E92FB, 0 0 5px     #1E92FB; /*阴影颜色*/
    }
    .pace .pace-activity {
        border-top-color: #1E92FB;    /*上边框颜色*/
        border-left-color: #1E92FB;    /*左边框颜色*/
    }
</style>








<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="ReactNative">
<meta property="og:type" content="website">
<meta property="og:title" content="千夜、おれはおまえをずっと爱している">
<meta property="og:url" content="http://yoursite.com/page/18/index.html">
<meta property="og:site_name" content="千夜、おれはおまえをずっと爱している">
<meta property="og:description" content="ReactNative">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="千夜、おれはおまえをずっと爱している">
<meta name="twitter:description" content="ReactNative">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/18/"/>





  <title>千夜、おれはおまえをずっと爱している</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">千夜、おれはおまえをずっと爱している</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/23/Blog/Blog-配置/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="千夜 QQ:738816656">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="千夜、おれはおまえをずっと爱している">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/23/Blog/Blog-配置/" itemprop="url">Blog-配置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-23T01:24:17+08:00">
                2017-11-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Blog/" itemprop="url" rel="index">
                    <span itemprop="name">Blog</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://thief.one/2017/03/03/Hexo%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2%E6%95%99%E7%A8%8B/" target="_blank" rel="external">博客配置01</a><br><a href="http://blog.csdn.net/u010064074/article/details/76558729" target="_blank" rel="external">博客配置02</a></p>
<p><a href="http://blog.csdn.net/u012352292" target="_blank" rel="external">RxSwift</a></p>

          
        
      
    </div>
    
    
    

    



    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/23/OC/Code/OC-Code-优化项目/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="千夜 QQ:738816656">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="千夜、おれはおまえをずっと爱している">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/23/OC/Code/OC-Code-优化项目/" itemprop="url">iOS-Code-优化项目</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-23T01:18:52+08:00">
                2017-11-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OC/" itemprop="url" rel="index">
                    <span itemprop="name">OC</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OC/Code/" itemprop="url" rel="index">
                    <span itemprop="name">Code</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://juejin.im/entry/596c32255188254b772db957" target="_blank" rel="external">优化项目</a></p>
<ol>
<li>结构与架构<br>1.1 结构</li>
</ol>
<p>这里说的结构大概有两点：1.文件目录分类 2.第三方库管理<br>1.1.1 文件目录分类</p>
<p>为了方便管理，最好将Xcode中的项目展示目录与实际的存储目录保持一致<br>此外，一般按业务模块分类,一级目录可以按照MVC格式，也可以按照业务模块划分<br>用最普遍的Model View Controller架构举例</p>

          
        
      
    </div>
    
    
    

    



    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/22/OC/Func/iOS-Func-Bug管理工具/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="千夜 QQ:738816656">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="千夜、おれはおまえをずっと爱している">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/22/OC/Func/iOS-Func-Bug管理工具/" itemprop="url">iOS-Func-Bug管理工具</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-22T23:38:49+08:00">
                2017-11-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OC/" itemprop="url" rel="index">
                    <span itemprop="name">OC</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OC/Func/" itemprop="url" rel="index">
                    <span itemprop="name">Func</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#功能</p>
<blockquote>
<p>非Crash Bug 在App内可截图添加描述并发送</p>
<p>Crash Bug 在App第二次启动时提取Crash log添加描述并发送</p>
</blockquote>
<h1 id="实现解释"><a href="#实现解释" class="headerlink" title="实现解释"></a>实现解释</h1><h2 id="分析-bug"><a href="#分析-bug" class="headerlink" title="分析 bug"></a>分析 bug</h2><ul>
<li>非Crash的Bug：字体不对、颜色不对、数据不对、布局不对</li>
<li>Crash Bug：系统Crash、处理signal<h2 id="场景交互"><a href="#场景交互" class="headerlink" title="场景交互"></a>场景交互</h2></li>
<li>场景交互：发现非Crash Bug时候摇一摇手机，弹出邮件，图片带入邮件，点击发送即可。有Crash Bug的时候第二次启动App，弹出邮件，Crash log带入邮件，点击发送即可</li>
</ul>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><blockquote>
<p>需要用到NSSetUncaughtExceptionHandler，MFMailComposeViewController，沙盒，NSFileManager<br>实现截图的功能，考虑到并不是所有的页面都需要使用所以写在了分类里。需要用的时候直接引入头文件即可<br>这三个方法分别在摇一摇的时候回调用，开始，需要，结束。他们的父类是UIResponsder在UIKit中</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line">-(<span class="keyword">void</span>)motionBegan:(<span class="built_in">UIEventSubtype</span>)motion withEvent:(<span class="built_in">UIEvent</span> *)event&#123;&#125;</div><div class="line">-(<span class="keyword">void</span>)motionCancelled:(<span class="built_in">UIEventSubtype</span>)motion withEvent:(<span class="built_in">UIEvent</span> *)event&#123;&#125;</div><div class="line">-(<span class="keyword">void</span>)motionEnded:(<span class="built_in">UIEventSubtype</span>)motion withEvent:(<span class="built_in">UIEvent</span> *)event</div><div class="line">&#123;</div><div class="line">    [<span class="keyword">self</span> screenShot];</div><div class="line">&#125;</div><div class="line"></div><div class="line">-(<span class="keyword">void</span>)screenShot</div><div class="line">&#123;</div><div class="line">    <span class="built_in">UIWindow</span> *screen = [[<span class="built_in">UIApplication</span> sharedApplication] keyWindow];</div><div class="line">    <span class="built_in">UIGraphicsBeginImageContext</span>(screen.frame.size);</div><div class="line">    [screen.layer renderInContext:<span class="built_in">UIGraphicsGetCurrentContext</span>()];</div><div class="line">    <span class="built_in">UIImage</span> *image = <span class="built_in">UIGraphicsGetImageFromCurrentImageContext</span>();</div><div class="line">    <span class="built_in">UIGraphicsGetCurrentContext</span>();</div><div class="line">    <span class="built_in">NSData</span> *screenData = <span class="built_in">UIImagePNGRepresentation</span>(image);</div><div class="line">    [screenData writeToFile:[<span class="built_in">NSHomeDirectory</span>() stringByAppendingPathComponent:<span class="string">@"Library/Caches"</span>] atomically:<span class="literal">YES</span>];   </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="发送邮件的功能"><a href="#发送邮件的功能" class="headerlink" title="发送邮件的功能"></a>发送邮件的功能</h2><blockquote>
<p>发送邮件的功能，也写在了分类里面，需要用的时候引入即可</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UIViewController</span> (<span class="title">send</span>)&lt;<span class="title">MFMailComposeViewControllerDelegate</span>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">//发送邮件的方法，传入标题，描述信息，data, 接收人</span></div><div class="line">-(<span class="keyword">void</span>)sendMail:(MFMailComposeViewController*)mf andSubject:(<span class="built_in">NSString</span>*)subject andMessageBody:(<span class="built_in">NSString</span>*)message andData:(<span class="built_in">NSData</span>*)data  andRecipients:(<span class="built_in">NSArray</span>*)recipients</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span>([MFMailComposeViewController canSendMail])&#123;</div><div class="line">        mf.mailComposeDelegate = <span class="keyword">self</span>;</div><div class="line">        [mf setSubject:subject];</div><div class="line">        [mf setToRecipients:recipients];</div><div class="line">        [mf addAttachmentData:data mimeType:<span class="string">@"image/jpeg"</span> fileName:<span class="string">@"error"</span>];</div><div class="line">        [mf setMessageBody:message isHTML:<span class="literal">YES</span>];</div><div class="line">        [<span class="keyword">self</span> presentViewController:mf animated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        [<span class="keyword">self</span> alertView:<span class="string">@"不能调用邮箱"</span> andDesc:<span class="string">@"请尝试下载App原生邮箱，并配置"</span>];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="MFMailComposeViewControllerDelegate的代理方法，可以在这个方法里面写一些回调"><a href="#MFMailComposeViewControllerDelegate的代理方法，可以在这个方法里面写一些回调" class="headerlink" title="MFMailComposeViewControllerDelegate的代理方法，可以在这个方法里面写一些回调"></a>MFMailComposeViewControllerDelegate的代理方法，可以在这个方法里面写一些回调</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line">-(<span class="keyword">void</span>)mailComposeController:(MFMailComposeViewController *)controller didFinishWithResult:(MFMailComposeResult)result error:(<span class="built_in">NSError</span> *)error</div><div class="line">&#123;</div><div class="line">    <span class="keyword">switch</span> (result) &#123;</div><div class="line">        <span class="keyword">case</span> MFMailComposeResultSent:</div><div class="line"></div><div class="line">            [<span class="keyword">self</span> alertView:<span class="string">@"发送成功"</span> andDesc:<span class="literal">nil</span>];</div><div class="line">            <span class="keyword">self</span>.success();</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> MFMailComposeResultSaved:</div><div class="line">            [<span class="keyword">self</span> alertView:<span class="string">@"保存成功"</span> andDesc:<span class="literal">nil</span>];</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> MFMailComposeResultFailed:</div><div class="line">            <span class="keyword">self</span>.faild();</div><div class="line">            [<span class="keyword">self</span> alertView:error.domain andDesc:[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@"</span>,error.userInfo]];</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> MFMailComposeResultCancelled:</div><div class="line">            [<span class="keyword">self</span> alertView:<span class="string">@"取消发送"</span> andDesc:<span class="literal">nil</span>];</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">default</span>:</div><div class="line">            [<span class="keyword">self</span> alertView:<span class="string">@"为什么不发送"</span> andDesc:<span class="literal">nil</span>];</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">    [<span class="keyword">self</span> dismissViewControllerAnimated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="异常捕获"><a href="#异常捕获" class="headerlink" title="异常捕获"></a>异常捕获</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line">这两个为函数方法，导入类名，直接可调用不用初始化</div><div class="line"><span class="keyword">void</span> CrashExceptionHandler(<span class="keyword">void</span>)</div><div class="line">&#123;</div><div class="line">    <span class="built_in">NSSetUncaughtExceptionHandler</span>(&amp;ExceptionLog);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> ExceptionLog(<span class="built_in">NSException</span> *exception)</div><div class="line">&#123;</div><div class="line">    <span class="built_in">NSDate</span> *date_current = [<span class="built_in">NSDate</span> date];</div><div class="line">    <span class="built_in">NSDictionary</span> *dictInfo = [[<span class="built_in">NSBundle</span> mainBundle]infoDictionary];</div><div class="line">    <span class="built_in">NSString</span> *name_App = [dictInfo objectForKey:<span class="string">@"CFBundleDisplayName"</span>];</div><div class="line">    <span class="built_in">NSString</span> *verson_App = [dictInfo objectForKey:<span class="string">@"CFBundleShortVersionString"</span>];</div><div class="line">    <span class="built_in">NSString</span> *build_App = [dictInfo objectForKey:<span class="string">@"CFBundleVersion"</span>];</div><div class="line">    <span class="built_in">NSArray</span> *ecp = exception.callStackSymbols;</div><div class="line">    <span class="built_in">NSString</span> *reason = [exception reason];</div><div class="line">    <span class="built_in">NSString</span> *name = [exception name];</div><div class="line">    <span class="built_in">NSString</span> *exceptionInfo = [<span class="built_in">NSString</span> stringWithFormat:</div><div class="line">                               <span class="string">@"\n\n ******************************异常日志****************************** \n时间:%@\nApp名称:%@\nApp版本:%@\nBuild版本:%@\n异常名称:%@\n异常原因:%@\n堆栈信息:%@"</span>,date_current,name_App,verson_App,build_App,name,reason,ecp];</div><div class="line">    [CrashHandler saveLog:exceptionInfo andDate:date_current];</div><div class="line"><span class="meta">#ifdef DEBUG</span></div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,exceptionInfo);</div><div class="line"><span class="meta">#else</span></div><div class="line"></div><div class="line"><span class="meta">#endif</span></div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">CrashHandler</span></span></div><div class="line">+(<span class="keyword">void</span>)saveLog:(<span class="built_in">NSString</span> *)crashLog andDate:(<span class="built_in">NSDate</span> *)date</div><div class="line">&#123;</div><div class="line">    <span class="built_in">NSString</span> *path = [[<span class="built_in">NSSearchPathForDirectoriesInDomains</span>(<span class="built_in">NSCachesDirectory</span>, <span class="built_in">NSUserDomainMask</span>, <span class="literal">YES</span>)objectAtIndex:<span class="number">0</span>] stringByAppendingString:<span class="string">@"/Crash"</span>];</div><div class="line">    <span class="keyword">if</span>(![[<span class="built_in">NSFileManager</span> defaultManager]fileExistsAtPath:path])</div><div class="line">    &#123;</div><div class="line">        [[<span class="built_in">NSFileManager</span> defaultManager]createDirectoryAtPath:path withIntermediateDirectories:<span class="literal">YES</span> attributes:<span class="literal">nil</span> error:<span class="literal">nil</span>];</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">NSString</span> *logPath = [path stringByAppendingFormat:<span class="string">@"/%@.log"</span>,date];</div><div class="line">    [crashLog writeToFile:logPath atomically:<span class="literal">YES</span> encoding:<span class="built_in">NSUTF8StringEncoding</span> error:<span class="literal">nil</span>];</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<h2 id="检测Crash-log-功能在App打开的第一个页面去调用就好"><a href="#检测Crash-log-功能在App打开的第一个页面去调用就好" class="headerlink" title="检测Crash log 功能在App打开的第一个页面去调用就好"></a>检测Crash log 功能在App打开的第一个页面去调用就好</h2><pre><code class="objectivec">-(<span class="keyword">void</span>)crashLog
{
    <span class="built_in">NSString</span> *path = [[<span class="built_in">NSSearchPathForDirectoriesInDomains</span>(<span class="built_in">NSCachesDirectory</span>, <span class="built_in">NSUserDomainMask</span>, <span class="literal">YES</span>)objectAtIndex:<span class="number">0</span>] stringByAppendingString:<span class="string">@"/Crash"</span>];
    <span class="built_in">NSFileManager</span> *mf = [<span class="built_in">NSFileManager</span> defaultManager];
    <span class="keyword">if</span>(![mf fileExistsAtPath:path])
    {
        <span class="keyword">return</span>;
    }
    <span class="built_in">NSArray</span> *array = [mf contentsOfDirectoryAtPath:path error:<span class="literal">nil</span>]; 
 }
</code></pre>
<p><a href="https://juejin.im/post/59db05d5f265da065c5ebed4" target="_blank" rel="external">Bug管理工具</a></p>

          
        
      
    </div>
    
    
    

    



    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/22/OC/Code/OC-Code-Crash日志/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="千夜 QQ:738816656">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="千夜、おれはおまえをずっと爱している">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/22/OC/Code/OC-Code-Crash日志/" itemprop="url">iOS-Crash日志</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-22T22:22:26+08:00">
                2017-11-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OC/" itemprop="url" rel="index">
                    <span itemprop="name">OC</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OC/Code/" itemprop="url" rel="index">
                    <span itemprop="name">Code</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="获得crash日志"><a href="#获得crash日志" class="headerlink" title="获得crash日志"></a>获得crash日志</h1><h2 id="产生-保存"><a href="#产生-保存" class="headerlink" title="产生/保存"></a>产生/保存</h2><ul>
<li>程序崩溃时，系统会创建一份crash日志保存在设备上。</li>
<li>这份crash日志记录着应用程序崩溃时的信息，包含每个执行线程的栈调用信息（低内存闪退日志例外），对定位问题很有帮助</li>
</ul>
<h2 id="连接设备获取"><a href="#连接设备获取" class="headerlink" title="连接设备获取"></a>连接设备获取</h2><ul>
<li>可以连接设备，打开Xcode - Window - Organizer，</li>
<li>在左侧面板中选择Device Logs（可以选择具体设备的Device Logs或者Library下所有设备的Device Logs）</li>
<li>然后根据时间排序查看设备上的crash日志</li>
</ul>
<h2 id="已发布app通过iTunes-Connect获取"><a href="#已发布app通过iTunes-Connect获取" class="headerlink" title="已发布app通过iTunes Connect获取"></a>已发布app通过iTunes Connect获取</h2><ul>
<li>可以通过iTunes Connect（Manage Your Applications - View Details - Crash Reports）获取用户的crash日志</li>
<li>不过这并不是100%有效的，而且大多数开发者并不依赖于此，因为这需要用户设备同意上传相关信息，详情可参见iOS: Providing Apple with diagnostics and usage information摘要</li>
</ul>
<h2 id="接入现有的crash收集工具获取"><a href="#接入现有的crash收集工具获取" class="headerlink" title="接入现有的crash收集工具获取"></a>接入现有的crash收集工具获取</h2><p>通常接入现有的crash收集工具，或者自己编写一个进行自动化收集、解析和统计汇总</p>
<h1 id="解析crash日志"><a href="#解析crash日志" class="headerlink" title="解析crash日志"></a>解析crash日志</h1><h2 id="符号化解析"><a href="#符号化解析" class="headerlink" title="符号化解析"></a>符号化解析</h2><ul>
<li>当获得一份crash日志时，需要将初始展示的十六进制地址等原始信息映射为源代码级别的方法名称和代码行数，使其对开发人员可读这个过程称为符号化解析。要成功地符号化解析一份crash日志，我们需要有对应的应用程序二进制文件以及符号（.dSYM）文件</li>
</ul>
<p>-如果处于开发调试阶段，通常Xcode都能匹配到crash日志对应的二进制文件和符号文件，所以能够帮我们自动解析。</p>
<ul>
<li>如果处于测试阶段，测试人员已经安装了不同的版本（比如alpha、beta版本），那么需要保存好对应版本的二进制文件和符号文件，以便在应用程序崩溃时对crash日志进行解析。对于这种场景下产生的crash日志，只需要将.crash文件、.app文件和.dSYM文件三者放在同一个目录下，然后将.crash文件拖放到Xcode - Window - Organizer中左侧面板Library下的Device Logs中，即可进行解析。</li>
</ul>
<p>如果要提交发布，那么我们通常会先执行Clean，再Build，最后通过Product - Archive来打包。这样，Xcode会将二进制文件和符号文件归档在一起，可以通过Organizer中的Archives进行浏览</p>
<p><a href="http://stackoverflow.com/questions/1460892/symbolicating-iphone-app-crash-reports" target="_blank" rel="external">关于如何解析crash日志的讨论</a></p>
<h1 id="分析crash日志"><a href="#分析crash日志" class="headerlink" title="分析crash日志"></a>分析crash日志</h1><ul>
<li>在分析一份crash日志之前，如果开发人员对于常见的错误类型有所了解，那定是极好的。</li>
<li>crash日志的产生来源于两种问题：违反iOS策略被干掉，以及自身的代码bug</li>
</ul>
<h1 id="iOS策略"><a href="#iOS策略" class="headerlink" title="iOS策略"></a>iOS策略</h1><h2 id="低内存闪退"><a href="#低内存闪退" class="headerlink" title="低内存闪退"></a>低内存闪退</h2><blockquote>
<p>低内存闪退日志</p>
<ul>
<li>前面提到大多数crash日志都包含着执行线程的栈调用信息</li>
<li>但是低内存闪退日志除外，这里就先看看低内存闪退日志是什么样的<br>我们使用Xcode 5和iOS 7的设备模拟一次低内存闪退，然后通过Organizer查看产生的crash日志，可以发现Process和Type都为Unknown：</li>
</ul>
</blockquote>
<p><img src="http://ozr735s7e.bkt.clouddn.com/iOS-Func-Crash%E6%97%A5%E5%BF%97-%20001.png" alt="001"></p>
<blockquote>
<p>具体的日志内容如下</p>
<p><img src="http://ozr735s7e.bkt.clouddn.com/iOS-Func-Crash%E6%97%A5%E5%BF%97-%20002.png" alt="002"></p>
</blockquote>
<ul>
<li>第一部分是崩溃信息，包括识别标识、软硬件信息和时间信息等。</li>
<li>第二部分是内存页分配信息，以及当前占用内存最多的进程，上图中为crashTypeDemo。</li>
<li><p>第三部分是具体的进程列表，描述着每个进程使用内存的情况以及当前状态。在较早的版本中可以在某些进程后面看到“jettisoned”字样，表明这些进程使用过多内存被终止了，而现在我们看到的是“vm-pageshortage”字样。</p>
</li>
<li><p>当iOS检测到内存过低时，它（的VM系统）会发出低内存警告通知，尝试回收一些内存；如果情况没有得到足够的改善，iOS会终止后台应用以回收更多内存；最后，如果内存还是不足，那么正在运行的应用可能会被终止掉。</p>
</li>
<li>所以，我们的应用应该合理地响应系统抛出来的低内存警告通知，对一些缓存数据和可重新创建的对象进行释放，同时要避免出现内存泄露等问题。</li>
</ul>
<p>低内存闪退是由iOS策略决定终止应用程序运行的，同样基于iOS策略的还有Watchdog超时和用户强制退出</p>
<h2 id="Watchdog超时"><a href="#Watchdog超时" class="headerlink" title="Watchdog超时"></a>Watchdog超时</h2><ul>
<li><p>Apple的iOS Developer Library网站上，QA1693文档中描述了Watchdog机制，包括生效场景和表现。如果我们的应用程序对一些特定的UI事件（比如启动、挂起、恢复、结束）响应不及时，Watchdog会把我们的应用程序干掉，并生成一份响应的crash报告</p>
</li>
<li><p>这份crash报告的有趣之处在于异常代码：“0x8badf00d”，即“ate bad food”</p>
</li>
<li><p>如果说特定的UI事件比较抽象，那么用代码来直接描述的话，对应的就是（创建一个工程时Xcode自动生成的）UIApplicationDelegate的几个方法：</p>
</li>
</ul>
<p><img src="http://ozr735s7e.bkt.clouddn.com/iOS-Func-Crash%E6%97%A5%E5%BF%97%20-%20003.png" alt="003"></p>
<ul>
<li>所以当遇到Watchdog日志时，可以检查下上图几个方法是否有比较重的阻塞UI的动作</li>
<li>QA1693举的例子是在主线程进行同步网络请求。如果我们是在公司的Wifi环境下使用则一切顺利，但当应用程序发布出去面向很大范围的用户，在各种网络环境下运行，则不可避免地会出现一片Watchdog超时报告。<br>另一种可能出现问题的场景就是数据量比较大的情况下进行的数据库版本迁移（同样是在主线程上），这也是促使我写这篇总结的一个直接因素。</li>
</ul>
<h2 id="用户强制退出"><a href="#用户强制退出" class="headerlink" title="用户强制退出"></a>用户强制退出</h2><ul>
<li><p>一看到“用户强制退出”，首先可能想到的双击Home键，然后关闭应用程序。不过这种场景是不会产生crash日志的，因为双击Home键后，所有的应用程序都处于后台状态，而iOS随时都有可能关闭后台进程，所以这种场景没有crash日志。</p>
</li>
<li><p>另一种场景是用户同时按住电源键和Home键，让iPhone重启。这种场景会产生日志（仅验证过一次），但并不针对特定应用程序。</p>
</li>
<li><p>这里指的“用户强制退出”场景，是稍微比较复杂点的操作：先按住电源键，直到出现“滑动关机”的界面时，再按住Home键，这时候当前应用程序会被终止掉，并且产生一份相应事件的crash日志</p>
</li>
</ul>
<p><img src="http://ozr735s7e.bkt.clouddn.com/iOS-Func-Crash%E6%97%A5%E5%BF%97-%20004.png" alt="004"></p>
<ul>
<li>通常，用户应该是遇到应用程序卡死，并且影响到了iOS响应，才会进行这样的操作——不过感觉这操作好高级，所以这样的crash日志应该比较少见</li>
</ul>
<h1 id="常见错误标识"><a href="#常见错误标识" class="headerlink" title="常见错误标识"></a>常见错误标识</h1><h2 id="Exception-codes"><a href="#Exception-codes" class="headerlink" title="Exception codes"></a>Exception codes</h2><p>上面“用户强制退出”的crash日志中的Exception Codes是“0xdeadfa11”，再上面“Watchdog超时”的crash日志中的Exception Codes是“0x8badf00d”，这些都是特有的Exception codes。<br>根据官方文档描述，至少有以下几种特定异常代码：</p>
<p>0x8badf00d错误码：Watchdog超时，意为“ate bad food”。</p>
<p>0xdeadfa11错误码：用户强制退出，意为“dead fall”。</p>
<p>0xbaaaaaad错误码：用户按住Home键和音量键，获取当前内存状态，不代表崩溃。<br><img src="http://ozr735s7e.bkt.clouddn.com/iOS-Func-Crash%E6%97%A5%E5%BF%97-%20005.png" alt="005"><br>0xbad22222错误码：VoIP应用（因为太频繁？）被iOS干掉。</p>
<p>0xc00010ff错误码：因为太烫了被干掉，意为“cool off”。</p>
<p>0xdead10cc错误码：因为在后台时仍然占据系统资源（比如通讯录）被干掉，意为“dead lock”</p>
<h2 id="Exception-types"><a href="#Exception-types" class="headerlink" title="Exception types"></a>Exception types</h2><p>查看我们的crash分析报告邮件，会发现最经常遇到的错误类型是SEGV（Segmentation Violation，段违例），表明内存操作不当，比如访问一个没有权限的内存地址。<br>当我们收到SIGSEGV信号时，可以往以下几个方面考虑：<br>访问无效内存地址，比如访问Zombie对象；<br>尝试往只读区域写数据；<br>解引用空指针；<br>使用未初始化的指针；<br>栈溢出；<br>此外，还有其它常见信号：<br>SIGABRT：收到Abort信号，可能自身调用abort()或者收到外部发送过来的信号；<br>SIGBUS：总线错误。与SIGSEGV不同的是，SIGSEGV访问的是无效地址（比如虚存映射不到物理内存），而SIGBUS访问的是有效地址，但总线访问异常（比如地址对齐问题）；<br>SIGILL：尝试执行非法的指令，可能不被识别或者没有权限；<br>SIGFPE：Floating Point Error，数学计算相关问题（可能不限于浮点计算），比如除零操作；<br>SIGPIPE：管道另一端没有进程接手数据</p>
<h2 id="代码bug"><a href="#代码bug" class="headerlink" title="代码bug"></a>代码bug</h2><p>此外，比较常见的崩溃基本都源于代码bug，比如数组越界、插空、多线程安全性、访问野指针、发送未实现的selector等。如果引入Core Data，则又有另外一些常见问题，不过这是另一个话题了。</p>
<p>遇到这些bug时，都有比较清楚的错误原因说明，比如“index 0 beyond bounds for empty array”等。需要稍微注意点的是多线程问题，当一时找不到解决思路时，不妨往多线程方面考虑下</p>
<p><a href="http://blog.csdn.net/jasonblog/article/details/19031517" target="_blank" rel="external">iOS应用的crash日志的分析基础</a></p>

          
        
      
    </div>
    
    
    

    



    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/22/OC/Func/iOS-Func-检测主线程卡顿的问题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="千夜 QQ:738816656">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="千夜、おれはおまえをずっと爱している">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/22/OC/Func/iOS-Func-检测主线程卡顿的问题/" itemprop="url">iOS-Func-检测主线程卡顿的问题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-22T21:58:35+08:00">
                2017-11-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OC/" itemprop="url" rel="index">
                    <span itemprop="name">OC</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OC/Func/" itemprop="url" rel="index">
                    <span itemprop="name">Func</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="runloop-检测方案"><a href="#runloop-检测方案" class="headerlink" title="runloop - 检测方案"></a>runloop - 检测方案</h1><p>  <a href="https://juejin.im/post/59edb7596fb9a0450d103f34" target="_blank" rel="external">原文文档</a></p>
<h2 id="CFRunLoopRun"><a href="#CFRunLoopRun" class="headerlink" title="CFRunLoopRun"></a>CFRunLoopRun</h2><p><a href="http://opensource.apple.com/source/CF/CF-1151.16/CFRunLoop.c" target="_blank" rel="external">CFRunLoopRun源代码</a></p>
<blockquote>
<p>核心方法CFRunLoopRun简化后的主要逻辑大概是这样的:<br>NSRunLoop调用方法主要就是在kCFRunLoopBeforeSources和kCFRunLoopBeforeWaiting之间,还有kCFRunLoopAfterWaiting之后,也就是如果我们发现这两个时间内耗时太长,那么就可以判定出此时主线程卡顿</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line">   int32_t __CFRunLoopRun()</div><div class="line">&#123;</div><div class="line">    <span class="comment">//通知即将进入runloop</span></div><div class="line">    __CFRunLoopDoObservers(KCFRunLoopEntry);</div><div class="line">    </div><div class="line">    <span class="keyword">do</span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">// 通知将要处理timer和source</span></div><div class="line">        __CFRunLoopDoObservers(kCFRunLoopBeforeTimers);</div><div class="line">        __CFRunLoopDoObservers(kCFRunLoopBeforeSources);</div><div class="line">        </div><div class="line">        __CFRunLoopDoBlocks();  <span class="comment">//处理非延迟的主线程调用</span></div><div class="line">        __CFRunLoopDoSource0(); <span class="comment">//处理UIEvent事件</span></div><div class="line">        </div><div class="line">        <span class="comment">//GCD dispatch main queue</span></div><div class="line">        CheckIfExistMessagesInMainDispatchQueue();</div><div class="line">        </div><div class="line">        <span class="comment">// 即将进入休眠</span></div><div class="line">        __CFRunLoopDoObservers(kCFRunLoopBeforeWaiting);</div><div class="line">        </div><div class="line">        <span class="comment">// 等待内核mach_msg事件</span></div><div class="line">        mach_port_t wakeUpPort = SleepAndWaitForWakingUpPorts();</div><div class="line">        </div><div class="line">        <span class="comment">// Zzz...</span></div><div class="line">        </div><div class="line">        <span class="comment">// 从等待中醒来</span></div><div class="line">        __CFRunLoopDoObservers(kCFRunLoopAfterWaiting);</div><div class="line">        </div><div class="line">        <span class="comment">// 处理因timer的唤醒</span></div><div class="line">        <span class="keyword">if</span> (wakeUpPort == timerPort)</div><div class="line">            __CFRunLoopDoTimers();</div><div class="line">        </div><div class="line">        <span class="comment">// 处理异步方法唤醒,如dispatch_async</span></div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (wakeUpPort == mainDispatchQueuePort)</div><div class="line">            __CFRUNLOOP_IS_SERVICING_THE_MAIN_DISPATCH_QUEUE__()</div><div class="line">            </div><div class="line">        <span class="comment">// UI刷新,动画显示</span></div><div class="line">        <span class="keyword">else</span></div><div class="line">            __CFRunLoopDoSource1();</div><div class="line">        </div><div class="line">        <span class="comment">// 再次确保是否有同步的方法需要调用</span></div><div class="line">        __CFRunLoopDoBlocks();</div><div class="line">        </div><div class="line">    &#125; <span class="keyword">while</span> (!stop &amp;&amp; !timeout);</div><div class="line">    </div><div class="line">    <span class="comment">//通知即将退出runloop</span></div><div class="line">    __CFRunLoopDoObservers(<span class="built_in">CFRunLoopExit</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="runloop-的状态"><a href="#runloop-的状态" class="headerlink" title="runloop 的状态"></a>runloop 的状态</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="built_in">CF_OPTIONS</span>(<span class="built_in">CFOptionFlags</span>, <span class="built_in">CFRunLoopActivity</span>) </div><div class="line">&#123;</div><div class="line">    kCFRunLoopEntry         = (<span class="number">1</span>UL &lt;&lt; <span class="number">0</span>), <span class="comment">// 即将进入Loop</span></div><div class="line">    kCFRunLoopBeforeTimers  = (<span class="number">1</span>UL &lt;&lt; <span class="number">1</span>), <span class="comment">// 即将处理 Timer</span></div><div class="line">    kCFRunLoopBeforeSources = (<span class="number">1</span>UL &lt;&lt; <span class="number">2</span>), <span class="comment">// 即将处理 Source</span></div><div class="line">    kCFRunLoopBeforeWaiting = (<span class="number">1</span>UL &lt;&lt; <span class="number">5</span>), <span class="comment">// 即将进入休眠</span></div><div class="line">    kCFRunLoopAfterWaiting  = (<span class="number">1</span>UL &lt;&lt; <span class="number">6</span>), <span class="comment">// 刚从休眠中唤醒</span></div><div class="line">    kCFRunLoopExit          = (<span class="number">1</span>UL &lt;&lt; <span class="number">7</span>), <span class="comment">// 即将退出Loop</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<blockquote>
<p>耗时进行判断</p>
<ul>
<li>利用 <strong>kCFRunLoopBeforeSources</strong> 和 <strong>*kCFRunLoopAfterWaiting</strong> 这两个状态之间的耗时</li>
<li>进行判断:<strong>是否有太多事件处理导致出现了卡顿</strong></li>
</ul>
<p>AppDelegate+AppService 监听runloop的状态而写的回调函数</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="keyword">static</span> <span class="keyword">void</span> runLoopObserverCallBack(<span class="built_in">CFRunLoopObserverRef</span> observer, <span class="built_in">CFRunLoopActivity</span> activity, <span class="keyword">void</span> *info)</div><div class="line">&#123;</div><div class="line">    PingConfig *object = (__bridge PingConfig*)info;</div><div class="line">    <span class="comment">// 记录状态值</span></div><div class="line">    object-&gt;activity = activity;</div><div class="line">    <span class="comment">// 发送信号</span></div><div class="line">    dispatch_semaphore_t semaphore = object-&gt;semaphore;</div><div class="line">    dispatch_semaphore_signal(semaphore);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="AppDelegate-注册监听"><a href="#AppDelegate-注册监听" class="headerlink" title="AppDelegate 注册监听"></a>AppDelegate 注册监听</h2><ul>
<li><p>PingConfig: 一个用来存储runloop的状态和信号量的自定义类，其中的结构如下</p>
</li>
<li><p>APP启动时我可以进入 registerObserver 方法，其中首先我创建一个记录信息的类PingConfig实例，然后创建一个信号，并且保存在这个PingConfig实例中(其实只是为了方便拿到</p>
</li>
<li></li>
<li><p>创建了一个观察者监测主线程的runloop,它会在主线程runloop状态切换时进行回调</p>
</li>
<li><p>开启一个子线程，并且在里面进行一个 while 循环，在 循环的开始处 wait 一个信号量，并且设置超时为 50毫秒，失败后会返回一个非0数，成功将会返回0，这时候线程会阻塞住等待一个信号的发出</p>
</li>
<li><p>如果runloop状态正常切换，那么就会进入回调函数，在回调函数中我们发出一个信号，并且记录当前状态到PingConfig实例中，下面的判断语句中发现为0，timeoutCount自动置为0，一切正常</p>
</li>
<li><p>当主线程出现卡顿，while循环中的信号量再次等待，但是回调函数没有触发，从而导致等待超时，返回一个非0数，进入判断句后，我们再次判断状态是否处于 kCFRunLoopBeforeSources 或 kCFRunLoopAfterWaiting，如果成立，timeoutCount+1</p>
</li>
</ul>
<ul>
<li>持续五次runloop不切换状态，说明runloop正在处理某个棘手的事件无法休息且不更新状态，这样while循环中的信号量超时会一直发生，超过5次后我们将断定主线程的卡顿并上传堆栈信息</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)registerObserver</div><div class="line">&#123;</div><div class="line">    PingConfig *config = [PingConfig new];</div><div class="line">    <span class="comment">// 创建信号</span></div><div class="line">    dispatch_semaphore_t semaphore = dispatch_semaphore_create(<span class="number">0</span>);</div><div class="line">    config-&gt;semaphore = semaphore;</div><div class="line"></div><div class="line">    <span class="built_in">CFRunLoopObserverContext</span> context = &#123;<span class="number">0</span>,(__bridge <span class="keyword">void</span>*)config,<span class="literal">NULL</span>,<span class="literal">NULL</span>&#125;;</div><div class="line">    <span class="built_in">CFRunLoopObserverRef</span> observer = <span class="built_in">CFRunLoopObserverCreate</span>(kCFAllocatorDefault,</div><div class="line">                                                            kCFRunLoopAllActivities,</div><div class="line">                                                            <span class="literal">YES</span>,</div><div class="line">                                                            <span class="number">0</span>,</div><div class="line">                                                            &amp;runLoopObserverCallBack,</div><div class="line">                                                            &amp;context);</div><div class="line">    <span class="built_in">CFRunLoopAddObserver</span>(<span class="built_in">CFRunLoopGetMain</span>(), observer, kCFRunLoopCommonModes);</div><div class="line"></div><div class="line">    __block uint8_t timeoutCount = <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="comment">// 在子线程监控时长</span></div><div class="line">    <span class="built_in">dispatch_async</span>(dispatch_get_global_queue(<span class="number">0</span>, <span class="number">0</span>), ^&#123;</div><div class="line">        <span class="keyword">while</span> (<span class="literal">YES</span>)</div><div class="line">        &#123;</div><div class="line">            <span class="comment">// 假定连续5次超时50ms认为卡顿(当然也包含了单次超时250ms)</span></div><div class="line">            <span class="keyword">long</span> st = dispatch_semaphore_wait(semaphore, dispatch_time(DISPATCH_TIME_NOW, <span class="number">50</span>*<span class="built_in">NSEC_PER_MSEC</span>));</div><div class="line">            <span class="keyword">if</span> (st != <span class="number">0</span>)</div><div class="line">            &#123;</div><div class="line"><span class="comment">//                NSLog(@"循环中--%ld",config-&gt;activity);</span></div><div class="line">                <span class="keyword">if</span> (config-&gt;activity==kCFRunLoopBeforeSources || config-&gt;activity==kCFRunLoopAfterWaiting)</div><div class="line">                &#123;</div><div class="line">                    <span class="keyword">if</span> (++timeoutCount &lt; <span class="number">5</span>)&#123;</div><div class="line">                        <span class="keyword">continue</span>;</div><div class="line">                    &#125;<span class="keyword">else</span>&#123;</div><div class="line">                        <span class="built_in">NSLog</span>(<span class="string">@"卡顿了"</span>);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            timeoutCount = <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="PingConfig"><a href="#PingConfig" class="headerlink" title="PingConfig"></a>PingConfig</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">PingConfig</span> : <span class="title">NSObject</span></span></div><div class="line">&#123;</div><div class="line"> <span class="keyword">@public</span></div><div class="line"> <span class="built_in">CFRunLoopActivity</span> activity;</div><div class="line"> dispatch_semaphore_t semaphore;</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<h1 id="Other情况主线程卡顿"><a href="#Other情况主线程卡顿" class="headerlink" title="Other情况主线程卡顿"></a>Other情况主线程卡顿</h1><h2 id="主线程卡在界面尚未完全显示前"><a href="#主线程卡在界面尚未完全显示前" class="headerlink" title="主线程卡在界面尚未完全显示前"></a>主线程卡在界面尚未完全显示前</h2><blockquote>
<p>当主线程卡在界面尚未完全显示前，这个方案就检测不出来卡顿了，比如我将下面的代码放在B控制器中</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line">dispatch_semaphore_t t = dispatch_semaphore_create(<span class="number">0</span>);</div><div class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">3.0</span> * <span class="built_in">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"----"</span>);</div><div class="line">        dispatch_semaphore_signal(t);</div><div class="line">    &#125;);</div><div class="line">    dispatch_semaphore_wait(t, DISPATCH_TIME_FOREVER);</div></pre></td></tr></table></figure>
<ul>
<li>上面是一段有问题的代码，将导致主线程的持续堵塞，如果我们在这段代码放在B控制器的ViewDidLoad方法中(ViewWillAppear同样)</li>
<li>运行后，当你希望push到B控制器时，项目将在上一个界面完全卡住，并且无法用上面的方案检测到，而且CPU及内存都显示正常</li>
</ul>
<h2 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h2><ul>
<li>由于runloop在处理完source0或者source1后，比如界面的跳转也是执行了方法，具体有没有用到source0这不重要，但是后面会紧接着进入准备睡眠(kCFRunLoopBeforeWaiting)的状态，然而此时线程的阻塞导致runloop的状态也被卡住无法切换，这样也就导致在那段检测代码中无法进入条件，从而检测不出来。</li>
<li>但是话说回来，APP在静止状态(保持休眠)和刚刚那种卡死状态都会使runloop维持在 kCFRunLoopBeforeWaiting状态，这样我们就无法在那段代码中增加判断来修复，因为无法知道到底是真的静止没有操作还是被阻塞住，我也没找到线程的阻塞状态属性，如果你发现这个属性，那么就可以使用那个属性来判断</li>
</ul>
<h2 id="检测方案"><a href="#检测方案" class="headerlink" title="检测方案"></a>检测方案</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="built_in">dispatch_queue_t</span> serialQueue = dispatch_queue_create(<span class="string">"serial"</span>, DISPATCH_QUEUE_SERIAL);</div><div class="line">    <span class="keyword">self</span>.timer = dispatch_source_create(DISPATCH_SOURCE_TYPE_TIMER, <span class="number">0</span>, <span class="number">0</span>, serialQueue);</div><div class="line">    dispatch_source_set_timer(<span class="keyword">self</span>.timer, DISPATCH_TIME_NOW, <span class="number">0.25</span> * <span class="built_in">NSEC_PER_SEC</span>, <span class="number">0</span>);</div><div class="line"></div><div class="line">    __block int8_t chokeCount = <span class="number">0</span>;</div><div class="line">    dispatch_semaphore_t t2 = dispatch_semaphore_create(<span class="number">0</span>);</div><div class="line">    dispatch_source_set_event_handler(<span class="keyword">self</span>.timer, ^&#123;</div><div class="line">        <span class="keyword">if</span> (config-&gt;activity == kCFRunLoopBeforeWaiting) &#123;</div><div class="line">            <span class="keyword">static</span> <span class="built_in">BOOL</span> ex = <span class="literal">YES</span>;</div><div class="line">            <span class="keyword">if</span> (ex == <span class="literal">NO</span>) &#123;</div><div class="line">                chokeCount ++;</div><div class="line">                <span class="keyword">if</span> (chokeCount &gt; <span class="number">40</span>) &#123;</div><div class="line">                    <span class="built_in">NSLog</span>(<span class="string">@"差不多卡死了"</span>);</div><div class="line">                    dispatch_suspend(<span class="keyword">self</span>.timer);</div><div class="line">                    <span class="keyword">return</span> ;</div><div class="line">                &#125;</div><div class="line">                <span class="built_in">NSLog</span>(<span class="string">@"卡顿了"</span>);</div><div class="line">                <span class="keyword">return</span> ;</div><div class="line">            &#125;</div><div class="line">            <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</div><div class="line">                ex = <span class="literal">YES</span>;</div><div class="line">                dispatch_semaphore_signal(t2);</div><div class="line">            &#125;);</div><div class="line">            <span class="built_in">BOOL</span> su = dispatch_semaphore_wait(t2, dispatch_time(DISPATCH_TIME_NOW, <span class="number">50</span>*<span class="built_in">NSEC_PER_MSEC</span>));</div><div class="line">            <span class="keyword">if</span> (su != <span class="number">0</span>) &#123;</div><div class="line">                ex = <span class="literal">NO</span>;</div><div class="line">            &#125;;</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">    dispatch_resume(<span class="keyword">self</span>.timer);</div></pre></td></tr></table></figure>
<blockquote>
<p>方案解释</p>
</blockquote>
<ul>
<li><p>开启一个异步队列，并且创建一个定时器，时间我设置的是0.25秒，具体时间随你自己，这个时间是用来检测卡死的持续时间</p>
</li>
<li><p>在定时器外面我也同样创建了一个用来同步的信号量，这个不解释了，不会的就去看一下信号量的使用方式。进入定时器的回调后，我设置了一个静态变量来记录主队列是否执行完成。</p>
</li>
<li><p>我们判断当前runloop的状态是否为kCFRunLoopBeforeWaiting，所以这个方案是用来弥补前面那个方案，如果主线程此时没有阻塞住，我们在这里向main Queue抛一个block，看它是否能够成功执行，如果成功执行，说明主线程没有阻塞住，如果已经被阻塞住，那我抛过去的block是肯定不会被执行的。</p>
</li>
<li><p>下面的代码就是一些辅助操作，当信号量超过50毫秒，抛给主线程的block没有执行，那么说明此时就有一些阻塞了，返回一个非0数，并设置 ex为NO，从而在下一次定时器回调到来时进行上报</p>
</li>
</ul>

          
        
      
    </div>
    
    
    

    



    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/22/OC/Kit/Shadow阴影/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="千夜 QQ:738816656">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="千夜、おれはおまえをずっと爱している">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/22/OC/Kit/Shadow阴影/" itemprop="url">iOS-UIKit-Layer-Shadow阴影</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-22T20:16:27+08:00">
                2017-11-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/UIKit/" itemprop="url" rel="index">
                    <span itemprop="name">UIKit</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/UIKit/Layer/" itemprop="url" rel="index">
                    <span itemprop="name">Layer</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>shadowColor:阴影颜色,可设置透明度等.</li>
<li>shadowOffset:偏移量.,xy表示view左上角,width表示阴影与x的偏移量,height表示阴影与y值的偏移量</li>
<li>shadowOpacity = 0.4//阴影透明度,默认为0则看不到阴影.因此要看到阴影这个值必须大于0,shadowColor的透明度也要大于0</li>
<li>shadowRadius:5.模糊计算的半径,取平均值的半径,设置为0的话则为一个矩形块.</li>
<li>模糊度的解释:每一个像素取平均值,分母的取值范围,越大越模糊.感觉这篇文章讲的比较容易懂<br>(<a href="http://www.dongcoder.com/detail-22914.html" target="_blank" rel="external">http://www.dongcoder.com/detail-22914.html</a>).</li>
<li>注意:如果clipsToBounds设置为YES,则阴影效果消失</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">let layer = view.layer</div><div class="line">      layer.shadowColor = UIColor.black.cgColor//阴影颜色</div><div class="line">      layer.shadowOffset = CGSize(width: 10, height: 10)//width表示阴影与x的便宜量,height表示阴影与y值的偏移量</div><div class="line">      layer.shadowOpacity = 0.4//阴影透明度,默认为0则看不到阴影</div><div class="line">      layer.shadowRadius = 5;</div></pre></td></tr></table></figure>
<p><a href="http://blog.csdn.net/taishanduba/article/details/52611502" target="_blank" rel="external">Go!</a></p>

          
        
      
    </div>
    
    
    

    



    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/22/OC/Grammar/iOS-RunTime-方法交换-拦截基础使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="千夜 QQ:738816656">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="千夜、おれはおまえをずっと爱している">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/22/OC/Grammar/iOS-RunTime-方法交换-拦截基础使用/" itemprop="url">iOS-RunTime-方法交换/拦截基础使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-22T11:26:44+08:00">
                2017-11-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/RunTime/" itemprop="url" rel="index">
                    <span itemprop="name">RunTime</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="RunTime的消息机制"><a href="#RunTime的消息机制" class="headerlink" title="RunTime的消息机制"></a>RunTime的消息机制</h1><p><a href="https://juejin.im/post/59e006116fb9a0450a665af2" target="_blank" rel="external">参考链接</a></p>
<blockquote>
<p>Objective-C的方法调用是属于消息传送的机制<br>每个类都有一个isa的结构体指针<br>在这个结构体里, 得到指定类的所有属性, 所有方法的列表, 也可以知父类是什么…</p>
</blockquote>
<h2 id="新建RTMsgModel"><a href="#新建RTMsgModel" class="headerlink" title="新建RTMsgModel"></a>新建RTMsgModel</h2><blockquote>
<p>RTMsgModel.h</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@interface RTMsgModel : NSObject</div><div class="line">- (void)ff_post;</div><div class="line">- (void)ff_getWithCount:(NSInteger)count;</div></pre></td></tr></table></figure>
<blockquote>
<p>RTMsgModel.m</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">- (void)ff_post</div><div class="line">&#123;</div><div class="line">   NSLog(@&quot;被调用了: %@, 当前对象为: %@&quot;, NSStringFromClass([self class]), self);</div><div class="line">&#125;</div><div class="line">- (void)ff_getWithCount:(NSInteger)count</div><div class="line">&#123;</div><div class="line">    NSLog(@&quot;被%ld人调用了&quot;, count);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="测试消息机制"><a href="#测试消息机制" class="headerlink" title="测试消息机制"></a>测试消息机制</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">//</div><div class="line">//  ViewController.m</div><div class="line">//  Runtime方法交换拦截</div><div class="line">//</div><div class="line">//  Created by RN on 17/11/22.</div><div class="line">//  Copyright © 2017年 YueKekui. All rights reserved.</div><div class="line">//</div><div class="line"></div><div class="line">#import &quot;ViewController.h&quot;</div><div class="line">#import &quot;RTMsgModel.h&quot;</div><div class="line">#import &lt;objc/message.h&gt;</div><div class="line">@interface ViewController ()</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line">@implementation ViewController</div><div class="line"></div><div class="line">- (void)viewDidLoad &#123;</div><div class="line">    [super viewDidLoad];</div><div class="line">    [self show_runTimeMsg];</div><div class="line">&#125;</div><div class="line">#pragma mark - RunTime的消息机制</div><div class="line">/**</div><div class="line"> * @brief:  RunTime的消息机制</div><div class="line"> *</div><div class="line"> *</div><div class="line"> *</div><div class="line"> * @attention： Xcode 会自动屏蔽通过objc_msgSend创建对象, 我们可以去到工程里设置</div><div class="line"> *               Build Setting -&gt; Enable Strict Checking of objc_msgSend Calls 改成No</div><div class="line"> */</div><div class="line">- (void)show_runTimeMsg</div><div class="line">&#123;</div><div class="line">    //1.objc_getClass</div><div class="line">    Class getClass = objc_getClass(&quot;RTMsgModel&quot;);</div><div class="line">    NSLog(@&quot;Get The Class is: %@&quot;, getClass);</div><div class="line">    </div><div class="line"></div><div class="line">    //2.objc_msgSend</div><div class="line">    RTMsgModel *messageModel = objc_msgSend(getClass, @selector(alloc));</div><div class="line">    </div><div class="line">    NSLog(@&quot;alloc Object: %@&quot;, messageModel);</div><div class="line">    </div><div class="line">    // 在不调用init方法, 可以通过发消息调用想用的方法, 这里调用没有在.h文件里声明的方法会警告该方法没有声明</div><div class="line">    objc_msgSend(messageModel, @selector(ff_post));</div><div class="line">    </div><div class="line">    messageModel = objc_msgSend(messageModel, @selector(init));</div><div class="line">    </div><div class="line">    NSLog(@&quot;init Object: %@&quot;, messageModel);</div><div class="line">    </div><div class="line">    </div><div class="line">    objc_msgSend(messageModel, @selector(ff_post));</div><div class="line">    </div><div class="line">    // 还有另外一种写法, 就是把所有东西都集合在一起, 也就是我们常用的[[NSObject alloc] init];的原型</div><div class="line">    RTMsgModel *messageModelTwo = objc_msgSend(objc_msgSend(objc_getClass(&quot;RTMsgModel&quot;), @selector(alloc)), @selector(init));</div><div class="line">    objc_msgSend(messageModelTwo, @selector(ff_getWithCount:), 5);</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<h2 id="打印"><a href="#打印" class="headerlink" title="打印"></a>打印</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">2017-11-22 12:36:16.232 Runtime方法交换拦截[21927:3962074] Get The Class is: RTMsgModel</div><div class="line">2017-11-22 12:36:16.233 Runtime方法交换拦截[21927:3962074] alloc Object: &lt;RTMsgModel: 0x600000003680&gt;</div><div class="line">2017-11-22 12:36:16.233 Runtime方法交换拦截[21927:3962074] 被调用了: RTMsgModel, 当前对象为: &lt;RTMsgModel: 0x600000003680&gt;</div><div class="line">2017-11-22 12:36:16.233 Runtime方法交换拦截[21927:3962074] init Object: &lt;RTMsgModel: 0x600000003680&gt;</div><div class="line">2017-11-22 12:36:16.233 Runtime方法交换拦截[21927:3962074] 被调用了: RTMsgModel, 当前对象为: &lt;RTMsgModel: 0x600000003680&gt;</div><div class="line">2017-11-22 12:36:16.233 Runtime方法交换拦截[21927:3962074] 被5人调用了</div></pre></td></tr></table></figure>
<h1 id="RunTime方法交换"><a href="#RunTime方法交换" class="headerlink" title="RunTime方法交换"></a>RunTime方法交换</h1><blockquote>
<p>建一个类RunTimeMethodModel.h</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">#import &lt;Foundation/Foundation.h&gt;</div><div class="line">@interface RunTimeMethodModel : NSObject</div><div class="line">@property (nonatomic, copy) NSString *cl_height;</div><div class="line">@property (nonatomic, copy) NSString *cl_weight;</div><div class="line"></div><div class="line">- (NSString *)cl_height;</div><div class="line">- (NSString *)cl_weight;</div><div class="line">@end</div></pre></td></tr></table></figure>
<blockquote>
<p>RunTimeMethodModel.m</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">- (NSString *)cl_height &#123;</div><div class="line">    return @&quot;我身高180&quot;;</div><div class="line">&#125;</div><div class="line">- (NSString *)cl_weight &#123;</div><div class="line">    return @&quot;我体重280&quot;;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<h2 id="测试交换方法"><a href="#测试交换方法" class="headerlink" title="测试交换方法"></a>测试交换方法</h2><blockquote>
<p>执行方法交换</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">RunTimeMethodModel *methodModel = [[RunTimeMethodModel alloc] init];</div><div class="line"></div><div class="line"> NSLog(@&quot;身高: %@&quot;, methodModel.cl_height);</div><div class="line"> NSLog(@&quot;体重: %@&quot;, methodModel.cl_weight);</div><div class="line"></div><div class="line"> Method methodOne = class_getInstanceMethod([methodModel class], @selector(cl_height));</div><div class="line"> Method methodTwo = class_getInstanceMethod([methodModel class], @selector(cl_weight));</div><div class="line"></div><div class="line"> method_exchangeImplementations(methodOne, methodTwo);</div><div class="line"></div><div class="line"> NSLog(@&quot;打印的内容: %@&quot;, [methodModel cl_height]);</div></pre></td></tr></table></figure>
<h2 id="打印-1"><a href="#打印-1" class="headerlink" title="打印"></a>打印</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">身高: 我身高180</div><div class="line">体重: 我体重280 </div><div class="line">打印的内容: 我体重280</div></pre></td></tr></table></figure>
<h2 id="注意一点"><a href="#注意一点" class="headerlink" title="注意一点"></a>注意一点</h2><p><strong><em>注意一点, 由于这里的ViewController会销毁, 但method_exchangeImplementations会一直存在, 再次进来的时候, 就会再次根据上次交换过的顺序再次交换</em></strong></p>
<blockquote>
<p>+load交换方法</p>
</blockquote>
<h3 id="load交换方法"><a href="#load交换方法" class="headerlink" title="+load交换方法"></a>+load交换方法</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">+ (void)load &#123;</div><div class="line"></div><div class="line">    Method methodOne = class_getInstanceMethod(self, @selector(cl_height));</div><div class="line">    Method methodTwo = class_getInstanceMethod(self, @selector(cl_weight));</div><div class="line"></div><div class="line">    method_exchangeImplementations(methodOne, methodTwo);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (NSString *)cl_height &#123;</div><div class="line"></div><div class="line">    return @&quot;我身高180&quot;;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (NSString *)cl_weight &#123;</div><div class="line"></div><div class="line">    return @&quot;我体重280&quot;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>打印</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">身高: 我体重280</div><div class="line"></div><div class="line">体重: 我身高180</div><div class="line"></div><div class="line">身高: 我体重280</div><div class="line"></div><div class="line">体重: 我身高180</div></pre></td></tr></table></figure>
<h3 id="initialize交换方法"><a href="#initialize交换方法" class="headerlink" title="+initialize交换方法"></a>+initialize交换方法</h3><blockquote>
<p>+load这个方法里的确是可以保证方法交换只有一次, 但这里有一个弊端, 就是当程序一运行就会执行这个方法交换了<br>+load: 程序一开始就会去执行, 只执行一次.<br>+initialize: 当类被初始化的时候会才会去执行, 该类只会执行一次.</p>
<p>initialize<br>class_getInstanceMethod         获取实例方法<br>method_exchangeImplementations  方法交换</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">+ (void)initialize </div><div class="line">+ &#123;</div><div class="line">    Method methodOne = class_getInstanceMethod(self, @selector(cl_height));</div><div class="line">    Method methodTwo = class_getInstanceMethod(self, @selector(cl_weight));</div><div class="line">    method_exchangeImplementations(methodOne, methodTwo);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (NSString *)cl_height &#123;</div><div class="line">    return @&quot;我身高180&quot;;</div><div class="line">&#125;</div><div class="line">- (NSString *)cl_weight &#123;</div><div class="line">    return @&quot;我体重280&quot;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="RunTime方法拦截"><a href="#RunTime方法拦截" class="headerlink" title="RunTime方法拦截"></a>RunTime方法拦截</h1><blockquote>
<p>从刚刚我们就知道, 可以使用method_exchangeImplementations交换两个方法, 但只应用在本类, 现在我们来看看别的应</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@implementation BaseModel</div><div class="line">- (void)cl_logBaseModel &#123;</div><div class="line">    NSLog(@&quot;Base Model Log&quot;);</div><div class="line">&#125;</div><div class="line">@end</div><div class="line"></div><div class="line">@implementation InterceptModel</div><div class="line">- (void)cl_logInterceptModel &#123;</div><div class="line">    NSLog(@&quot;Intercept You Method &quot;);</div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure>
<blockquote>
<p>最终的实现</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">+ (void)initialize &#123;</div><div class="line"></div><div class="line">    Method mehtodOne = class_getInstanceMethod([BaseModel class], @selector(cl_logBaseModel));</div><div class="line">    Method mehtodTwo = class_getInstanceMethod([InterceptModel class], @selector(cl_logInterceptModel));</div><div class="line"></div><div class="line">    method_exchangeImplementations(mehtodOne, mehtodTwo);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)viewDidLoad &#123;</div><div class="line">    [super viewDidLoad];</div><div class="line"></div><div class="line">    self.view.backgroundColor = [UIColor whiteColor];</div><div class="line"></div><div class="line">    BaseModel *baseModel = [[BaseModel alloc] init];</div><div class="line"></div><div class="line">    [baseModel cl_logBaseModel];</div><div class="line">&#125;</div><div class="line">。</div></pre></td></tr></table></figure>
<blockquote>
<p>打印结果<br>发现方法是被InterceptModel这个类拦截, 并且替换了InterceptModel的方法</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">[InterceptModel cl_logInterceptModel] 第15行 Intercept You Method</div></pre></td></tr></table></figure>
<h1 id="类方法也可以交换和拦截"><a href="#类方法也可以交换和拦截" class="headerlink" title="类方法也可以交换和拦截"></a>类方法也可以交换和拦截</h1><blockquote>
<p>新增类方法</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">#import &quot;BaseModel.h&quot;</div><div class="line"></div><div class="line">@implementation BaseModel</div><div class="line"></div><div class="line">- (void)cl_logBaseModel &#123;</div><div class="line"></div><div class="line">    NSLog(@&quot;Base Model Log&quot;);</div><div class="line">&#125;</div><div class="line">+ (void)cl_logBaseModelClass &#123;</div><div class="line"></div><div class="line">    NSLog(@&quot;Base Model Class Log&quot;);</div><div class="line">&#125;</div><div class="line">@end</div><div class="line">-----------------------------------------------</div><div class="line">@implementation InterceptModel</div><div class="line"></div><div class="line">- (void)cl_logInterceptModel &#123;</div><div class="line"></div><div class="line">    NSLog(@&quot;Intercept You Method &quot;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">+ (void)cl_logInterceptModelClass &#123;</div><div class="line"></div><div class="line">    NSLog(@&quot;Intercept Class You Method &quot;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<blockquote>
<p>最终实现<br>class_getInstanceMethod 获取类方法<br>method_exchangeImplementations</p>
<p>initialize<br> class_getInstanceMethod         实例方法<br> class_getClassMethod            类方法<br> method_exchangeImplementations  交换方法</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">+ (void)initialize &#123;</div><div class="line">    // 拦截实例方法</div><div class="line">    Method mehtodOne = class_getInstanceMethod([BaseModel class], @selector(cl_logBaseModel));</div><div class="line">    Method mehtodTwo = class_getInstanceMethod([InterceptModel class], @selector(cl_logInterceptModel));</div><div class="line">    method_exchangeImplementations(mehtodOne, mehtodTwo);</div><div class="line"></div><div class="line">    // 拦截类方法</div><div class="line">    Method classMehtodOne = class_getClassMethod([BaseModel class], @selector(cl_logBaseModelClass));</div><div class="line">    Method classMehtodTwo = class_getClassMethod([InterceptModel class], @selector(cl_logInterceptModelClass));</div><div class="line"></div><div class="line">    method_exchangeImplementations(classMehtodOne, classMehtodTwo);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>执行</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"></div><div class="line">self.view.backgroundColor = [UIColor whiteColor];</div><div class="line"></div><div class="line">BaseModel *baseModel = [[BaseModel alloc] init];</div><div class="line"></div><div class="line">[baseModel cl_logBaseModel];</div><div class="line"></div><div class="line">[BaseModel cl_logBaseModelClass];</div></pre></td></tr></table></figure>
<blockquote>
<p>打印</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">Intercept You Method </div><div class="line"></div><div class="line">Intercept Class You Method</div></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    



    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/22/OC/Kit/UIScrollView基础用法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="千夜 QQ:738816656">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="千夜、おれはおまえをずっと爱している">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/22/OC/Kit/UIScrollView基础用法/" itemprop="url">iOS-UIKit-UIScrollView基础用法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-22T11:11:55+08:00">
                2017-11-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/UIKit/" itemprop="url" rel="index">
                    <span itemprop="name">UIKit</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/UIKit/UIScrollView/" itemprop="url" rel="index">
                    <span itemprop="name">UIScrollView</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h1><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">- (void)viewDidLoad &#123;</div><div class="line">    [super viewDidLoad];</div><div class="line">    _scrollView.backgroundColor = [UIColor redColor];</div><div class="line">    //设置contentSize（必须设置）</div><div class="line">    _scrollView.contentSize = CGSizeMake(400, 667);</div><div class="line">    //偏移量</div><div class="line">    _scrollView.contentOffset = CGPointMake(100, 0);</div><div class="line">    //contentInset(在原有的基础上调整内容滚动区域的大小)</div><div class="line">    //_scrollView.contentInset = UIEdgeInsetsMake(-100, 0, 0, 0);</div><div class="line">    </div><div class="line">    //锁定方向(当系统识别滚动方向的时候，会把另外一个方向锁定，如果识别不了，就不锁定方向)</div><div class="line">    _scrollView.directionalLockEnabled = YES;</div><div class="line">    //反弹效果(默认为yes)</div><div class="line">    _scrollView.bounces = YES;</div><div class="line">    //默认是no，假如是yes并且bounces是yes,甚至如果内容大小小于bounds的时候，允许垂直拖动</div><div class="line">    _scrollView.alwaysBounceVertical = YES;</div><div class="line">    //分页（默认no）</div><div class="line">    _scrollView.pagingEnabled = YES;</div><div class="line">    //滚动(默认yes允许滚动)</div><div class="line">    _scrollView.scrollEnabled = YES;</div><div class="line">    </div><div class="line">    //滚动条</div><div class="line">    //showsHorizontalScrollIndicator默认yes 显示</div><div class="line">    _scrollView.showsHorizontalScrollIndicator = NO;</div><div class="line">    //滚动条滚动的范围(垂直滚动条滚动范围上下各缩小50)</div><div class="line">    _scrollView.scrollIndicatorInsets = UIEdgeInsetsMake(50, 0, 50, 0);</div><div class="line">    //样式</div><div class="line">    _scrollView.indicatorStyle = UIScrollViewIndicatorStyleWhite;</div><div class="line">    // Do any additional setup after loading the view, typically from a nib.</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h1><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">- (void)viewDidLoad &#123;</div><div class="line">    [super viewDidLoad];</div><div class="line">    //创建并添加scrollView</div><div class="line">    UIScrollView *scrollView = [[UIScrollView alloc] initWithFrame:CGRectMake(100, 200, 200, 300)];</div><div class="line">    [self.view addSubview:scrollView];</div><div class="line">    </div><div class="line">    scrollView.backgroundColor = [UIColor redColor];</div><div class="line">    //设置内容视图的大小</div><div class="line">    scrollView.contentSize = CGSizeMake(375, 667);</div><div class="line">    //设置内容视图</div><div class="line">    UIImageView *imageView = [[UIImageView alloc] initWithFrame:CGRectMake(0, 0, 375, 667)];</div><div class="line">    imageView.image = [UIImage imageNamed:@&quot;new_feature_1&quot;];</div><div class="line">    [scrollView addSubview:imageView];</div><div class="line">    </div><div class="line">    _imageView = imageView;</div><div class="line">    //设置代理</div><div class="line">    scrollView.delegate = self;</div><div class="line">    </div><div class="line">    </div><div class="line">    //[self performSelector:@selector(changeScrollViewContentOffSet:) withObject:scrollView afterDelay:3];</div><div class="line">    </div><div class="line">    </div><div class="line">    //设置缩放内容视图的缩放比例范围</div><div class="line">    scrollView.minimumZoomScale = 0.5;</div><div class="line">    scrollView.maximumZoomScale = 1.5;</div><div class="line">    //当缩放比例超出范围之后，是否有反弹效果（no:不会超出范围，yes:超出范围之后反弹）</div><div class="line">    scrollView.bouncesZoom = YES;</div><div class="line">    </div><div class="line">    //属性设置滚动至顶部</div><div class="line">    //scrollView.scrollsToTop = YES;</div><div class="line">    // Do any additional setup after loading the view, typically from a nib.</div><div class="line">&#125;</div><div class="line"></div><div class="line">-(void)changeScrollViewContentOffSet:(UIScrollView *)scrollView&#123;</div><div class="line">    [scrollView setContentOffset:CGPointMake(0, 300) animated:YES];</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">#if 0</div><div class="line">#pragma mark -UIScrollViewDelegate 滚动</div><div class="line">//当scrollView滚动的时候，不停调用（可以监听scrollView的contentOffset）</div><div class="line">- (void)scrollViewDidScroll:(UIScrollView *)scrollView&#123;</div><div class="line">    //NSLog(@&quot;%@&quot;,NSStringFromCGPoint(scrollView.contentOffset));</div><div class="line">    //NSLog(@&quot;decelerating：%d&quot;,scrollView.decelerating);</div><div class="line">    //NSLog(@&quot;dragging：%d&quot;,scrollView.dragging);</div><div class="line">    //NSLog(@&quot;tracking:%d&quot;,scrollView.tracking);</div><div class="line">    NSLog(@&quot;%s&quot;,__func__);</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">//开始拖动的时候调用</div><div class="line">- (void)scrollViewWillBeginDragging:(UIScrollView *)scrollView&#123;</div><div class="line">    //NSLog(@&quot;tracking:%d&quot;,scrollView.tracking);</div><div class="line">    NSLog(@&quot;%s&quot;,__func__);</div><div class="line">&#125;</div><div class="line"></div><div class="line">// called on finger up if the user dragged. velocity is in points/millisecond. targetContentOffset may be changed to adjust where the scroll view comes to rest</div><div class="line">//将要结束拖动</div><div class="line">- (void)scrollViewWillEndDragging:(UIScrollView *)scrollView withVelocity:(CGPoint)velocity targetContentOffset:(inout CGPoint *)targetContentOffset &#123;</div><div class="line">//    NSLog(@&quot;velocity:%@&quot;,NSStringFromCGPoint(velocity));</div><div class="line">//    NSLog(@&quot;targetContentOffset:%@&quot;,NSStringFromCGPoint(*targetContentOffset));</div><div class="line">    //强制设置scrollView的偏移量</div><div class="line">    //*targetContentOffset = CGPointMake(0, 200);</div><div class="line">    NSLog(@&quot;%s&quot;,__func__);</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 已经结束拖动</div><div class="line">- (void)scrollViewDidEndDragging:(UIScrollView *)scrollView willDecelerate:(BOOL)decelerate&#123;</div><div class="line">    //NSLog(@&quot;dragging：%d&quot;,scrollView.dragging);</div><div class="line">    NSLog(@&quot;%s&quot;,__func__);</div><div class="line">&#125;</div><div class="line"></div><div class="line">//将要开始减速</div><div class="line">- (void)scrollViewWillBeginDecelerating:(UIScrollView *)scrollView&#123;</div><div class="line">    //NSLog(@&quot;decelerating：%d&quot;,scrollView.decelerating);</div><div class="line">    NSLog(@&quot;%s&quot;,__func__);</div><div class="line">&#125;</div><div class="line"></div><div class="line">//减速完成（停止）</div><div class="line">- (void)scrollViewDidEndDecelerating:(UIScrollView *)scrollView&#123;</div><div class="line">    //NSLog(@&quot;contentOffset:%@&quot;,NSStringFromCGPoint(scrollView.contentOffset));</div><div class="line">    NSLog(@&quot;%s&quot;,__func__);</div><div class="line">&#125;</div><div class="line"></div><div class="line">// called when setContentOffset/scrollRectVisible:animated: finishes. not called if not animating</div><div class="line">- (void)scrollViewDidEndScrollingAnimation:(UIScrollView *)scrollView&#123;</div><div class="line">    NSLog(@&quot;%s&quot;,__func__);</div><div class="line">&#125;</div><div class="line">#endif</div><div class="line">#pragma mark -UIScrollViewDelegate(缩放)</div><div class="line">//指定缩放视图</div><div class="line">- (nullable UIView *)viewForZoomingInScrollView:(UIScrollView *)scrollView&#123;</div><div class="line">    NSLog(@&quot;%s,zooming:%d&quot;,__func__,scrollView.zooming);</div><div class="line">    return _imageView;</div><div class="line">&#125;</div><div class="line">//缩放之前调用</div><div class="line">- (void)scrollViewWillBeginZooming:(UIScrollView *)scrollView withView:(nullable UIView *)view &#123;</div><div class="line">    NSLog(@&quot;%s,zooming:%d&quot;,__func__,scrollView.zooming);</div><div class="line">&#125;</div><div class="line">//完成缩放</div><div class="line">- (void)scrollViewDidEndZooming:(UIScrollView *)scrollView withView:(nullable UIView *)view atScale:(CGFloat)scale&#123;</div><div class="line">    NSLog(@&quot;%s,zooming:%d&quot;,__func__,scrollView.zooming);</div><div class="line">&#125;</div><div class="line">//缩放时调用</div><div class="line">- (void)scrollViewDidZoom:(UIScrollView *)scrollView&#123;</div><div class="line">    NSLog(@&quot;%s,zooming:%d&quot;,__func__,scrollView.zooming);</div><div class="line">&#125;</div><div class="line"></div><div class="line">#pragma mark -UIScrollViewDelegate(滚动至顶部)</div><div class="line">//允许滚动至顶部</div><div class="line">- (BOOL)scrollViewShouldScrollToTop:(UIScrollView *)scrollView&#123;</div><div class="line">    return YES;</div><div class="line">&#125;</div><div class="line"></div><div class="line">//已经滚动至顶部</div><div class="line">- (void)scrollViewDidScrollToTop:(UIScrollView *)scrollView&#123;</div><div class="line">    NSLog(@&quot;加载新数据，刷新界面&quot;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    



    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/21/OC/Func/iOS-Func-App跳转设置/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="千夜 QQ:738816656">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="千夜、おれはおまえをずっと爱している">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/21/OC/Func/iOS-Func-App跳转设置/" itemprop="url">iOS_App跳转设置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-21T14:16:33+08:00">
                2017-11-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OC/" itemprop="url" rel="index">
                    <span itemprop="name">OC</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OC/Func/" itemprop="url" rel="index">
                    <span itemprop="name">Func</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="跳到更多设置界面"><a href="#跳到更多设置界面" class="headerlink" title="跳到更多设置界面"></a>跳到更多设置界面</h1><p>除了跳到WiFi设置界面，能不能跳到其他的设置界面呢？比如：定位服务、FaceTime、音乐等等。都是可以的，一起来看看如何实现的</p>
<p>跳到这些界面的参数配置：</p>
<p>##定位服务</p>
<blockquote>
<p>用户关闭了定位,APP里面提示打开定位服务<br>点击到设置界面设置，直接跳到定位服务设置界面=</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">//定位服务设置界面</div><div class="line">NSURL *url = [NSURL URLWithString:@&quot;prefs:root=LOCATION_SERVICES&quot;];</div><div class="line">if ([[UIApplication sharedApplication] canOpenURL:url])</div><div class="line">&#123;</div><div class="line">    [[UIApplication sharedApplication] openURL:url];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="FaceTim"><a href="#FaceTim" class="headerlink" title="FaceTim"></a>FaceTim</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">//FaceTime设置界面</div><div class="line">NSURL *url = [NSURL URLWithString:@&quot;prefs:root=FACETIME&quot;];</div><div class="line">if ([[UIApplication sharedApplication] canOpenURL:url])</div><div class="line">&#123;</div><div class="line">    [[UIApplication sharedApplication] openURL:url];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="音乐"><a href="#音乐" class="headerlink" title="音乐"></a>音乐</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">//音乐设置界面</div><div class="line">NSURL *url = [NSURL URLWithString:@&quot;prefs:root=MUSIC&quot;];</div><div class="line">if ([[UIApplication sharedApplication] canOpenURL:url])</div><div class="line">&#123;</div><div class="line">    [[UIApplication sharedApplication] openURL:url];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="蓝牙设置界面"><a href="#蓝牙设置界面" class="headerlink" title="蓝牙设置界面"></a>蓝牙设置界面</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">//蓝牙设置界面</div><div class="line">NSURL *url = [NSURL URLWithString:@&quot;prefs:root=Bluetooth&quot;];</div><div class="line">if ([[UIApplication sharedApplication] canOpenURL:url])</div><div class="line">&#123;</div><div class="line">   [[UIApplication sharedApplication] openURL:url];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="iCloud设置界面"><a href="#iCloud设置界面" class="headerlink" title="iCloud设置界面"></a>iCloud设置界面</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">//iCloud设置界面</div><div class="line">NSURL *url = [NSURL URLWithString:@&quot;prefs:root=CASTLE&quot;];</div><div class="line">if ([[UIApplication sharedApplication] canOpenURL:url]</div><div class="line">&#123;</div><div class="line">   [[UIApplication sharedApplication] openURL:url];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="other"><a href="#other" class="headerlink" title="other"></a>other</h2><p>设置界面只需要prefs:root=后面的值即可<br>可以跳到这些界面的参数配置：r</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"></div><div class="line">About — prefs:root=General&amp;path=About</div><div class="line"></div><div class="line">Accessibility — prefs:root=General&amp;path=ACCESSIBILITY</div><div class="line"></div><div class="line">Airplane Mode On — prefs:root=AIRPLANE_MODE</div><div class="line"></div><div class="line">Auto-Lock — prefs:root=General&amp;path=AUTOLOCK</div><div class="line"></div><div class="line">Brightness — prefs:root=Brightness</div><div class="line"></div><div class="line">Bluetooth — prefs:root=General&amp;path=Bluetooth</div><div class="line"></div><div class="line">Date &amp; Time — prefs:root=General&amp;path=DATE_AND_TIME</div><div class="line"></div><div class="line">FaceTime — prefs:root=FACETIME</div><div class="line"></div><div class="line">General — prefs:root=General</div><div class="line"></div><div class="line">Keyboard — prefs:root=General&amp;path=Keyboard</div><div class="line"></div><div class="line">iCloud — prefs:root=CASTLE</div><div class="line"></div><div class="line">iCloud Storage &amp; Backup — prefs:root=CASTLE&amp;path=STORAGE_AND_BACKUP</div><div class="line"></div><div class="line">International — prefs:root=General&amp;path=INTERNATIONAL</div><div class="line"></div><div class="line">Location Services — prefs:root=LOCATION_SERVICES</div><div class="line"></div><div class="line">Music — prefs:root=MUSIC</div><div class="line"></div><div class="line">Music Equalizer — prefs:root=MUSIC&amp;path=EQ</div><div class="line"></div><div class="line">Music Volume Limit — prefs:root=MUSIC&amp;path=VolumeLimit</div><div class="line"></div><div class="line">Network — prefs:root=General&amp;path=Network</div><div class="line"></div><div class="line">Nike + iPod — prefs:root=NIKE_PLUS_IPOD</div><div class="line"></div><div class="line">Notes — prefs:root=NOTES</div><div class="line"></div><div class="line">Notification — prefs:root=NOTIFICATIONS_ID</div><div class="line"></div><div class="line">Phone — prefs:root=Phone</div><div class="line"></div><div class="line">Photos — prefs:root=Photos</div><div class="line"></div><div class="line">Profile — prefs:root=General&amp;path=ManagedConfigurationList</div><div class="line"></div><div class="line">Reset — prefs:root=General&amp;path=Reset</div><div class="line"></div><div class="line">Safari — prefs:root=Safari</div><div class="line"></div><div class="line">Siri — prefs:root=General&amp;path=Assistant</div><div class="line"></div><div class="line">Sounds — prefs:root=Sounds</div><div class="line"></div><div class="line">Software Update — prefs:root=General&amp;path=SOFTWARE_UPDATE_LINK</div><div class="line"></div><div class="line">Store — prefs:root=STORE</div><div class="line"></div><div class="line">Twitter — prefs:root=TWITTER</div><div class="line"></div><div class="line">Usage — prefs:root=General&amp;path=USAGE</div><div class="line"></div><div class="line">VPN — prefs:root=General&amp;path=Network/VPN</div><div class="line"></div><div class="line">Wallpaper — prefs:root=Wallpaper</div><div class="line"></div><div class="line">Wi-Fi — prefs:root=WIFI</div></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    



    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/21/OC/Grammar/iOS-Safari-跳转App/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="千夜 QQ:738816656">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="千夜、おれはおまえをずっと爱している">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/21/OC/Grammar/iOS-Safari-跳转App/" itemprop="url">iOS_Safari跳转App</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-21T13:55:42+08:00">
                2017-11-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/Func/" itemprop="url" rel="index">
                    <span itemprop="name">Func</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Safari跳转到App"><a href="#Safari跳转到App" class="headerlink" title="Safari跳转到App"></a>Safari跳转到App</h1><p>##App中定义一个URL协议</p>
<blockquote>
<p>TARGETS -&gt; info -&gt; URL Types -&gt; 添加一个URL协议</p>
</blockquote>
<p><img src="http://ozr735s7e.bkt.clouddn.com/iOS_Safari%E8%B7%B3%E8%BD%ACApp-001.png" alt="001"></p>
<blockquote>
<p>URL Schemes字段就是你这个APP的特殊标示，<br>indentifier:这个URL协议的标示。<br>一个APP可以拥有多个URL协议<br>下面的两个字段可为空。最后再运行一下你的APP。</p>
<h2 id="浏览里访问"><a href="#浏览里访问" class="headerlink" title="浏览里访问"></a>浏览里访问</h2><p>打开Safari浏览器，在输入在地址栏输入：myapp://<br>然后回车</p>
<h2 id="Safari跳回到APP时传一些参数"><a href="#Safari跳回到APP时传一些参数" class="headerlink" title="Safari跳回到APP时传一些参数"></a>Safari跳回到APP时传一些参数</h2><p>比如在Safari浏览器的地址了输入：myapp://myappTest，用下面的方法获取到该参数之后就看自己的操作了</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">在appdelegate.m文件中写下如下方法</div><div class="line">如果iOS版本低于9.0，会在下面方法接受到在地址栏输入的字符串</div><div class="line">- (BOOL)application:(UIApplication *)application openURL:(NSURL *)url sourceApplication:(NSString *)sourceApplication annotation:(id)annotation</div><div class="line">&#123;</div><div class="line">    [[[UIAlertView alloc] initWithTitle:[NSString stringWithFormat:@&quot;sourceApplication-&gt;%@&quot;, [url absoluteString]] message:nil delegate:nil cancelButtonTitle:@&quot;ok&quot; otherButtonTitles:nil] show];</div><div class="line">     return YES;</div><div class="line">&#125;</div><div class="line">如果iOS版本是9.0及以上的，会在下面方法接受到在地址栏输入的字符串</div><div class="line">- (BOOL)application:(UIApplication *)app openURL:(NSURL *)url options:(NSDictionary&lt;NSString *,id&gt; *)options</div><div class="line">&#123;</div><div class="line">     [[[UIAlertView alloc] initWithTitle:[NSString stringWithFormat:@&quot;openURL-&gt;%@&quot;, [url absoluteString]] message:nil delegate:nil cancelButtonTitle:@&quot;ok&quot; otherButtonTitles:nil] show];</div><div class="line">    return YES;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    



    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/17/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><span class="page-number current">18</span><a class="page-number" href="/page/19/">19</a><span class="space">&hellip;</span><a class="page-number" href="/page/21/">21</a><a class="extend next" rel="next" href="/page/19/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">千夜 QQ:738816656</p>
              <p class="site-description motion-element" itemprop="description">ReactNative</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">201</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">106</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">77</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">千夜 QQ:738816656</span>

  
</div>





        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>

<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/love.js"></script>
